System.register(["./game-managers-legacy-BTPVpSIk.js","./game-core-utils-legacy-C0B3c4sF.js","./game-systems-legacy-3fF6kSha.js"],function(e,t){"use strict";var s,i,n,a,o,r,l,c;return{setters:[e=>{s=e.G,i=e.A,n=e.D,a=e.a},e=>{o=e.E,r=e.P,l=e.I},e=>{c=e.A}],execute:function(){class t{constructor(e=!1){this.debug=e,this.logLevel=e?"debug":"info",this.logHistory=[],this.maxHistorySize=1e3,this.performanceMetrics={totalLogs:0,logsByLevel:new Map,averageLogTime:0},this.levels={error:0,warn:1,info:2,debug:3,trace:4},this.startTime=Date.now()}setLevel(e){Object.prototype.hasOwnProperty.call(this.levels,e)?this.logLevel=e:this.warn(`Invalid log level: ${e}`)}enableDebug(){this.debug=!0,this.setLevel("debug")}disableDebug(){this.debug=!1,this.setLevel("info")}shouldLog(e){return this.levels[e]<=this.levels[this.logLevel]}log(e,t,s=null,i=null){if(!this.shouldLog(e))return;const n={level:e,message:t,data:s,context:i,timestamp:Date.now(),id:this.generateLogId()};this.addToHistory(n),this.updatePerformanceMetrics(e),this.outputLog(n)}addToHistory(e){this.logHistory.push(e),this.logHistory.length>this.maxHistorySize&&this.logHistory.shift()}updatePerformanceMetrics(e){this.performanceMetrics.totalLogs++;const t=this.performanceMetrics.logsByLevel.get(e)||0;this.performanceMetrics.logsByLevel.set(e,t+1);const s=this.performanceMetrics.averageLogTime*(this.performanceMetrics.totalLogs-1);this.performanceMetrics.averageLogTime=(s+1)/this.performanceMetrics.totalLogs}outputLog(e){const{level:t,message:s,data:i,context:n,timestamp:a}=e;new Date(a).toISOString(),t.toUpperCase()}generateLogId(){return`log_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}error(e,t=null,s=null){this.log("error",e,t,s)}warn(e,t=null,s=null){this.log("warn",e,t,s)}info(e,t=null,s=null){this.log("info",e,t,s)}debug(e,t=null,s=null){this.log("debug",e,t,s)}trace(e,t=null,s=null){this.log("trace",e,t,s)}performance(e,t,s=null){const i=(s||performance.now())-t;return this.debug(`Performance: ${e} took ${i.toFixed(2)}ms`),i}memory(){if(performance.memory){const e=performance.memory;this.debug("Memory usage:",{used:`${Math.round(e.usedJSHeapSize/1024/1024)}MB`,total:`${Math.round(e.totalJSHeapSize/1024/1024)}MB`,limit:`${Math.round(e.jsHeapSizeLimit/1024/1024)}MB`})}}function(e,t,s=null){const i=performance.now();this.debug(`Function started: ${e}`,null,s);try{const n=t(),a=this.performance(e,i);return this.debug(`Function completed: ${e}`,{duration:a},s),n}catch(n){const t=this.performance(e,i);throw this.error(`Function failed: ${e}`,{error:n.message,duration:t},s),n}}async functionAsync(e,t,s=null){const i=performance.now();this.debug(`Async function started: ${e}`,null,s);try{const n=await t(),a=this.performance(e,i);return this.debug(`Async function completed: ${e}`,{duration:a},s),n}catch(n){const t=this.performance(e,i);throw this.error(`Async function failed: ${e}`,{error:n.message,duration:t},s),n}}event(e,t=null,s=null){this.debug(`Event: ${e}`,t,s)}stateChange(e,t,s=null,i=null){this.info(`State changed: ${e} -> ${t}`,s,i)}userAction(e,t=null,s=null){this.info(`User action: ${e}`,t,s)}apiCall(e,t,s=null,i=null){this.debug(`API call: ${e} ${t}`,s,i)}apiResponse(e,t,s,i=null,n=null){const a=s>=400?"error":"debug";this.log(a,`API response: ${e} ${t} - ${s}`,i,n)}errorWithStack(e,t,s=null){this.error(e,{error:t.message,stack:t.stack},s)}group(e,t,s=null){const i=performance.now();this.debug(`Group started: ${e}`,null,s);try{const n=t(),a=this.performance(e,i);return this.debug(`Group completed: ${e}`,{duration:a},s),n}catch(n){const t=this.performance(e,i);throw this.error(`Group failed: ${e}`,{error:n.message,duration:t},s),n}}async groupAsync(e,t,s=null){const i=performance.now();this.debug(`Async group started: ${e}`,null,s);try{const n=await t(),a=this.performance(e,i);return this.debug(`Async group completed: ${e}`,{duration:a},s),n}catch(n){const t=this.performance(e,i);throw this.error(`Async group failed: ${e}`,{error:n.message,duration:t},s),n}}getHistory(e={}){let t=[...this.logHistory];return e.level&&(t=t.filter(t=>t.level===e.level)),e.context&&(t=t.filter(t=>t.context===e.context)),e.since&&(t=t.filter(t=>t.timestamp>=e.since)),e.until&&(t=t.filter(t=>t.timestamp<=e.until)),e.limit&&(t=t.slice(-e.limit)),t}getPerformanceMetrics(){return{...this.performanceMetrics,logsByLevel:Object.fromEntries(this.performanceMetrics.logsByLevel),uptime:Date.now()-this.startTime}}clearHistory(){this.logHistory=[],this.debug("Log history cleared")}resetMetrics(){this.performanceMetrics={totalLogs:0,logsByLevel:new Map,averageLogTime:0},this.startTime=Date.now(),this.debug("Performance metrics reset")}exportLogs(e={}){const t=this.getHistory(e);return JSON.stringify(t,null,2)}importLogs(e){try{const t=JSON.parse(e);Array.isArray(t)&&(this.logHistory=t,this.debug(`Imported ${t.length} log entries`))}catch(t){this.error("Failed to import logs:",t)}}child(e){const s=new t(this.debug);return s.logLevel=this.logLevel,s.context=e,s}}e("L",t);class h{constructor(e={}){this.eventBus=e.eventBus,this.logger=e.logger,this.inputManager=e.inputManager,this.performanceMonitor=e.performanceMonitor,this.config={enableAutoTesting:!0,testInterval:5e3,gestureTestTimeout:2e3,performanceTestDuration:1e4,enableAccessibilityTesting:!0,enablePerformanceTesting:!0,enableGestureTesting:!0,enableControlTesting:!0,...e.config},this.isTesting=!1,this.testResults={device:null,gestures:new Map,controls:new Map,performance:null,accessibility:null,overall:null},this.testListeners=new Map,this.logger.info("MobileTesting initialized")}async initialize(){this.logger.info("Initializing MobileTesting..."),this.detectMobileDevice(),this.setupTestListeners(),this.config.enableAutoTesting&&this.startAutoTesting(),this.logger.info("MobileTesting initialized successfully")}cleanup(){this.logger.info("Cleaning up MobileTesting..."),this.stopAutoTesting(),this.removeTestListeners(),this.logger.info("MobileTesting cleaned up")}detectMobileDevice(){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),s="ontouchstart"in window||navigator.maxTouchPoints>0,i=/iPad|Android/i.test(e)&&"ontouchstart"in window;this.testResults.device={isMobile:t,isTouch:s,isTablet:i,userAgent:e,screenWidth:window.screen.width,screenHeight:window.screen.height,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,pixelRatio:window.devicePixelRatio||1,orientation:window.innerHeight>window.innerWidth?"portrait":"landscape",maxTouchPoints:navigator.maxTouchPoints||0,hasVibration:"vibrate"in navigator,hasHaptics:"vibrate"in navigator,hasGeolocation:"geolocation"in navigator,hasCamera:"mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices,hasAccelerometer:"DeviceMotionEvent"in window,hasGyroscope:"DeviceOrientationEvent"in window},this.logger.info("Mobile device detected:",this.testResults.device)}setupTestListeners(){this.config.enableGestureTesting&&this.setupGestureTestListeners(),this.config.enableControlTesting&&this.setupControlTestListeners(),this.config.enablePerformanceTesting&&this.setupPerformanceTestListeners(),this.config.enableAccessibilityTesting&&this.setupAccessibilityTestListeners()}setupGestureTestListeners(){[{name:"tap",test:this.testTapGesture.bind(this)},{name:"doubleTap",test:this.testDoubleTapGesture.bind(this)},{name:"longPress",test:this.testLongPressGesture.bind(this)},{name:"swipe",test:this.testSwipeGesture.bind(this)},{name:"pinch",test:this.testPinchGesture.bind(this)},{name:"rotate",test:this.testRotateGesture.bind(this)}].forEach(({name:e,test:t})=>{this.testListeners.set(`gesture:${e}`,t)})}setupControlTestListeners(){[{name:"virtualJoystick",test:this.testVirtualJoystick.bind(this)},{name:"actionButtons",test:this.testActionButtons.bind(this)},{name:"menuButton",test:this.testMenuButton.bind(this)},{name:"pauseButton",test:this.testPauseButton.bind(this)}].forEach(({name:e,test:t})=>{this.testListeners.set(`control:${e}`,t)})}setupPerformanceTestListeners(){this.testListeners.set("performance:test",this.testPerformance.bind(this))}setupAccessibilityTestListeners(){this.testListeners.set("accessibility:test",this.testAccessibility.bind(this))}removeTestListeners(){this.testListeners.clear()}startAutoTesting(){this.isTesting||(this.isTesting=!0,this.autoTestInterval=setInterval(()=>{this.runAllTests()},this.config.testInterval),this.logger.info("Auto-testing started"))}stopAutoTesting(){this.isTesting&&(this.isTesting=!1,this.autoTestInterval&&(clearInterval(this.autoTestInterval),this.autoTestInterval=null),this.logger.info("Auto-testing stopped"))}async runAllTests(){this.logger.info("Running mobile tests...");try{this.config.enableGestureTesting&&await this.testAllGestures(),this.config.enableControlTesting&&await this.testAllControls(),this.config.enablePerformanceTesting&&await this.testPerformance(),this.config.enableAccessibilityTesting&&await this.testAccessibility(),this.calculateOverallScore(),this.eventBus.emit("mobileTesting:results",this.testResults),this.logger.info("Mobile tests completed")}catch(e){this.logger.error("Error running mobile tests:",e)}}async testAllGestures(){const e=["tap","doubleTap","longPress","swipe","pinch","rotate"];for(const s of e)try{const e=await this.testGesture(s);this.testResults.gestures.set(s,e)}catch(t){this.logger.error(`Error testing gesture ${s}:`,t),this.testResults.gestures.set(s,{success:!1,error:t.message})}}async testGesture(e){const t=this.testListeners.get(`gesture:${e}`);if(!t)throw new Error(`No test function found for gesture: ${e}`);return await t()}async testTapGesture(){return new Promise(e=>{let t=!1,s=Date.now();const i=()=>{t=!0;const n=Date.now()-s;document.removeEventListener("touchstart",i),e({success:!0,responseTime:n,timestamp:Date.now()})};document.addEventListener("touchstart",i,{once:!0}),setTimeout(()=>{t||(document.removeEventListener("touchstart",i),e({success:!1,error:"Timeout",timestamp:Date.now()}))},this.config.gestureTestTimeout)})}async testDoubleTapGesture(){return new Promise(e=>{let t=0,s=0;const i=()=>{const n=Date.now();if(t++,1===t)s=n;else if(2===t){const t=n-s,a=t<500;document.removeEventListener("touchstart",i),e({success:a,timeDiff:t,timestamp:Date.now()})}};document.addEventListener("touchstart",i),setTimeout(()=>{document.removeEventListener("touchstart",i),e({success:!1,error:"Timeout",timestamp:Date.now()})},this.config.gestureTestTimeout)})}async testLongPressGesture(){return new Promise(e=>{let t=!1,s=Date.now();const i=()=>{s=Date.now()},n=()=>{const i=Date.now()-s;i>=500&&(t=!0,e({success:!0,duration:i,timestamp:Date.now()}))};document.addEventListener("touchstart",i),document.addEventListener("touchend",n),setTimeout(()=>{document.removeEventListener("touchstart",i),document.removeEventListener("touchend",n),t||e({success:!1,error:"Timeout",timestamp:Date.now()})},this.config.gestureTestTimeout)})}async testSwipeGesture(){return new Promise(e=>{let t=!1,s=null;const i=e=>{s=e.touches[0]},n=i=>{if(!s)return;const n=i.changedTouches[0],a=n.clientX-s.clientX,o=n.clientY-s.clientY,r=Math.sqrt(a*a+o*o);r>=50&&(t=!0,e({success:!0,distance:r,direction:180*Math.atan2(o,a)/Math.PI,timestamp:Date.now()}))};document.addEventListener("touchstart",i),document.addEventListener("touchend",n),setTimeout(()=>{document.removeEventListener("touchstart",i),document.removeEventListener("touchend",n),t||e({success:!1,error:"Timeout",timestamp:Date.now()})},this.config.gestureTestTimeout)})}async testPinchGesture(){return new Promise(e=>{let t=!1,s=[];const i=e=>{2===e.touches.length&&(s=Array.from(e.touches))},n=i=>{if(2===i.touches.length&&2===s.length){const n=Array.from(i.touches),a=this.getDistance(s[0],s[1]),o=this.getDistance(n[0],n[1])/a;Math.abs(o-1)>.1&&(t=!0,e({success:!0,scale:o,timestamp:Date.now()}))}};document.addEventListener("touchstart",i),document.addEventListener("touchmove",n),setTimeout(()=>{document.removeEventListener("touchstart",i),document.removeEventListener("touchmove",n),t||e({success:!1,error:"Timeout",timestamp:Date.now()})},this.config.gestureTestTimeout)})}async testRotateGesture(){return new Promise(e=>{let t=!1,s=[];const i=e=>{2===e.touches.length&&(s=Array.from(e.touches))},n=i=>{if(2===i.touches.length&&2===s.length){const n=Array.from(i.touches),a=this.getAngle(s[0],s[1]),o=this.getAngle(n[0],n[1])-a;Math.abs(o)>.1&&(t=!0,e({success:!0,rotation:180*o/Math.PI,timestamp:Date.now()}))}};document.addEventListener("touchstart",i),document.addEventListener("touchmove",n),setTimeout(()=>{document.removeEventListener("touchstart",i),document.removeEventListener("touchmove",n),t||e({success:!1,error:"Timeout",timestamp:Date.now()})},this.config.gestureTestTimeout)})}async testAllControls(){const e=["virtualJoystick","actionButtons","menuButton","pauseButton"];for(const s of e)try{const e=await this.testControl(s);this.testResults.controls.set(s,e)}catch(t){this.logger.error(`Error testing control ${s}:`,t),this.testResults.controls.set(s,{success:!1,error:t.message})}}async testControl(e){const t=this.testListeners.get(`control:${e}`);if(!t)throw new Error(`No test function found for control: ${e}`);return await t()}async testVirtualJoystick(){if(!this.inputManager||!this.inputManager.mobileUI.virtualJoystick.element)return{success:!1,error:"Virtual joystick not available",timestamp:Date.now()};const e=this.inputManager.mobileUI.virtualJoystick,t=e.element.getBoundingClientRect();return{success:!0,position:{x:t.left,y:t.top,width:t.width,height:t.height},active:e.active,timestamp:Date.now()}}async testActionButtons(){if(!this.inputManager||!this.inputManager.mobileUI.actionButtons)return{success:!1,error:"Action buttons not available",timestamp:Date.now()};const e=Array.from(this.inputManager.mobileUI.actionButtons.entries()).map(([e,t])=>{const s=t.getBoundingClientRect();return{id:e,position:{x:s.left,y:s.top,width:s.width,height:s.height},visible:null!==t.offsetParent}});return{success:!0,buttons:e,count:e.length,timestamp:Date.now()}}async testMenuButton(){const e=document.querySelector(".menu-button");if(!e)return{success:!1,error:"Menu button not found",timestamp:Date.now()};const t=e.getBoundingClientRect();return{success:!0,position:{x:t.left,y:t.top,width:t.width,height:t.height},visible:null!==e.offsetParent,timestamp:Date.now()}}async testPauseButton(){const e=document.querySelector(".pause-button");if(!e)return{success:!1,error:"Pause button not found",timestamp:Date.now()};const t=e.getBoundingClientRect();return{success:!0,position:{x:t.left,y:t.top,width:t.width,height:t.height},visible:null!==e.offsetParent,timestamp:Date.now()}}async testPerformance(){if(!this.performanceMonitor)return{success:!1,error:"Performance monitor not available",timestamp:Date.now()};const e=this.performanceMonitor.getMetrics(),t=this.performanceMonitor.getPerformanceScore();return this.testResults.performance={success:!0,score:t,metrics:{fps:e.fps.current,frameTime:e.frameTime.current,memory:e.memory.used,audio:e.audio.contextState},timestamp:Date.now()},this.testResults.performance}async testAccessibility(){const e=[this.testScreenReaderSupport(),this.testKeyboardNavigation(),this.testHighContrast(),this.testTextScaling()],t=await Promise.all(e);return this.testResults.accessibility={success:!0,tests:t,overallScore:t.reduce((e,t)=>e+(t.success?1:0),0)/t.length,timestamp:Date.now()},this.testResults.accessibility}async testScreenReaderSupport(){const e="speechSynthesis"in window,t=null!==document.querySelector("[aria-label]");return{name:"screenReader",success:e&&t,details:{hasScreenReader:e,hasAriaSupport:t}}}async testKeyboardNavigation(){const e=document.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');return{name:"keyboardNavigation",success:e.length>0,details:{focusableElements:e.length}}}async testHighContrast(){return{name:"highContrast",success:!0,details:{enabled:document.documentElement.classList.contains("high-contrast")}}}async testTextScaling(){const e=getComputedStyle(document.documentElement).getPropertyValue("--text-scale")||"1";return{name:"textScaling",success:!0,details:{scale:parseFloat(e)}}}calculateOverallScore(){let e=0,t=0;this.testResults.device?.isMobile&&(e+=1,t+=1);for(const[s,i]of this.testResults.gestures)e+=i.success?1:0,t+=1;for(const[s,i]of this.testResults.controls)e+=i.success?1:0,t+=1;this.testResults.performance&&(e+=this.testResults.performance.score/100,t+=1),this.testResults.accessibility&&(e+=this.testResults.accessibility.overallScore,t+=1),this.testResults.overall={score:t>0?e/t:0,totalTests:t,passedTests:Math.round(e),timestamp:Date.now()}}getDistance(e,t){const s=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(s*s+i*i)}getAngle(e,t){return Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)}getTestResults(){return this.testResults}getTestReport(){return{device:this.testResults.device,gestures:Object.fromEntries(this.testResults.gestures),controls:Object.fromEntries(this.testResults.controls),performance:this.testResults.performance,accessibility:this.testResults.accessibility,overall:this.testResults.overall,timestamp:Date.now()}}exportTestResults(){return JSON.stringify(this.getTestReport(),null,2)}updateConfig(e){this.config={...this.config,...e}}}class u{constructor(e={}){if(!(e.eventBus&&e.eventBus instanceof o))throw new Error("SettingsUI: eventBus is required and must be an EventBus instance");if(!(e.logger&&e.logger instanceof t))throw new Error("SettingsUI: logger is required and must be a Logger instance");this.eventBus=e.eventBus,this.logger=e.logger,this.container=e.container||document.body,this.isVisible=!1,this.settings=this.getDefaultSettings(),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.toggle=this.toggle.bind(this),this.updateSetting=this.updateSetting.bind(this),this.resetToDefaults=this.resetToDefaults.bind(this),this.saveSettings=this.saveSettings.bind(this),this.loadSettings=this.loadSettings.bind(this),this.initializeUI(),this.setupEventListeners(),this.loadSettings(),this.logger.info("SettingsUI initialized")}getDefaultSettings(){return{audio:{masterVolume:1,musicVolume:.8,sfxVolume:.9,muteAll:!1,muteMusic:!1,muteSfx:!1},graphics:{quality:"high",fullscreen:!1,vsync:!0,particleEffects:!0,shadows:!0,antiAliasing:!0},gameplay:{difficulty:"normal",autoSave:!0,autoPause:!0,showFPS:!1,showDebugInfo:!1,tutorialEnabled:!0},accessibility:{highContrast:!1,largeText:!1,screenReader:!1,colorBlindMode:"none",reducedMotion:!1,keyboardNavigation:!0},controls:{keyBindings:this.getDefaultKeyBindings(),mouseSensitivity:1,invertY:!1,autoAim:!1}}}getDefaultKeyBindings(){return{moveUp:"KeyW",moveDown:"KeyS",moveLeft:"KeyA",moveRight:"KeyD",jump:"Space",action:"KeyE",pause:"Escape",inventory:"KeyI",map:"KeyM",chat:"KeyT"}}initializeUI(){this.settingsContainer=document.createElement("div"),this.settingsContainer.className="settings-container",this.settingsContainer.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: none;\n      z-index: 1000;\n      overflow-y: auto;\n    ",this.settingsPanel=document.createElement("div"),this.settingsPanel.className="settings-panel",this.settingsPanel.style.cssText="\n      position: relative;\n      max-width: 800px;\n      margin: 2rem auto;\n      background: #1a1a1a;\n      border-radius: 8px;\n      padding: 2rem;\n      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);\n    ",this.createHeader(),this.createAudioSection(),this.createGraphicsSection(),this.createGameplaySection(),this.createAccessibilitySection(),this.createControlsSection(),this.createFooter(),this.settingsContainer.appendChild(this.settingsPanel),this.container.appendChild(this.settingsContainer)}createHeader(){const e=document.createElement("div");e.className="settings-header",e.style.cssText="\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 2rem;\n      padding-bottom: 1rem;\n      border-bottom: 1px solid #333;\n    ";const t=document.createElement("h2");t.textContent="Game Settings",t.style.cssText="\n      color: #fff;\n      margin: 0;\n      font-size: 1.5rem;\n    ";const s=document.createElement("button");s.textContent="Ã—",s.className="settings-close",s.style.cssText="\n      background: none;\n      border: none;\n      color: #fff;\n      font-size: 2rem;\n      cursor: pointer;\n      padding: 0;\n      width: 40px;\n      height: 40px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    ",s.addEventListener("click",this.hide),e.appendChild(t),e.appendChild(s),this.settingsPanel.appendChild(e)}createAudioSection(){const e=this.createSection("Audio Settings","audio");this.createSliderControl(e,"Master Volume","audio.masterVolume",0,1,.1),this.createSliderControl(e,"Music Volume","audio.musicVolume",0,1,.1),this.createSliderControl(e,"SFX Volume","audio.sfxVolume",0,1,.1),this.createCheckboxControl(e,"Mute All","audio.muteAll"),this.createCheckboxControl(e,"Mute Music","audio.muteMusic"),this.createCheckboxControl(e,"Mute SFX","audio.muteSfx")}createGraphicsSection(){const e=this.createSection("Graphics Settings","graphics");this.createSelectControl(e,"Quality Preset","graphics.quality",[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"ultra",label:"Ultra"}]),this.createCheckboxControl(e,"Fullscreen","graphics.fullscreen"),this.createCheckboxControl(e,"VSync","graphics.vsync"),this.createCheckboxControl(e,"Particle Effects","graphics.particleEffects"),this.createCheckboxControl(e,"Shadows","graphics.shadows"),this.createCheckboxControl(e,"Anti-Aliasing","graphics.antiAliasing")}createGameplaySection(){const e=this.createSection("Gameplay Settings","gameplay");this.createSelectControl(e,"Difficulty","gameplay.difficulty",[{value:"easy",label:"Easy"},{value:"normal",label:"Normal"},{value:"hard",label:"Hard"},{value:"expert",label:"Expert"}]),this.createCheckboxControl(e,"Auto Save","gameplay.autoSave"),this.createCheckboxControl(e,"Auto Pause","gameplay.autoPause"),this.createCheckboxControl(e,"Show FPS","gameplay.showFPS"),this.createCheckboxControl(e,"Show Debug Info","gameplay.showDebugInfo"),this.createCheckboxControl(e,"Tutorial Enabled","gameplay.tutorialEnabled")}createAccessibilitySection(){const e=this.createSection("Accessibility Settings","accessibility");this.createCheckboxControl(e,"High Contrast","accessibility.highContrast"),this.createCheckboxControl(e,"Large Text","accessibility.largeText"),this.createCheckboxControl(e,"Screen Reader Support","accessibility.screenReader"),this.createCheckboxControl(e,"Reduced Motion","accessibility.reducedMotion"),this.createCheckboxControl(e,"Keyboard Navigation","accessibility.keyboardNavigation"),this.createSelectControl(e,"Color Blind Mode","accessibility.colorBlindMode",[{value:"none",label:"None"},{value:"protanopia",label:"Protanopia"},{value:"deuteranopia",label:"Deuteranopia"},{value:"tritanopia",label:"Tritanopia"}])}createControlsSection(){const e=this.createSection("Controls Settings","controls");this.createSliderControl(e,"Mouse Sensitivity","controls.mouseSensitivity",.1,3,.1),this.createCheckboxControl(e,"Invert Y Axis","controls.invertY"),this.createCheckboxControl(e,"Auto Aim","controls.autoAim");const t=document.createElement("div");t.innerHTML="<h4>Key Bindings</h4><p>Key binding customization coming soon...</p>",e.appendChild(t)}createSection(e,t){const s=document.createElement("div");s.className=`settings-section settings-section-${t}`,s.style.cssText="\n      margin-bottom: 2rem;\n      padding: 1rem;\n      background: #2a2a2a;\n      border-radius: 4px;\n    ";const i=document.createElement("h3");return i.textContent=e,i.style.cssText="\n      color: #fff;\n      margin: 0 0 1rem 0;\n      font-size: 1.2rem;\n    ",s.appendChild(i),this.settingsPanel.appendChild(s),s}createSliderControl(e,t,s,i,n,a){const o=document.createElement("div");o.className="settings-control",o.style.cssText="\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1rem;\n    ";const r=document.createElement("label");r.textContent=t,r.style.cssText="\n      color: #fff;\n      margin-right: 1rem;\n      min-width: 150px;\n    ";const l=document.createElement("input");l.type="range",l.min=i,l.max=n,l.step=a,l.value=this.getSettingValue(s),l.style.cssText="\n      flex: 1;\n      margin-right: 1rem;\n    ";const c=document.createElement("span");c.textContent=l.value,c.style.cssText="\n      color: #fff;\n      min-width: 50px;\n      text-align: right;\n    ",l.addEventListener("input",e=>{c.textContent=e.target.value,this.updateSetting(s,parseFloat(e.target.value))}),o.appendChild(r),o.appendChild(l),o.appendChild(c),e.appendChild(o)}createCheckboxControl(e,t,s){const i=document.createElement("div");i.className="settings-control",i.style.cssText="\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1rem;\n    ";const n=document.createElement("label");n.textContent=t,n.style.cssText="\n      color: #fff;\n      margin-right: 1rem;\n      flex: 1;\n    ";const a=document.createElement("input");a.type="checkbox",a.checked=this.getSettingValue(s),a.style.cssText="\n      width: 20px;\n      height: 20px;\n    ",a.addEventListener("change",e=>{this.updateSetting(s,e.target.checked)}),i.appendChild(n),i.appendChild(a),e.appendChild(i)}createSelectControl(e,t,s,i){const n=document.createElement("div");n.className="settings-control",n.style.cssText="\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1rem;\n    ";const a=document.createElement("label");a.textContent=t,a.style.cssText="\n      color: #fff;\n      margin-right: 1rem;\n      min-width: 150px;\n    ";const o=document.createElement("select");o.value=this.getSettingValue(s),o.style.cssText="\n      flex: 1;\n      padding: 0.5rem;\n      background: #333;\n      color: #fff;\n      border: 1px solid #555;\n      border-radius: 4px;\n    ",i.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.label,o.appendChild(t)}),o.addEventListener("change",e=>{this.updateSetting(s,e.target.value)}),n.appendChild(a),n.appendChild(o),e.appendChild(n)}createFooter(){const e=document.createElement("div");e.className="settings-footer",e.style.cssText="\n      display: flex;\n      justify-content: space-between;\n      margin-top: 2rem;\n      padding-top: 1rem;\n      border-top: 1px solid #333;\n    ";const t=document.createElement("button");t.textContent="Reset to Defaults",t.className="settings-reset",t.style.cssText="\n      background: #666;\n      color: #fff;\n      border: none;\n      padding: 0.75rem 1.5rem;\n      border-radius: 4px;\n      cursor: pointer;\n    ",t.addEventListener("click",this.resetToDefaults);const s=document.createElement("div");s.style.cssText="\n      display: flex;\n      gap: 1rem;\n    ";const i=document.createElement("button");i.textContent="Cancel",i.className="settings-cancel",i.style.cssText="\n      background: #666;\n      color: #fff;\n      border: none;\n      padding: 0.75rem 1.5rem;\n      border-radius: 4px;\n      cursor: pointer;\n    ",i.addEventListener("click",this.hide);const n=document.createElement("button");n.textContent="Save Settings",n.className="settings-save",n.style.cssText="\n      background: #4CAF50;\n      color: #fff;\n      border: none;\n      padding: 0.75rem 1.5rem;\n      border-radius: 4px;\n      cursor: pointer;\n    ",n.addEventListener("click",this.saveSettings),s.appendChild(i),s.appendChild(n),e.appendChild(t),e.appendChild(s),this.settingsPanel.appendChild(e)}setupEventListeners(){document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isVisible&&this.hide()}),this.settingsContainer.addEventListener("click",e=>{e.target===this.settingsContainer&&this.hide()})}getSettingValue(e){if(!e||"string"!=typeof e)return;const t=e.split(".");let s=this.settings;for(const i of t){if(!s||"object"!=typeof s||!(i in s))return;s=s[i]}return s}updateSetting(e,t){const s=e.split(".");let i=this.settings;for(let n=0;n<s.length-1;n++)i=i[s[n]];i[s[s.length-1]]=t,this.eventBus.emit("settings:changed",{path:e,value:t,settings:this.settings}),this.logger.debug(`Setting updated: ${e} = ${t}`)}show(){this.settingsContainer.style.display="block",this.isVisible=!0,this.eventBus.emit("settings:opened"),this.logger.info("Settings UI opened")}hide(){this.settingsContainer.style.display="none",this.isVisible=!1,this.eventBus.emit("settings:closed"),this.logger.info("Settings UI closed")}toggle(){this.isVisible?this.hide():this.show()}resetToDefaults(){this.settings=this.getDefaultSettings(),this.loadSettings(),this.eventBus.emit("settings:reset"),this.logger.info("Settings reset to defaults")}saveSettings(){try{localStorage.setItem("gameSettings",JSON.stringify(this.settings)),this.eventBus.emit("settings:saved",this.settings),this.logger.info("Settings saved successfully"),this.hide()}catch(e){this.logger.error("Failed to save settings:",e),this.eventBus.emit("settings:saveError",e)}}loadSettings(){try{const e=localStorage.getItem("gameSettings");if(e){const t=JSON.parse(e);this.settings=this.mergeSettings(this.settings,t),this.eventBus.emit("settings:loaded",this.settings),this.logger.info("Settings loaded successfully")}}catch(e){this.logger.error("Failed to load settings:",e),this.eventBus.emit("settings:loadError",e)}}mergeSettings(e,t){const s={...e};for(const i in t)"object"!=typeof t[i]||Array.isArray(t[i])?s[i]=t[i]:s[i]=this.mergeSettings(e[i]||{},t[i]);return s}getSettings(){return{...this.settings}}setSettings(e){this.settings=this.mergeSettings(this.settings,e),this.eventBus.emit("settings:updated",this.settings),this.logger.info("Settings updated programmatically")}cleanup(){this.settingsContainer&&this.settingsContainer.parentNode&&this.settingsContainer.parentNode.removeChild(this.settingsContainer),this.eventBus.emit("settings:cleanup"),this.logger.info("SettingsUI cleaned up")}}class g{constructor(e={}){if(this.config=this.validateConfig({debug:!1,enableAchievements:!0,enableDailyChallenges:!0,enableAccessibility:!0,...e}),"boolean"!=typeof this.config.debug)throw new Error("GameRefactored: config.debug must be a boolean");if("boolean"!=typeof this.config.enableAchievements)throw new Error("GameRefactored: config.enableAchievements must be a boolean");if("boolean"!=typeof this.config.enableDailyChallenges)throw new Error("GameRefactored: config.enableDailyChallenges must be a boolean");if("boolean"!=typeof this.config.enableAccessibility)throw new Error("GameRefactored: config.enableAccessibility must be a boolean");if(this.eventBus=new o,!this.eventBus||"function"!=typeof this.eventBus.emit)throw new Error("GameRefactored: EventBus initialization failed");if(this.logger=new t(this.config.debug),!this.logger||"function"!=typeof this.logger.info)throw new Error("GameRefactored: Logger initialization failed");if(this.gameState={isRunning:!1,isPaused:!1,currentLevel:1,score:0,player:null,gameObjects:[],startTime:null,lastUpdateTime:null,activePowerUps:new Map},"boolean"!=typeof this.gameState.isRunning)throw new Error("GameRefactored: gameState.isRunning must be a boolean");if("number"!=typeof this.gameState.currentLevel||this.gameState.currentLevel<1)throw new Error("GameRefactored: gameState.currentLevel must be a positive number");if("number"!=typeof this.gameState.score||this.gameState.score<0)throw new Error("GameRefactored: gameState.score must be a non-negative number");if(!Array.isArray(this.gameState.gameObjects))throw new Error("GameRefactored: gameState.gameObjects must be an array");if(this.managers={},this.initializeManagers(),this.performanceMonitor=new r({eventBus:this.eventBus,logger:this.logger,config:this.config}),this.inputManager=new l({eventBus:this.eventBus,logger:this.logger,config:this.config}),this.mobileTesting=new h({eventBus:this.eventBus,logger:this.logger,inputManager:this.inputManager,performanceMonitor:this.performanceMonitor,config:this.config}),this.ui={},this.systems={},this.initializeUISystems(),!this.managers.game)throw new Error("GameRefactored: GameManager initialization failed");if(this.config.enableAchievements&&!this.managers.achievements)throw new Error("GameRefactored: AchievementManager initialization failed when enabled");if(this.config.enableDailyChallenges&&!this.managers.dailyChallenges)throw new Error("GameRefactored: DailyChallengeManager initialization failed when enabled");if(this.config.enableAccessibility&&!this.managers.accessibility)throw new Error("GameRefactored: AccessibilityManager initialization failed when enabled");if(!this.ui.settings)throw new Error("GameRefactored: SettingsUI initialization failed");if(!this.systems.audio)throw new Error("GameRefactored: AudioSystem initialization failed");if(this.update=this.update.bind(this),this.render=this.render.bind(this),this.handleInput=this.handleInput.bind(this),"function"!=typeof this.update)throw new Error("GameRefactored: update method binding failed");if("function"!=typeof this.render)throw new Error("GameRefactored: render method binding failed");if("function"!=typeof this.handleInput)throw new Error("GameRefactored: handleInput method binding failed");this.logger.info("GameRefactored initialized")}validateConfig(e){const t={...e};return t.debug=Boolean(t.debug),t.enableAchievements=Boolean(t.enableAchievements),t.enableDailyChallenges=Boolean(t.enableDailyChallenges),t.enableAccessibility=Boolean(t.enableAccessibility),t}initializeManagers(){this.managers.game=new s({eventBus:this.eventBus,logger:this.logger,config:this.config}),this.config.enableAchievements&&(this.managers.achievements=new i({eventBus:this.eventBus,logger:this.logger,gameState:()=>this.gameState})),this.config.enableDailyChallenges&&(this.managers.dailyChallenges=new n({eventBus:this.eventBus,logger:this.logger,gameState:()=>this.gameState})),this.config.enableAccessibility&&(this.managers.accessibility=new a({eventBus:this.eventBus,logger:this.logger,gameState:()=>this.gameState})),this.setupManagerCommunication()}initializeUISystems(){this.ui.settings=new u({eventBus:this.eventBus,logger:this.logger,container:document.body}),this.systems.audio=new c({eventBus:this.eventBus,logger:this.logger}),this.setupUIIntegration()}setupUIIntegration(){this.eventBus.on("settings:changed",e=>{e.path.startsWith("audio.")&&this.logger.debug(`Audio setting changed: ${e.path} = ${e.value}`)}),this.eventBus.on("game:stateChanged",e=>{this.ui.settings&&this.logger.debug(`Game state changed: ${JSON.stringify(e)}`)})}setupManagerCommunication(){this.eventBus.on("player:scoreChanged",e=>{this.managers.achievements&&this.managers.achievements.checkScoreAchievements(e.score),this.updateUI("score",e.score)}),this.eventBus.on("player:levelCompleted",e=>{this.managers.achievements&&this.managers.achievements.checkLevelAchievements(e.level),this.managers.dailyChallenges&&this.managers.dailyChallenges.checkLevelChallenge(e.level),this.updateUI("level",e.level)}),this.eventBus.on("player:itemCollected",e=>{this.managers.achievements&&this.managers.achievements.checkCollectionAchievements(e.itemType),this.managers.dailyChallenges&&this.managers.dailyChallenges.checkCollectionChallenge(e.itemType),this.updateUI("item",e.itemType)}),this.eventBus.on("game:stateChanged",e=>{this.managers.accessibility&&this.managers.accessibility.announceStateChange(e)}),this.eventBus.on("achievement:unlocked",e=>{this.logger.info(`Achievement unlocked: ${e.name}`),this.managers.game&&this.managers.game.handleAchievementUnlock(e),this.updateUI("achievement",e)}),this.eventBus.on("dailyChallenge:completed",e=>{this.logger.info(`Daily challenge completed: ${e.name}`),this.managers.game&&this.managers.game.handleDailyChallengeCompletion(e),this.updateUI("challenge",e)}),this.eventBus.on("powerup:activated",e=>{this.gameState.activePowerUps.set(e.type,{...e,startTime:Date.now(),duration:e.duration||1e4}),this.updateUI("powerup",e)}),this.eventBus.on("powerup:expired",e=>{this.gameState.activePowerUps.delete(e.type),this.updateUI("powerupExpired",e)}),this.eventBus.on("console:command",e=>{this.handleConsoleCommand(e)}),this.eventBus.on("play:action",e=>{this.handlePlayAction(e)})}updateUI(e,t){this.eventBus.emit("ui:update",{type:e,data:t,timestamp:Date.now()})}handleConsoleCommand(e){const{command:t,args:s}=e;switch(t){case"setScore":this.gameState.score=parseInt(s[0])||0,this.eventBus.emit("player:scoreChanged",{score:this.gameState.score}),this.logger.info(`Console: Score set to ${this.gameState.score}`);break;case"setLevel":this.gameState.currentLevel=parseInt(s[0])||1,this.eventBus.emit("player:levelCompleted",{level:this.gameState.currentLevel}),this.logger.info(`Console: Level set to ${this.gameState.currentLevel}`);break;case"addPowerUp":const e=s[0]||"speed";this.eventBus.emit("powerup:activated",{type:e,duration:1e4}),this.logger.info(`Console: Power-up ${e} added`);break;case"unlockAchievement":const i=s[0]||"test";this.eventBus.emit("achievement:unlocked",{name:i,description:"Console unlocked achievement"}),this.logger.info(`Console: Achievement ${i} unlocked`);break;case"toggleSettings":this.ui.settings&&this.ui.settings.toggle();break;case"muteAudio":this.systems.audio&&this.systems.audio.muteAll();break;case"unmuteAudio":this.systems.audio&&this.systems.audio.unmuteAll();break;default:this.logger.warn(`Console: Unknown command: ${t}`)}}handlePlayAction(e){const{action:t,params:s}=e;switch(t){case"jump":this.eventBus.emit("player:jump",s);break;case"collect":this.eventBus.emit("player:collect",s);break;case"damage":this.eventBus.emit("player:damage",s);break;case"pause":this.pause();break;case"resume":this.resume();break;case"restart":this.stop(),this.start();break;default:this.logger.warn(`Play: Unknown action: ${t}`)}}async start(){try{this.logger.info("Starting game...");for(const[e,t]of Object.entries(this.managers))t.initialize&&await t.initialize();this.performanceMonitor.initialize&&await this.performanceMonitor.initialize(),this.inputManager.initialize&&await this.inputManager.initialize(),this.mobileTesting.initialize&&await this.mobileTesting.initialize(),this.systems.audio&&this.systems.audio.initialize&&await this.systems.audio.initialize(),this.gameState.isRunning=!0,this.gameState.startTime=Date.now(),this.gameState.lastUpdateTime=performance.now(),this.gameLoopId=requestAnimationFrame(this.update),this.eventBus.emit("game:started",{timestamp:this.gameState.startTime,config:this.config}),this.systems.audio&&this.systems.audio.playMusic("mainTheme"),this.logger.info("Game started successfully")}catch(e){throw this.logger.error("Failed to start game:",e),e}}pause(){this.gameState.isRunning&&!this.gameState.isPaused&&(this.gameState.isPaused=!0,cancelAnimationFrame(this.gameLoopId),this.eventBus.emit("game:paused",{timestamp:Date.now(),pauseTime:this.gameState.startTime}),this.logger.info("Game paused"))}resume(){this.gameState.isRunning&&this.gameState.isPaused&&(this.gameState.isPaused=!1,this.gameState.lastUpdateTime=performance.now(),this.gameLoopId=requestAnimationFrame(this.update),this.eventBus.emit("game:resumed",{timestamp:Date.now()}),this.logger.info("Game resumed"))}stop(){this.gameState.isRunning=!1,this.gameState.isPaused=!1,this.gameLoopId&&cancelAnimationFrame(this.gameLoopId);for(const[e,t]of Object.entries(this.managers))t.cleanup&&t.cleanup();this.performanceMonitor.cleanup&&this.performanceMonitor.cleanup(),this.inputManager.cleanup&&this.inputManager.cleanup(),this.mobileTesting.cleanup&&this.mobileTesting.cleanup(),this.eventBus.emit("game:stopped",{timestamp:Date.now(),finalScore:this.gameState.score,finalLevel:this.gameState.currentLevel}),this.logger.info("Game stopped")}update(e){if(!this.gameState.isRunning||this.gameState.isPaused)return;const t=e-this.gameState.lastUpdateTime;this.gameState.lastUpdateTime=e;try{for(const[e,s]of Object.entries(this.managers))s.update&&s.update(t,this.gameState);this.performanceMonitor.update&&this.performanceMonitor.update(t),this.inputManager.update&&this.inputManager.update(t),this.updateGameObjects(t),this.gameLoopId=requestAnimationFrame(this.update)}catch(s){this.logger.error("Error in game update loop:",s),this.stop()}}updateGameObjects(e){this.gameState.player&&this.gameState.player.update&&this.gameState.player.update(e),this.gameState.gameObjects.forEach(t=>{t.update&&t.update(e)}),this.gameState.gameObjects=this.gameState.gameObjects.filter(e=>!e.destroyed)}render(){this.eventBus.emit("game:render",{gameState:this.gameState,timestamp:performance.now()})}handleInput(e,t){this.gameState.isRunning&&(this.eventBus.emit("game:input",{type:e,data:t,timestamp:Date.now()}),this.gameState.player&&this.gameState.player.handleInput&&this.gameState.player.handleInput(e,t))}addGameObject(e){this.gameState.gameObjects.push(e),this.eventBus.emit("game:objectAdded",{object:e,timestamp:Date.now()})}removeGameObject(e){const t=this.gameState.gameObjects.findIndex(t=>t.id===e);if(-1!==t){const e=this.gameState.gameObjects.splice(t,1)[0];this.eventBus.emit("game:objectRemoved",{object:e,timestamp:Date.now()})}}getGameState(){return{...this.gameState}}getManager(e){return this.managers[e]}getPerformanceMonitor(){return this.performanceMonitor}getInputManager(){return this.inputManager}getMobileTesting(){return this.mobileTesting}getPerformanceReport(){return this.performanceMonitor?this.performanceMonitor.getPerformanceReport():null}getMobileControlsState(){return this.inputManager?this.inputManager.getMobileControlsState():null}getMobileTestResults(){return this.mobileTesting?this.mobileTesting.getTestResults():null}getUI(e){return this.ui[e]}getSystem(e){return this.systems[e]}getActivePowerUps(){const e=Date.now(),t=[];for(const[s,i]of this.gameState.activePowerUps)e-i.startTime<i.duration?t.push({type:s,...i,remainingTime:i.duration-(e-i.startTime)}):(this.gameState.activePowerUps.delete(s),this.eventBus.emit("powerup:expired",{type:s}));return t}executeConsoleCommand(e,...t){this.eventBus.emit("console:command",{command:e,args:t})}executePlayAction(e,t={}){this.eventBus.emit("play:action",{action:e,params:t})}getGameStats(){return{score:this.gameState.score,level:this.gameState.currentLevel,isRunning:this.gameState.isRunning,isPaused:this.gameState.isPaused,gameTime:this.gameState.startTime?Date.now()-this.gameState.startTime:0,activePowerUps:this.getActivePowerUps(),achievements:this.managers.achievements?this.managers.achievements.getAllAchievements():[],challenges:this.managers.dailyChallenges?this.managers.dailyChallenges.getActiveChallenges():[]}}updateConfig(e){this.config={...this.config,...e},this.eventBus.emit("game:configChanged",{config:this.config,timestamp:Date.now()})}destroy(){this.stop(),this.ui.settings&&this.ui.settings.cleanup(),this.systems.audio&&this.systems.audio.cleanup(),this.eventBus.removeAllListeners(),this.gameState=null,this.managers=null,this.ui=null,this.systems=null,this.logger.info("GameRefactored destroyed")}}const m=Object.freeze(Object.defineProperty({__proto__:null,GameRefactored:g,default:g},Symbol.toStringTag,{value:"Module"}));e("G",m)}}});
//# sourceMappingURL=game-core-legacy-DqYh4P9o.js.map
