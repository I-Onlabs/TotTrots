System.register(["./game-core-utils-legacy-C0B3c4sF.js","./game-core-legacy-DqYh4P9o.js"],function(t,e){"use strict";var i,s;return{setters:[t=>{i=t.E},t=>{s=t.L}],execute:function(){t("A",class{constructor(t={}){if(!(t.eventBus&&t.eventBus instanceof i))throw new Error("AudioSystem: eventBus is required and must be an EventBus instance");if(!(t.logger&&t.logger instanceof s))throw new Error("AudioSystem: logger is required and must be a Logger instance");this.eventBus=t.eventBus,this.logger=t.logger,this.audioContext=null,this.sounds=new Map,this.music=new Map,this.audioSettings={masterVolume:1,musicVolume:.8,sfxVolume:.9,muteAll:!1,muteMusic:!1,muteSfx:!1},this.currentMusic=null,this.isInitialized=!1,this.initialize=this.initialize.bind(this),this.loadSound=this.loadSound.bind(this),this.loadMusic=this.loadMusic.bind(this),this.playSound=this.playSound.bind(this),this.playMusic=this.playMusic.bind(this),this.stopMusic=this.stopMusic.bind(this),this.pauseMusic=this.pauseMusic.bind(this),this.resumeMusic=this.resumeMusic.bind(this),this.setMasterVolume=this.setMasterVolume.bind(this),this.setMusicVolume=this.setMusicVolume.bind(this),this.setSfxVolume=this.setSfxVolume.bind(this),this.muteAll=this.muteAll.bind(this),this.unmuteAll=this.unmuteAll.bind(this),this.muteMusic=this.muteMusic.bind(this),this.unmuteMusic=this.unmuteMusic.bind(this),this.muteSfx=this.muteSfx.bind(this),this.unmuteSfx=this.unmuteSfx.bind(this),this.cleanup=this.cleanup.bind(this),this.logger.info("AudioSystem initialized")}async initialize(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),"suspended"===this.audioContext.state&&await this.audioContext.resume(),this.setupEventListeners(),await this.loadDefaultAssets(),this.isInitialized=!0,this.eventBus.emit("audio:initialized"),this.logger.info("AudioSystem initialized successfully")}catch(t){throw this.logger.error("Failed to initialize AudioSystem:",t),this.eventBus.emit("audio:initializationError",t),t}}setupEventListeners(){this.eventBus.on("settings:changed",t=>{this.handleSettingsChange(t)}),this.eventBus.on("player:jump",()=>{this.playSound("jump")}),this.eventBus.on("player:collect",t=>{this.playSound("collect")}),this.eventBus.on("player:damage",()=>{this.playSound("damage")}),this.eventBus.on("player:death",()=>{this.playSound("death")}),this.eventBus.on("game:levelComplete",()=>{this.playSound("levelComplete")}),this.eventBus.on("game:gameOver",()=>{this.playSound("gameOver")}),this.eventBus.on("achievement:unlocked",()=>{this.playSound("achievement")}),window.addEventListener("beforeunload",this.cleanup),document.addEventListener("visibilitychange",()=>{document.hidden?this.pauseMusic():this.resumeMusic()})}handleSettingsChange(t){const{path:e,value:i}=t;switch(e){case"audio.masterVolume":this.setMasterVolume(i);break;case"audio.musicVolume":this.setMusicVolume(i);break;case"audio.sfxVolume":this.setSfxVolume(i);break;case"audio.muteAll":i?this.muteAll():this.unmuteAll();break;case"audio.muteMusic":i?this.muteMusic():this.unmuteMusic();break;case"audio.muteSfx":i?this.muteSfx():this.unmuteSfx()}}async loadDefaultAssets(){const t=["jump","collect","damage","death","levelComplete","gameOver","achievement","buttonClick","buttonHover","error"],e=["mainTheme","menuTheme","gameplayTheme","victoryTheme"];for(const i of t)await this.loadSound(i,this.generatePlaceholderAudio(i));for(const i of e)await this.loadMusic(i,this.generatePlaceholderAudio(i,!0));this.logger.info("Default audio assets loaded")}generatePlaceholderAudio(t,e=!1){const i=44100,s=i*(e?30:1),u=new ArrayBuffer(44+2*s),o=new DataView(u),n=(t,e)=>{for(let i=0;i<e.length;i++)o.setUint8(t+i,e.charCodeAt(i))};n(0,"RIFF"),o.setUint32(4,36+2*s,!0),n(8,"WAVE"),n(12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,1,!0),o.setUint32(24,i,!0),o.setUint32(28,88200,!0),o.setUint16(32,2,!0),o.setUint16(34,16,!0),n(36,"data"),o.setUint32(40,2*s,!0);for(let d=0;d<s;d++){const t=.1*Math.sin(2*Math.PI*440*d/i);o.setInt16(44+2*d,32767*t,!0)}const a=new Blob([u],{type:"audio/wav"});return URL.createObjectURL(a)}async loadSound(t,e){try{const i=new Audio(e);i.preload="auto",i.volume=this.audioSettings.sfxVolume*this.audioSettings.masterVolume,await new Promise((t,e)=>{i.addEventListener("canplaythrough",t),i.addEventListener("error",e)}),this.sounds.set(t,i),this.logger.debug(`Sound loaded: ${t}`)}catch(i){throw this.logger.error(`Failed to load sound ${t}:`,i),i}}async loadMusic(t,e){try{const i=new Audio(e);i.preload="auto",i.loop=!0,i.volume=this.audioSettings.musicVolume*this.audioSettings.masterVolume,await new Promise((t,e)=>{i.addEventListener("canplaythrough",t),i.addEventListener("error",e)}),this.music.set(t,i),this.logger.debug(`Music loaded: ${t}`)}catch(i){throw this.logger.error(`Failed to load music ${t}:`,i),i}}playSound(t,e=1){if(!this.isInitialized)return void this.logger.warn("AudioSystem not initialized, cannot play sound");if(this.audioSettings.muteAll||this.audioSettings.muteSfx)return;const i=this.sounds.get(t);if(i)try{const s=i.cloneNode();s.volume=i.volume*e,s.play(),this.eventBus.emit("audio:soundPlayed",{name:t,volume:e}),this.logger.debug(`Playing sound: ${t}`)}catch(s){this.logger.error(`Failed to play sound ${t}:`,s)}else this.logger.warn(`Sound not found: ${t}`)}playMusic(t,e=!0){if(!this.isInitialized)return void this.logger.warn("AudioSystem not initialized, cannot play music");if(this.audioSettings.muteAll||this.audioSettings.muteMusic)return;const i=this.music.get(t);if(i)try{this.currentMusic&&this.currentMusic!==i&&this.stopMusic(),this.currentMusic=i,e?(i.volume=0,i.play(),this.fadeIn(i)):i.play(),this.eventBus.emit("audio:musicStarted",{name:t}),this.logger.debug(`Playing music: ${t}`)}catch(s){this.logger.error(`Failed to play music ${t}:`,s)}else this.logger.warn(`Music not found: ${t}`)}stopMusic(){this.currentMusic&&(this.currentMusic.pause(),this.currentMusic.currentTime=0,this.eventBus.emit("audio:musicStopped"),this.logger.debug("Music stopped"))}pauseMusic(){this.currentMusic&&!this.currentMusic.paused&&(this.currentMusic.pause(),this.eventBus.emit("audio:musicPaused"),this.logger.debug("Music paused"))}resumeMusic(){this.currentMusic&&this.currentMusic.paused&&(this.currentMusic.play(),this.eventBus.emit("audio:musicResumed"),this.logger.debug("Music resumed"))}fadeIn(t,e=2e3){const i=Date.now(),s=t.volume,u=this.audioSettings.musicVolume*this.audioSettings.masterVolume,o=()=>{const n=Date.now()-i,a=Math.min(n/e,1);t.volume=s+(u-s)*a,a<1&&requestAnimationFrame(o)};o()}fadeOut(t,e=2e3){const i=Date.now(),s=t.volume,u=()=>{const o=Date.now()-i,n=Math.min(o/e,1);t.volume=s*(1-n),n<1?requestAnimationFrame(u):(t.pause(),t.currentTime=0)};u()}setMasterVolume(t){this.audioSettings.masterVolume=Math.max(0,Math.min(1,t)),this.updateAllVolumes(),this.eventBus.emit("audio:masterVolumeChanged",this.audioSettings.masterVolume),this.logger.debug(`Master volume set to: ${this.audioSettings.masterVolume}`)}setMusicVolume(t){this.audioSettings.musicVolume=Math.max(0,Math.min(1,t)),this.updateMusicVolumes(),this.eventBus.emit("audio:musicVolumeChanged",this.audioSettings.musicVolume),this.logger.debug(`Music volume set to: ${this.audioSettings.musicVolume}`)}setSfxVolume(t){this.audioSettings.sfxVolume=Math.max(0,Math.min(1,t)),this.updateSfxVolumes(),this.eventBus.emit("audio:sfxVolumeChanged",this.audioSettings.sfxVolume),this.logger.debug(`SFX volume set to: ${this.audioSettings.sfxVolume}`)}updateAllVolumes(){this.updateMusicVolumes(),this.updateSfxVolumes()}updateMusicVolumes(){const t=this.audioSettings.musicVolume*this.audioSettings.masterVolume;for(const e of this.music.values())e.volume=t}updateSfxVolumes(){const t=this.audioSettings.sfxVolume*this.audioSettings.masterVolume;for(const e of this.sounds.values())e.volume=t}muteAll(){this.audioSettings.muteAll=!0,this.updateAllVolumes(),this.eventBus.emit("audio:muted",{type:"all"}),this.logger.debug("All audio muted")}unmuteAll(){this.audioSettings.muteAll=!1,this.updateAllVolumes(),this.eventBus.emit("audio:unmuted",{type:"all"}),this.logger.debug("All audio unmuted")}muteMusic(){this.audioSettings.muteMusic=!0,this.updateMusicVolumes(),this.eventBus.emit("audio:muted",{type:"music"}),this.logger.debug("Music muted")}unmuteMusic(){this.audioSettings.muteMusic=!1,this.updateMusicVolumes(),this.eventBus.emit("audio:unmuted",{type:"music"}),this.logger.debug("Music unmuted")}muteSfx(){this.audioSettings.muteSfx=!0,this.updateSfxVolumes(),this.eventBus.emit("audio:muted",{type:"sfx"}),this.logger.debug("SFX muted")}unmuteSfx(){this.audioSettings.muteSfx=!1,this.updateSfxVolumes(),this.eventBus.emit("audio:unmuted",{type:"sfx"}),this.logger.debug("SFX unmuted")}getAudioSettings(){return{...this.audioSettings}}setAudioSettings(t){this.audioSettings={...this.audioSettings,...t},this.updateAllVolumes(),this.eventBus.emit("audio:settingsChanged",this.audioSettings),this.logger.debug("Audio settings updated")}getLoadedSounds(){return Array.from(this.sounds.keys())}getLoadedMusic(){return Array.from(this.music.keys())}isPlaying(t,e="sound"){const i="music"===e?this.music.get(t):this.sounds.get(t);return i&&!i.paused}cleanup(){this.stopMusic(),this.audioContext&&this.audioContext.close(),this.sounds.clear(),this.music.clear(),this.eventBus.emit("audio:cleanup"),this.logger.info("AudioSystem cleaned up")}})}}});
//# sourceMappingURL=game-systems-legacy-3fF6kSha.js.map
