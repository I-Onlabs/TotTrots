class e{constructor(e={}){if(this.eventBus=e.eventBus,this.logger=e.logger,this.config=e.config,!this.eventBus)throw new Error("GameManager requires eventBus dependency");if(!this.logger)throw new Error("GameManager requires logger dependency");this.state={currentLevel:1,maxLevel:10,score:0,highScore:0,lives:3,levelStartTime:null,levelCompleted:!1,gameOver:!1},this.levelConfigs=this.initializeLevelConfigs(),this.setupEventHandlers(),this.logger.info("GameManager initialized")}async initialize(){this.logger.info("Initializing GameManager..."),await this.loadGameData(),this.setupLevel(this.state.currentLevel),this.logger.info("GameManager initialized successfully")}cleanup(){this.logger.info("Cleaning up GameManager..."),this.saveGameData(),this.removeEventHandlers(),this.logger.info("GameManager cleaned up")}update(e,t){if(this.state.levelStartTime&&!this.state.levelCompleted){const e=Date.now()-this.state.levelStartTime,t=this.levelConfigs[this.state.currentLevel-1];t.timeLimit&&e>t.timeLimit&&this.handleLevelTimeout()}this.updateLevelSpecificLogic(e,t)}setupEventHandlers(){this.eventBus.on("player:scoreChanged",this.handleScoreChange.bind(this)),this.eventBus.on("player:damaged",this.handlePlayerDamaged.bind(this)),this.eventBus.on("player:itemCollected",this.handleItemCollected.bind(this)),this.eventBus.on("player:levelCompleted",this.handleLevelCompleted.bind(this)),this.eventBus.on("game:input",this.handleGameInput.bind(this)),this.eventBus.on("game:configChanged",this.handleConfigChange.bind(this)),this.eventBus.on("achievement:unlocked",this.handleAchievementUnlock.bind(this)),this.eventBus.on("dailyChallenge:completed",this.handleDailyChallengeCompletion.bind(this))}removeEventHandlers(){this.eventBus.off("player:scoreChanged",this.handleScoreChange.bind(this)),this.eventBus.off("player:damaged",this.handlePlayerDamaged.bind(this)),this.eventBus.off("player:itemCollected",this.handleItemCollected.bind(this)),this.eventBus.off("player:levelCompleted",this.handleLevelCompleted.bind(this)),this.eventBus.off("game:input",this.handleGameInput.bind(this)),this.eventBus.removeListener("game:configChanged",this.handleConfigChange.bind(this)),this.eventBus.removeListener("achievement:unlocked",this.handleAchievementUnlock.bind(this)),this.eventBus.removeListener("dailyChallenge:completed",this.handleDailyChallengeCompletion.bind(this))}initializeLevelConfigs(){return[{timeLimit:6e4,targetScore:1e3,difficulty:"easy"},{timeLimit:9e4,targetScore:2500,difficulty:"easy"},{timeLimit:12e4,targetScore:5e3,difficulty:"medium"},{timeLimit:15e4,targetScore:7500,difficulty:"medium"},{timeLimit:18e4,targetScore:1e4,difficulty:"hard"},{timeLimit:2e5,targetScore:15e3,difficulty:"hard"},{timeLimit:22e4,targetScore:2e4,difficulty:"expert"},{timeLimit:24e4,targetScore:25e3,difficulty:"expert"},{timeLimit:26e4,targetScore:3e4,difficulty:"master"},{timeLimit:3e5,targetScore:4e4,difficulty:"master"}]}setupLevel(e){this.state.currentLevel=e,this.state.levelStartTime=Date.now(),this.state.levelCompleted=!1,this.state.gameOver=!1;const t=this.levelConfigs[e-1];t?(this.logger.info("Setting up level ".concat(e," (").concat(t.difficulty,")")),this.eventBus.emit("level:started",{level:e,config:t,timestamp:Date.now()})):this.logger.error("Invalid level number: ".concat(e))}handleScoreChange(e){this.state.score+=e.scoreChange||0,this.state.score>this.state.highScore&&(this.state.highScore=this.state.score);const t=this.levelConfigs[this.state.currentLevel-1];t&&this.state.score>=t.targetScore&&!this.state.levelCompleted&&this.completeLevel(),this.eventBus.emit("game:scoreUpdated",{score:this.state.score,highScore:this.state.highScore,timestamp:Date.now()})}handlePlayerDamaged(e){this.state.lives-=e.damage||1,this.state.lives<=0?this.gameOver():this.eventBus.emit("game:livesUpdated",{lives:this.state.lives,timestamp:Date.now()})}handleItemCollected(e){const t=e.scoreValue||0;this.handleScoreChange({scoreChange:t}),this.logger.info("Item collected: ".concat(e.itemType,", +").concat(t," points"))}handleLevelCompleted(e){this.completeLevel()}completeLevel(){if(this.state.levelCompleted)return;this.state.levelCompleted=!0;const e=Date.now()-this.state.levelStartTime;this.logger.info("Level ".concat(this.state.currentLevel," completed in ").concat(e,"ms")),this.eventBus.emit("level:completed",{level:this.state.currentLevel,score:this.state.score,time:e,timestamp:Date.now()}),this.state.currentLevel>=this.state.maxLevel?this.completeGame():setTimeout(()=>{this.setupLevel(this.state.currentLevel+1)},2e3)}handleLevelTimeout(){this.logger.info("Level ".concat(this.state.currentLevel," timed out")),this.eventBus.emit("level:timeout",{level:this.state.currentLevel,timestamp:Date.now()}),this.handlePlayerDamaged({damage:1}),this.state.gameOver||this.setupLevel(this.state.currentLevel)}completeGame(){this.logger.info("Game completed!"),this.eventBus.emit("game:completed",{finalScore:this.state.score,finalLevel:this.state.currentLevel,timestamp:Date.now()})}gameOver(){this.state.gameOver=!0,this.logger.info("Game Over"),this.eventBus.emit("game:gameOver",{finalScore:this.state.score,finalLevel:this.state.currentLevel,timestamp:Date.now()})}handleGameInput(e){switch(e.type){case"restart":this.restartGame();break;case"nextLevel":this.state.levelCompleted&&this.setupLevel(this.state.currentLevel+1);break;case"pause":this.eventBus.emit("game:pauseRequested",{timestamp:Date.now()})}}handleConfigChange(e){this.config={...this.config,...e.config},this.logger.info("GameManager config updated")}handleAchievementUnlock(e){const t=e.bonusScore||0;t>0&&this.handleScoreChange({scoreChange:t}),e.effects&&this.applyAchievementEffects(e.effects)}handleDailyChallengeCompletion(e){const t=e.bonusScore||0;t>0&&this.handleScoreChange({scoreChange:t}),e.effects&&this.applyChallengeEffects(e.effects)}applyAchievementEffects(e){e.extraLives&&(this.state.lives+=e.extraLives),e.scoreMultiplier&&(this.temporaryScoreMultiplier=e.scoreMultiplier,setTimeout(()=>{this.temporaryScoreMultiplier=1},e.duration||3e4))}applyChallengeEffects(e){e.temporaryPowerUp&&this.eventBus.emit("game:powerUpActivated",{type:e.temporaryPowerUp,duration:e.duration||3e4,timestamp:Date.now()})}restartGame(){this.state={currentLevel:1,maxLevel:10,score:0,highScore:this.state.highScore,lives:3,levelStartTime:null,levelCompleted:!1,gameOver:!1},this.setupLevel(1),this.eventBus.emit("game:restarted",{timestamp:Date.now()})}updateLevelSpecificLogic(e,t){const i=this.levelConfigs[this.state.currentLevel-1];i&&i.difficulty}async loadGameData(){try{const e=localStorage.getItem("gameData");if(e){const t=JSON.parse(e);this.state.highScore=t.highScore||0,this.logger.info("Game data loaded from storage")}}catch(e){this.logger.error("Failed to load game data:",e)}}saveGameData(){try{const e={highScore:this.state.highScore,lastPlayed:Date.now()};localStorage.setItem("gameData",JSON.stringify(e)),this.logger.info("Game data saved to storage")}catch(e){this.logger.error("Failed to save game data:",e)}}getState(){return{...this.state}}getLevelConfig(e){return this.levelConfigs[e-1]}setLevelConfig(e,t){e>=1&&e<=this.levelConfigs.length&&(this.levelConfigs[e-1]={...this.levelConfigs[e-1],...t})}}class t{constructor(e={}){if(this.eventBus=e.eventBus,this.logger=e.logger,this.gameState=e.gameState,!this.eventBus)throw new Error("AchievementManager requires eventBus dependency");if(!this.logger)throw new Error("AchievementManager requires logger dependency");this.achievements=new Map,this.unlockedAchievements=new Set,this.progress=new Map,this.initializeAchievements(),this.setupEventHandlers(),this.logger.info("AchievementManager initialized")}async initialize(){this.logger.info("Initializing AchievementManager..."),await this.loadAchievementData(),this.logger.info("AchievementManager initialized successfully")}cleanup(){this.logger.info("Cleaning up AchievementManager..."),this.saveAchievementData(),this.removeEventHandlers(),this.logger.info("AchievementManager cleaned up")}update(e,t){this.checkTimeBasedAchievements(t),this.checkComboAchievements(t)}initializeAchievements(){this.defineAchievement("first_score",{name:"First Steps",description:"Score your first 100 points",type:"score",target:100,reward:{score:50,title:"Beginner"},icon:"star"}),this.defineAchievement("score_master",{name:"Score Master",description:"Reach 10,000 points",type:"score",target:1e4,reward:{score:500,title:"Score Master"},icon:"trophy"}),this.defineAchievement("high_score_king",{name:"High Score King",description:"Reach 50,000 points",type:"score",target:5e4,reward:{score:2e3,title:"High Score King"},icon:"crown"}),this.defineAchievement("level_5",{name:"Level 5 Complete",description:"Complete level 5",type:"level",target:5,reward:{extraLives:1,title:"Level 5 Veteran"},icon:"medal"}),this.defineAchievement("level_10",{name:"Level 10 Complete",description:"Complete level 10",type:"level",target:10,reward:{score:1e3,title:"Level 10 Master"},icon:"diamond"}),this.defineAchievement("collector",{name:"Collector",description:"Collect 50 items",type:"collection",target:50,reward:{score:300,title:"Collector"},icon:"bag"}),this.defineAchievement("hoarder",{name:"Hoarder",description:"Collect 200 items",type:"collection",target:200,reward:{score:1e3,title:"Hoarder"},icon:"treasure"}),this.defineAchievement("speed_demon",{name:"Speed Demon",description:"Complete a level in under 30 seconds",type:"speed",target:3e4,reward:{score:500,title:"Speed Demon"},icon:"lightning"}),this.defineAchievement("marathon_runner",{name:"Marathon Runner",description:"Play for 30 minutes straight",type:"playtime",target:18e5,reward:{score:1e3,title:"Marathon Runner"},icon:"clock"}),this.defineAchievement("combo_master",{name:"Combo Master",description:"Achieve a 10x combo",type:"combo",target:10,reward:{score:200,title:"Combo Master"},icon:"fire"}),this.defineAchievement("combo_legend",{name:"Combo Legend",description:"Achieve a 25x combo",type:"combo",target:25,reward:{score:1e3,title:"Combo Legend"},icon:"explosion"}),this.defineAchievement("perfect_level",{name:"Perfect Level",description:"Complete a level without taking damage",type:"perfect",target:1,reward:{score:750,title:"Perfect Player"},icon:"shield"}),this.defineAchievement("comeback_kid",{name:"Comeback Kid",description:"Complete a level with only 1 life remaining",type:"comeback",target:1,reward:{score:500,title:"Comeback Kid"},icon:"heart"})}defineAchievement(e,t){this.achievements.set(e,{id:e,...t,unlocked:!1,unlockedAt:null,progress:0}),this.progress.set(e,0)}setupEventHandlers(){this.eventBus.on("player:scoreChanged",this.handleScoreChange.bind(this)),this.eventBus.on("player:levelCompleted",this.handleLevelCompleted.bind(this)),this.eventBus.on("player:itemCollected",this.handleItemCollected.bind(this)),this.eventBus.on("game:started",this.handleGameStarted.bind(this)),this.eventBus.on("level:completed",this.handleLevelCompleted.bind(this)),this.eventBus.on("player:comboChanged",this.handleComboChanged.bind(this)),this.eventBus.on("player:damaged",this.handlePlayerDamaged.bind(this))}removeEventHandlers(){this.eventBus.removeListener("player:scoreChanged",this.handleScoreChange.bind(this)),this.eventBus.removeListener("player:levelCompleted",this.handleLevelCompleted.bind(this)),this.eventBus.removeListener("player:itemCollected",this.handleItemCollected.bind(this)),this.eventBus.removeListener("game:started",this.handleGameStarted.bind(this)),this.eventBus.removeListener("level:completed",this.handleLevelCompleted.bind(this)),this.eventBus.removeListener("player:comboChanged",this.handleComboChanged.bind(this)),this.eventBus.removeListener("player:damaged",this.handlePlayerDamaged.bind(this))}handleScoreChange(e){const t=this.gameState().score;this.checkScoreAchievements(t)}handleLevelCompleted(e){this.checkLevelAchievements(e.level),this.checkSpeedAchievements(e.time),this.checkPerfectLevelAchievements(e)}handleItemCollected(e){this.checkCollectionAchievements(e.itemType)}handleGameStarted(e){this.gameStartTime=e.timestamp}handleComboChanged(e){this.checkComboAchievements(e.combo)}handlePlayerDamaged(e){this.currentLevelPerfect=!1}checkScoreAchievements(e){this.checkAchievementsByType("score",e)}checkLevelAchievements(e){this.checkAchievementsByType("level",e)}checkCollectionAchievements(e){const t=this.progress.get("collector")||0;this.progress.set("collector",t+1),this.checkAchievementsByType("collection",this.progress.get("collector"))}checkSpeedAchievements(e){this.checkAchievementsByType("speed",e)}checkComboAchievements(e){this.checkAchievementsByType("combo",e)}checkTimeBasedAchievements(e){if(this.gameStartTime){const e=Date.now()-this.gameStartTime;this.checkAchievementsByType("playtime",e)}}checkComboAchievements(e){}checkPerfectLevelAchievements(e){e.perfect&&this.checkAchievementsByType("perfect",1)}checkAchievementsByType(e,t){for(const[i,s]of this.achievements)s.type!==e||s.unlocked||(t>=s.target?this.unlockAchievement(i):(this.progress.set(i,t),s.progress=t))}unlockAchievement(e){const t=this.achievements.get(e);t&&!t.unlocked&&(t.unlocked=!0,t.unlockedAt=Date.now(),this.unlockedAchievements.add(e),this.logger.info("Achievement unlocked: ".concat(t.name)),this.eventBus.emit("achievement:unlocked",{id:e,name:t.name,description:t.description,reward:t.reward,icon:t.icon,timestamp:Date.now()}),this.applyAchievementReward(t))}applyAchievementReward(e){if(!e.reward)return;const t=e.reward;t.score&&this.eventBus.emit("player:scoreChanged",{scoreChange:t.score,source:"achievement",achievementId:e.id}),t.extraLives&&this.eventBus.emit("player:livesChanged",{livesChange:t.extraLives,source:"achievement",achievementId:e.id}),t.title&&this.eventBus.emit("player:titleChanged",{title:t.title,source:"achievement",achievementId:e.id}),t.effects&&this.eventBus.emit("game:achievementEffect",{effects:t.effects,achievementId:e.id})}getAchievement(e){return this.achievements.get(e)}getAllAchievements(){return Array.from(this.achievements.values())}getUnlockedAchievements(){return Array.from(this.achievements.values()).filter(e=>e.unlocked)}getAchievementProgress(e){const t=this.achievements.get(e);return t?{id:e,name:t.name,description:t.description,progress:t.progress,target:t.target,percentage:Math.min(t.progress/t.target*100,100),unlocked:t.unlocked}:null}getAllAchievementProgress(){const e=[];for(const[t,i]of this.achievements)e.push(this.getAchievementProgress(t));return e}async loadAchievementData(){try{const e=localStorage.getItem("achievementData");if(e){const t=JSON.parse(e);if(t.unlocked&&t.unlocked.forEach(e=>{this.achievements.has(e)&&(this.achievements.get(e).unlocked=!0,this.unlockedAchievements.add(e))}),t.progress)for(const[e,i]of Object.entries(t.progress))this.achievements.has(e)&&(this.achievements.get(e).progress=i,this.progress.set(e,i));this.logger.info("Achievement data loaded from storage")}}catch(e){this.logger.error("Failed to load achievement data:",e)}}saveAchievementData(){try{const e={unlocked:Array.from(this.unlockedAchievements),progress:Object.fromEntries(this.progress)};localStorage.setItem("achievementData",JSON.stringify(e)),this.logger.info("Achievement data saved to storage")}catch(e){this.logger.error("Failed to save achievement data:",e)}}resetAchievements(){this.unlockedAchievements.clear(),this.progress.clear();for(const[e,t]of this.achievements)t.unlocked=!1,t.unlockedAt=null,t.progress=0,this.progress.set(e,0);this.logger.info("All achievements reset")}}class i{constructor(e={}){if(this.eventBus=e.eventBus,this.logger=e.logger,this.gameState=e.gameState,!this.eventBus)throw new Error("DailyChallengeManager requires eventBus dependency");if(!this.logger)throw new Error("DailyChallengeManager requires logger dependency");this.challenges=new Map,this.activeChallenges=[],this.completedChallenges=new Set,this.challengeProgress=new Map,this.lastChallengeDate=null,this.challengeTemplates=this.initializeChallengeTemplates(),this.setupEventHandlers(),this.logger.info("DailyChallengeManager initialized")}async initialize(){this.logger.info("Initializing DailyChallengeManager..."),await this.loadChallengeData(),this.generateDailyChallenges(),this.logger.info("DailyChallengeManager initialized successfully")}cleanup(){this.logger.info("Cleaning up DailyChallengeManager..."),this.saveChallengeData(),this.removeEventHandlers(),this.logger.info("DailyChallengeManager cleaned up")}update(e,t){this.checkDailyChallengeRotation(),this.updateChallengeProgress(t)}initializeChallengeTemplates(){return{score:[{name:"Score Hunter",description:"Score {target} points in a single game",type:"score",difficulty:"easy",target:1e3,reward:{score:200,coins:10}},{name:"Score Master",description:"Score {target} points in a single game",type:"score",difficulty:"medium",target:5e3,reward:{score:500,coins:25}},{name:"Score Legend",description:"Score {target} points in a single game",type:"score",difficulty:"hard",target:15e3,reward:{score:1e3,coins:50}}],level:[{name:"Level Climber",description:"Reach level {target}",type:"level",difficulty:"easy",target:3,reward:{score:300,coins:15}},{name:"Level Master",description:"Reach level {target}",type:"level",difficulty:"medium",target:7,reward:{score:750,coins:35}},{name:"Level Legend",description:"Reach level {target}",type:"level",difficulty:"hard",target:10,reward:{score:1500,coins:75}}],collection:[{name:"Item Collector",description:"Collect {target} items in a single game",type:"collection",difficulty:"easy",target:10,reward:{score:150,coins:8}},{name:"Item Hoarder",description:"Collect {target} items in a single game",type:"collection",difficulty:"medium",target:25,reward:{score:400,coins:20}},{name:"Item Master",description:"Collect {target} items in a single game",type:"collection",difficulty:"hard",target:50,reward:{score:800,coins:40}}],combo:[{name:"Combo Starter",description:"Achieve a {target}x combo",type:"combo",difficulty:"easy",target:5,reward:{score:100,coins:5}},{name:"Combo Master",description:"Achieve a {target}x combo",type:"combo",difficulty:"medium",target:15,reward:{score:300,coins:15}},{name:"Combo Legend",description:"Achieve a {target}x combo",type:"combo",difficulty:"hard",target:30,reward:{score:600,coins:30}}],time:[{name:"Speed Runner",description:"Complete a level in under {target} seconds",type:"time",difficulty:"easy",target:60,reward:{score:200,coins:10}},{name:"Speed Master",description:"Complete a level in under {target} seconds",type:"time",difficulty:"medium",target:30,reward:{score:500,coins:25}},{name:"Speed Legend",description:"Complete a level in under {target} seconds",type:"time",difficulty:"hard",target:15,reward:{score:1e3,coins:50}}],survival:[{name:"Survivor",description:"Complete {target} levels without dying",type:"survival",difficulty:"easy",target:3,reward:{score:400,coins:20}},{name:"Survival Master",description:"Complete {target} levels without dying",type:"survival",difficulty:"medium",target:7,reward:{score:1e3,coins:50}},{name:"Survival Legend",description:"Complete {target} levels without dying",type:"survival",difficulty:"hard",target:10,reward:{score:2e3,coins:100}}]}}setupEventHandlers(){this.eventBus.on("player:scoreChanged",this.handleScoreChange.bind(this)),this.eventBus.on("player:levelCompleted",this.handleLevelCompleted.bind(this)),this.eventBus.on("player:itemCollected",this.handleItemCollected.bind(this)),this.eventBus.on("player:comboChanged",this.handleComboChanged.bind(this)),this.eventBus.on("game:started",this.handleGameStarted.bind(this)),this.eventBus.on("level:completed",this.handleLevelCompleted.bind(this)),this.eventBus.on("player:damaged",this.handlePlayerDamaged.bind(this))}removeEventHandlers(){this.eventBus.removeListener("player:scoreChanged",this.handleScoreChange.bind(this)),this.eventBus.removeListener("player:levelCompleted",this.handleLevelCompleted.bind(this)),this.eventBus.removeListener("player:itemCollected",this.handleItemCollected.bind(this)),this.eventBus.removeListener("player:comboChanged",this.handleComboChanged.bind(this)),this.eventBus.removeListener("game:started",this.handleGameStarted.bind(this)),this.eventBus.removeListener("level:completed",this.handleLevelCompleted.bind(this)),this.eventBus.removeListener("player:damaged",this.handlePlayerDamaged.bind(this))}generateDailyChallenges(){const e=(new Date).toDateString();if(this.lastChallengeDate===e)return;this.activeChallenges=[],this.completedChallenges.clear(),this.challengeProgress.clear();const t=Object.keys(this.challengeTemplates);this.getRandomElements(t,3).forEach((e,t)=>{const i=this.getRandomElement(this.challengeTemplates[e]),s=this.createChallenge(i,t);this.activeChallenges.push(s),this.challenges.set(s.id,s)}),this.lastChallengeDate=e,this.logger.info("Generated ".concat(this.activeChallenges.length," daily challenges for ").concat(e)),this.eventBus.emit("dailyChallenges:generated",{challenges:this.activeChallenges,date:e,timestamp:Date.now()})}createChallenge(e,t){return{id:"daily_".concat(Date.now(),"_").concat(t),name:e.name,description:e.description.replace("{target}",e.target),type:e.type,difficulty:e.difficulty,target:e.target,reward:e.reward,progress:0,completed:!1,completedAt:null,createdAt:Date.now()}}checkDailyChallengeRotation(){const e=(new Date).toDateString();this.lastChallengeDate!==e&&this.generateDailyChallenges()}updateChallengeProgress(e){}handleScoreChange(e){this.checkScoreChallenges(e.score)}handleLevelCompleted(e){this.checkLevelChallenges(e.level),this.checkTimeChallenges(e.time),this.checkSurvivalChallenges(e)}handleItemCollected(e){this.checkCollectionChallenges(e.itemType)}handleComboChanged(e){this.checkComboChallenges(e.combo)}handleGameStarted(e){this.gameStartTime=e.timestamp,this.currentGameScore=0,this.currentGameLevel=0,this.currentGameItems=0,this.currentGameCombo=0,this.survivalCount=0}handlePlayerDamaged(e){this.survivalCount=0}checkScoreChallenges(e){this.currentGameScore=e,this.checkChallengesByType("score",e)}checkLevelChallenges(e){this.currentGameLevel=e,this.checkChallengesByType("level",e)}checkCollectionChallenges(e){this.currentGameItems++,this.checkChallengesByType("collection",this.currentGameItems)}checkComboChallenges(e){this.currentGameCombo=e,this.checkChallengesByType("combo",e)}checkTimeChallenges(e){const t=Math.floor(e/1e3);this.checkChallengesByType("time",t)}checkSurvivalChallenges(e){this.survivalCount++,this.checkChallengesByType("survival",this.survivalCount)}checkChallengesByType(e,t){for(const i of this.activeChallenges)i.type!==e||i.completed||(t>=i.target?this.completeChallenge(i.id):(i.progress=t,this.challengeProgress.set(i.id,t)))}completeChallenge(e){const t=this.challenges.get(e);t&&!t.completed&&(t.completed=!0,t.completedAt=Date.now(),this.completedChallenges.add(e),this.logger.info("Daily challenge completed: ".concat(t.name)),this.eventBus.emit("dailyChallenge:completed",{id:e,name:t.name,description:t.description,reward:t.reward,timestamp:Date.now()}),this.applyChallengeReward(t))}applyChallengeReward(e){if(!e.reward)return;const t=e.reward;t.score&&this.eventBus.emit("player:scoreChanged",{scoreChange:t.score,source:"dailyChallenge",challengeId:e.id}),t.coins&&this.eventBus.emit("player:coinsChanged",{coinsChange:t.coins,source:"dailyChallenge",challengeId:e.id}),t.effects&&this.eventBus.emit("game:challengeEffect",{effects:t.effects,challengeId:e.id})}getActiveChallenges(){return this.activeChallenges.filter(e=>!e.completed)}getCompletedChallenges(){return this.activeChallenges.filter(e=>e.completed)}getAllChallenges(){return this.activeChallenges}getChallengeProgress(e){const t=this.challenges.get(e);return t?{id:e,name:t.name,description:t.description,progress:t.progress,target:t.target,percentage:Math.min(t.progress/t.target*100,100),completed:t.completed,difficulty:t.difficulty,reward:t.reward}:null}getAllChallengeProgress(){const e=[];for(const t of this.activeChallenges)e.push(this.getChallengeProgress(t.id));return e}getRandomElements(e,t){return e.sort(()=>.5-Math.random()).slice(0,t)}getRandomElement(e){return e[Math.floor(Math.random()*e.length)]}async loadChallengeData(){try{const e=localStorage.getItem("dailyChallengeData");if(e){const t=JSON.parse(e);if(this.lastChallengeDate=t.lastChallengeDate,t.completed&&t.completed.forEach(e=>{this.completedChallenges.add(e)}),t.progress)for(const[e,i]of Object.entries(t.progress))this.challengeProgress.set(e,i);this.logger.info("Daily challenge data loaded from storage")}}catch(e){this.logger.error("Failed to load daily challenge data:",e)}}saveChallengeData(){try{const e={lastChallengeDate:this.lastChallengeDate,completed:Array.from(this.completedChallenges),progress:Object.fromEntries(this.challengeProgress)};localStorage.setItem("dailyChallengeData",JSON.stringify(e)),this.logger.info("Daily challenge data saved to storage")}catch(e){this.logger.error("Failed to save daily challenge data:",e)}}resetChallenges(){this.activeChallenges=[],this.completedChallenges.clear(),this.challengeProgress.clear(),this.lastChallengeDate=null,this.logger.info("All daily challenges reset")}}class s{constructor(e={}){if(this.eventBus=e.eventBus,this.logger=e.logger,this.gameState=e.gameState,!this.eventBus)throw new Error("AccessibilityManager requires eventBus dependency");if(!this.logger)throw new Error("AccessibilityManager requires logger dependency");this.settings={screenReader:!1,highContrast:!1,colorblindMode:"none",keyboardNavigation:!1,audioCues:!0,audioDescriptions:!1,textScaling:1,motionReduction:!1,reducedAnimations:!1,largeText:!1,focusIndicators:!0},this.audioContext=null,this.audioEnabled=!0,this.announcements=[],this.announcementQueue=[],this.setupEventHandlers(),this.logger.info("AccessibilityManager initialized")}async initialize(){this.logger.info("Initializing AccessibilityManager..."),await this.loadAccessibilitySettings(),this.initializeAudio(),this.setupDOMAccessibility(),this.logger.info("AccessibilityManager initialized successfully")}cleanup(){this.logger.info("Cleaning up AccessibilityManager..."),this.saveAccessibilitySettings(),this.removeEventHandlers(),this.audioContext&&this.audioContext.close(),this.logger.info("AccessibilityManager cleaned up")}update(e,t){this.processAnnouncementQueue(),this.updateAccessibilityFeatures(t)}setupEventHandlers(){this.eventBus.on("game:started",this.handleGameStarted.bind(this)),this.eventBus.on("game:paused",this.handleGamePaused.bind(this)),this.eventBus.on("game:resumed",this.handleGameResumed.bind(this)),this.eventBus.on("game:stopped",this.handleGameStopped.bind(this)),this.eventBus.on("player:scoreChanged",this.handleScoreChanged.bind(this)),this.eventBus.on("player:damaged",this.handlePlayerDamaged.bind(this)),this.eventBus.on("player:itemCollected",this.handleItemCollected.bind(this)),this.eventBus.on("level:started",this.handleLevelStarted.bind(this)),this.eventBus.on("level:completed",this.handleLevelCompleted.bind(this)),this.eventBus.on("achievement:unlocked",this.handleAchievementUnlocked.bind(this)),this.eventBus.on("dailyChallenge:completed",this.handleDailyChallengeCompleted.bind(this)),this.eventBus.on("game:input",this.handleInput.bind(this))}removeEventHandlers(){this.eventBus.removeListener("game:started",this.handleGameStarted.bind(this)),this.eventBus.removeListener("game:paused",this.handleGamePaused.bind(this)),this.eventBus.removeListener("game:resumed",this.handleGameResumed.bind(this)),this.eventBus.removeListener("game:stopped",this.handleGameStopped.bind(this)),this.eventBus.removeListener("player:scoreChanged",this.handleScoreChanged.bind(this)),this.eventBus.removeListener("player:damaged",this.handlePlayerDamaged.bind(this)),this.eventBus.removeListener("player:itemCollected",this.handleItemCollected.bind(this)),this.eventBus.removeListener("level:started",this.handleLevelStarted.bind(this)),this.eventBus.removeListener("level:completed",this.handleLevelCompleted.bind(this)),this.eventBus.removeListener("achievement:unlocked",this.handleAchievementUnlocked.bind(this)),this.eventBus.removeListener("dailyChallenge:completed",this.handleDailyChallengeCompleted.bind(this)),this.eventBus.removeListener("game:input",this.handleInput.bind(this))}initializeAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioEnabled=!0}catch(e){this.logger.warn("Audio context not available:",e),this.audioEnabled=!1}}setupDOMAccessibility(){this.createAnnouncementRegion(),this.setupKeyboardNavigation(),this.applyAccessibilitySettings()}createAnnouncementRegion(){const e=document.createElement("div");e.id="accessibility-announcements",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.style.cssText="\n            position: absolute;\n            left: -10000px;\n            width: 1px;\n            height: 1px;\n            overflow: hidden;\n        ",document.body.appendChild(e)}setupKeyboardNavigation(){this.settings.keyboardNavigation&&document.addEventListener("keydown",e=>{this.handleKeyboardNavigation(e)})}handleKeyboardNavigation(e){if(this.settings.keyboardNavigation)switch(e.key){case"Tab":this.handleTabNavigation(e);break;case"Enter":case" ":this.handleActivation(e);break;case"Escape":this.handleEscape(e);break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":this.handleArrowNavigation(e)}}handleTabNavigation(e){document.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')}handleActivation(e){const t=document.activeElement;t&&t.click&&t.click()}handleEscape(e){this.eventBus.emit("accessibility:escape",{timestamp:Date.now()})}handleArrowNavigation(e){this.eventBus.emit("accessibility:arrowNavigation",{direction:e.key.replace("Arrow","").toLowerCase(),timestamp:Date.now()})}applyAccessibilitySettings(){const e=document.documentElement;this.settings.highContrast?e.classList.add("high-contrast"):e.classList.remove("high-contrast"),e.classList.remove("colorblind-protanopia","colorblind-deuteranopia","colorblind-tritanopia"),"none"!==this.settings.colorblindMode&&e.classList.add("colorblind-".concat(this.settings.colorblindMode)),e.style.setProperty("--text-scale",this.settings.textScaling),this.settings.motionReduction?e.classList.add("motion-reduced"):e.classList.remove("motion-reduced"),this.settings.largeText?e.classList.add("large-text"):e.classList.remove("large-text"),this.settings.focusIndicators?e.classList.add("focus-indicators"):e.classList.remove("focus-indicators")}updateSettings(e){this.settings={...this.settings,...e},this.applyAccessibilitySettings(),this.logger.info("Accessibility settings updated"),this.eventBus.emit("accessibility:settingsChanged",{settings:this.settings,timestamp:Date.now()})}getSettings(){return{...this.settings}}announce(e,t="polite"){if(!this.settings.screenReader)return;const i={text:e,priority:t,timestamp:Date.now()};this.announcementQueue.push(i)}processAnnouncementQueue(){if(0===this.announcementQueue.length)return;const e=this.announcementQueue.shift(),t=document.getElementById("accessibility-announcements");t&&(t.setAttribute("aria-live",e.priority),t.textContent=e.text)}playAudioCue(e,t=440,i=200){if(this.settings.audioCues&&this.audioEnabled&&this.audioContext)try{const e=this.audioContext.createOscillator(),s=this.audioContext.createGain();e.connect(s),s.connect(this.audioContext.destination),e.frequency.setValueAtTime(t,this.audioContext.currentTime),e.type="sine",s.gain.setValueAtTime(0,this.audioContext.currentTime),s.gain.linearRampToValueAtTime(.1,this.audioContext.currentTime+.01),s.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+i/1e3),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+i/1e3)}catch(s){this.logger.warn("Failed to play audio cue:",s)}}handleGameStarted(e){this.announce("Game started"),this.playAudioCue("gameStart",523,300)}handleGamePaused(e){this.announce("Game paused"),this.playAudioCue("pause",330,200)}handleGameResumed(e){this.announce("Game resumed"),this.playAudioCue("resume",523,200)}handleGameStopped(e){this.announce("Game stopped"),this.playAudioCue("gameOver",220,500)}handleScoreChanged(e){e.scoreChange>0&&(this.announce("Score increased by ".concat(e.scoreChange,". Total score: ").concat(e.score)),this.playAudioCue("score",659,100))}handlePlayerDamaged(e){this.announce("Player damaged. Lives remaining: ".concat(e.lives)),this.playAudioCue("damage",220,300)}handleItemCollected(e){this.announce("Item collected: ".concat(e.itemType)),this.playAudioCue("item",880,150)}handleLevelStarted(e){this.announce("Level ".concat(e.level," started")),this.playAudioCue("levelStart",523,400)}handleLevelCompleted(e){this.announce("Level ".concat(e.level," completed in ").concat(Math.floor(e.time/1e3)," seconds")),this.playAudioCue("levelComplete",1047,600)}handleAchievementUnlocked(e){this.announce("Achievement unlocked: ".concat(e.name)),this.playAudioCue("achievement",1319,800)}handleDailyChallengeCompleted(e){this.announce("Daily challenge completed: ".concat(e.name)),this.playAudioCue("challenge",1047,500)}handleInput(e){this.settings.audioCues&&this.playAudioCue("input",440,50)}updateAccessibilityFeatures(e){e.isPaused?this.manageFocusOnPause():e.isRunning&&this.manageFocusDuringGameplay()}manageFocusOnPause(){const e=document.querySelector(".pause-menu");e&&e.focus&&e.focus()}manageFocusDuringGameplay(){const e=document.querySelector(".game-area");e&&e.focus&&e.focus()}async loadAccessibilitySettings(){try{const e=localStorage.getItem("accessibilitySettings");if(e){const t=JSON.parse(e);this.settings={...this.settings,...t},this.applyAccessibilitySettings(),this.logger.info("Accessibility settings loaded from storage")}}catch(e){this.logger.error("Failed to load accessibility settings:",e)}}saveAccessibilitySettings(){try{localStorage.setItem("accessibilitySettings",JSON.stringify(this.settings)),this.logger.info("Accessibility settings saved to storage")}catch(e){this.logger.error("Failed to save accessibility settings:",e)}}resetSettings(){this.settings={screenReader:!1,highContrast:!1,colorblindMode:"none",keyboardNavigation:!1,audioCues:!0,audioDescriptions:!1,textScaling:1,motionReduction:!1,reducedAnimations:!1,largeText:!1,focusIndicators:!0},this.applyAccessibilitySettings(),this.logger.info("Accessibility settings reset to defaults")}}export{t as A,i as D,e as G,s as a};
//# sourceMappingURL=game-managers-D_9SiR8G.js.map
