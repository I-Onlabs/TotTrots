{"version":3,"file":"game-core-legacy-DqYh4P9o.js","sources":["../../src/utils/Logger.js","../../src/utils/MobileTesting.js","../../src/ui/SettingsUI.js","../../src/GameRefactored.js"],"sourcesContent":["/**\n * Logger.js - Centralized logging system\n *\n * This class provides:\n * - Multiple log levels\n * - Log filtering and formatting\n * - Performance monitoring\n * - Log persistence\n * - Debug utilities\n */\n\nexport class Logger {\n  constructor(debug = false) {\n    this.debug = debug;\n    this.logLevel = debug ? 'debug' : 'info';\n    this.logHistory = [];\n    this.maxHistorySize = 1000;\n    this.performanceMetrics = {\n      totalLogs: 0,\n      logsByLevel: new Map(),\n      averageLogTime: 0,\n    };\n\n    // Log levels\n    this.levels = {\n      error: 0,\n      warn: 1,\n      info: 2,\n      debug: 3,\n      trace: 4,\n    };\n\n    // Initialize performance monitoring\n    this.startTime = Date.now();\n  }\n\n  /**\n   * Set log level\n   */\n  setLevel(level) {\n    if (Object.prototype.hasOwnProperty.call(this.levels, level)) {\n      this.logLevel = level;\n    } else {\n      this.warn(`Invalid log level: ${level}`);\n    }\n  }\n\n  /**\n   * Enable debug mode\n   */\n  enableDebug() {\n    this.debug = true;\n    this.setLevel('debug');\n  }\n\n  /**\n   * Disable debug mode\n   */\n  disableDebug() {\n    this.debug = false;\n    this.setLevel('info');\n  }\n\n  /**\n   * Check if log level should be processed\n   */\n  shouldLog(level) {\n    return this.levels[level] <= this.levels[this.logLevel];\n  }\n\n  /**\n   * Log a message\n   */\n  log(level, message, data = null, context = null) {\n    if (!this.shouldLog(level)) {\n      return;\n    }\n\n    const timestamp = Date.now();\n    const logEntry = {\n      level,\n      message,\n      data,\n      context,\n      timestamp,\n      id: this.generateLogId(),\n    };\n\n    // Add to history\n    this.addToHistory(logEntry);\n\n    // Update performance metrics\n    this.updatePerformanceMetrics(level);\n\n    // Format and output log\n    this.outputLog(logEntry);\n  }\n\n  /**\n   * Add log entry to history\n   */\n  addToHistory(logEntry) {\n    this.logHistory.push(logEntry);\n\n    // Maintain history size limit\n    if (this.logHistory.length > this.maxHistorySize) {\n      this.logHistory.shift();\n    }\n  }\n\n  /**\n   * Update performance metrics\n   */\n  updatePerformanceMetrics(level) {\n    this.performanceMetrics.totalLogs++;\n\n    const count = this.performanceMetrics.logsByLevel.get(level) || 0;\n    this.performanceMetrics.logsByLevel.set(level, count + 1);\n\n    // Update average log time\n    const totalTime =\n      this.performanceMetrics.averageLogTime *\n      (this.performanceMetrics.totalLogs - 1);\n    this.performanceMetrics.averageLogTime =\n      (totalTime + 1) / this.performanceMetrics.totalLogs;\n  }\n\n  /**\n   * Output log to console\n   */\n  outputLog(logEntry) {\n    const { level, message, data, context, timestamp } = logEntry;\n    const timeString = new Date(timestamp).toISOString();\n    const contextString = context ? `[${context}]` : '';\n    const prefix = `[${timeString}] ${level.toUpperCase()}${contextString}`;\n\n    switch (level) {\n      case 'error':\n        console.error(prefix, message, data || '');\n        break;\n      case 'warn':\n        console.warn(prefix, message, data || '');\n        break;\n      case 'info':\n        console.info(prefix, message, data || '');\n        break;\n      case 'debug':\n        console.debug(prefix, message, data || '');\n        break;\n      case 'trace':\n        console.trace(prefix, message, data || '');\n        break;\n      default:\n        console.log(prefix, message, data || '');\n    }\n  }\n\n  /**\n   * Generate unique log ID\n   */\n  generateLogId() {\n    return `log_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Error level logging\n   */\n  error(message, data = null, context = null) {\n    this.log('error', message, data, context);\n  }\n\n  /**\n   * Warning level logging\n   */\n  warn(message, data = null, context = null) {\n    this.log('warn', message, data, context);\n  }\n\n  /**\n   * Info level logging\n   */\n  info(message, data = null, context = null) {\n    this.log('info', message, data, context);\n  }\n\n  /**\n   * Debug level logging\n   */\n  debug(message, data = null, context = null) {\n    this.log('debug', message, data, context);\n  }\n\n  /**\n   * Trace level logging\n   */\n  trace(message, data = null, context = null) {\n    this.log('trace', message, data, context);\n  }\n\n  /**\n   * Log performance metrics\n   */\n  performance(operation, startTime, endTime = null) {\n    const duration = (endTime || performance.now()) - startTime;\n    this.debug(`Performance: ${operation} took ${duration.toFixed(2)}ms`);\n    return duration;\n  }\n\n  /**\n   * Log memory usage\n   */\n  memory() {\n    if (performance.memory) {\n      const memory = performance.memory;\n      this.debug('Memory usage:', {\n        used: `${Math.round(memory.usedJSHeapSize / 1024 / 1024)}MB`,\n        total: `${Math.round(memory.totalJSHeapSize / 1024 / 1024)}MB`,\n        limit: `${Math.round(memory.jsHeapSizeLimit / 1024 / 1024)}MB`,\n      });\n    }\n  }\n\n  /**\n   * Log function execution\n   */\n  function(name, fn, context = null) {\n    const startTime = performance.now();\n    this.debug(`Function started: ${name}`, null, context);\n\n    try {\n      const result = fn();\n      const duration = this.performance(name, startTime);\n      this.debug(`Function completed: ${name}`, { duration }, context);\n      return result;\n    } catch (error) {\n      const duration = this.performance(name, startTime);\n      this.error(\n        `Function failed: ${name}`,\n        { error: error.message, duration },\n        context\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Log async function execution\n   */\n  async functionAsync(name, fn, context = null) {\n    const startTime = performance.now();\n    this.debug(`Async function started: ${name}`, null, context);\n\n    try {\n      const result = await fn();\n      const duration = this.performance(name, startTime);\n      this.debug(`Async function completed: ${name}`, { duration }, context);\n      return result;\n    } catch (error) {\n      const duration = this.performance(name, startTime);\n      this.error(\n        `Async function failed: ${name}`,\n        { error: error.message, duration },\n        context\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Log event\n   */\n  event(eventName, data = null, context = null) {\n    this.debug(`Event: ${eventName}`, data, context);\n  }\n\n  /**\n   * Log state change\n   */\n  stateChange(from, to, data = null, context = null) {\n    this.info(`State changed: ${from} -> ${to}`, data, context);\n  }\n\n  /**\n   * Log user action\n   */\n  userAction(action, data = null, context = null) {\n    this.info(`User action: ${action}`, data, context);\n  }\n\n  /**\n   * Log API call\n   */\n  apiCall(method, url, data = null, context = null) {\n    this.debug(`API call: ${method} ${url}`, data, context);\n  }\n\n  /**\n   * Log API response\n   */\n  apiResponse(method, url, status, data = null, context = null) {\n    const level = status >= 400 ? 'error' : 'debug';\n    this.log(\n      level,\n      `API response: ${method} ${url} - ${status}`,\n      data,\n      context\n    );\n  }\n\n  /**\n   * Log error with stack trace\n   */\n  errorWithStack(message, error, context = null) {\n    this.error(\n      message,\n      {\n        error: error.message,\n        stack: error.stack,\n      },\n      context\n    );\n  }\n\n  /**\n   * Log group of related messages\n   */\n  group(name, fn, context = null) {\n    const startTime = performance.now();\n    this.debug(`Group started: ${name}`, null, context);\n\n    try {\n      const result = fn();\n      const duration = this.performance(name, startTime);\n      this.debug(`Group completed: ${name}`, { duration }, context);\n      return result;\n    } catch (error) {\n      const duration = this.performance(name, startTime);\n      this.error(\n        `Group failed: ${name}`,\n        { error: error.message, duration },\n        context\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Log async group of related messages\n   */\n  async groupAsync(name, fn, context = null) {\n    const startTime = performance.now();\n    this.debug(`Async group started: ${name}`, null, context);\n\n    try {\n      const result = await fn();\n      const duration = this.performance(name, startTime);\n      this.debug(`Async group completed: ${name}`, { duration }, context);\n      return result;\n    } catch (error) {\n      const duration = this.performance(name, startTime);\n      this.error(\n        `Async group failed: ${name}`,\n        { error: error.message, duration },\n        context\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Get log history\n   */\n  getHistory(filter = {}) {\n    let history = [...this.logHistory];\n\n    if (filter.level) {\n      history = history.filter((entry) => entry.level === filter.level);\n    }\n\n    if (filter.context) {\n      history = history.filter((entry) => entry.context === filter.context);\n    }\n\n    if (filter.since) {\n      history = history.filter((entry) => entry.timestamp >= filter.since);\n    }\n\n    if (filter.until) {\n      history = history.filter((entry) => entry.timestamp <= filter.until);\n    }\n\n    if (filter.limit) {\n      history = history.slice(-filter.limit);\n    }\n\n    return history;\n  }\n\n  /**\n   * Get performance metrics\n   */\n  getPerformanceMetrics() {\n    return {\n      ...this.performanceMetrics,\n      logsByLevel: Object.fromEntries(this.performanceMetrics.logsByLevel),\n      uptime: Date.now() - this.startTime,\n    };\n  }\n\n  /**\n   * Clear log history\n   */\n  clearHistory() {\n    this.logHistory = [];\n    this.debug('Log history cleared');\n  }\n\n  /**\n   * Reset performance metrics\n   */\n  resetMetrics() {\n    this.performanceMetrics = {\n      totalLogs: 0,\n      logsByLevel: new Map(),\n      averageLogTime: 0,\n    };\n    this.startTime = Date.now();\n    this.debug('Performance metrics reset');\n  }\n\n  /**\n   * Export logs to JSON\n   */\n  exportLogs(filter = {}) {\n    const history = this.getHistory(filter);\n    return JSON.stringify(history, null, 2);\n  }\n\n  /**\n   * Import logs from JSON\n   */\n  importLogs(jsonString) {\n    try {\n      const logs = JSON.parse(jsonString);\n      if (Array.isArray(logs)) {\n        this.logHistory = logs;\n        this.debug(`Imported ${logs.length} log entries`);\n      }\n    } catch (error) {\n      this.error('Failed to import logs:', error);\n    }\n  }\n\n  /**\n   * Create a child logger with context\n   */\n  child(context) {\n    const childLogger = new Logger(this.debug);\n    childLogger.logLevel = this.logLevel;\n    childLogger.context = context;\n    return childLogger;\n  }\n}\n\nexport default Logger;\n","/**\n * MobileTesting.js - Mobile UX testing and validation utilities\n *\n * This utility provides:\n * - Mobile device detection and testing\n * - Touch gesture validation\n * - Mobile controls testing\n * - Performance testing on mobile devices\n * - Accessibility testing for mobile\n * - Mobile-specific UI validation\n */\n\nexport class MobileTesting {\n  constructor(dependencies = {}) {\n    // Dependency injection\n    this.eventBus = dependencies.eventBus;\n    this.logger = dependencies.logger;\n    this.inputManager = dependencies.inputManager;\n    this.performanceMonitor = dependencies.performanceMonitor;\n\n    // Test configuration\n    this.config = {\n      enableAutoTesting: true,\n      testInterval: 5000,\n      gestureTestTimeout: 2000,\n      performanceTestDuration: 10000,\n      enableAccessibilityTesting: true,\n      enablePerformanceTesting: true,\n      enableGestureTesting: true,\n      enableControlTesting: true,\n      ...dependencies.config,\n    };\n\n    // Test state\n    this.isTesting = false;\n    this.testResults = {\n      device: null,\n      gestures: new Map(),\n      controls: new Map(),\n      performance: null,\n      accessibility: null,\n      overall: null,\n    };\n\n    // Test listeners\n    this.testListeners = new Map();\n\n    this.logger.info('MobileTesting initialized');\n  }\n\n  /**\n   * Initialize the testing utility\n   */\n  async initialize() {\n    this.logger.info('Initializing MobileTesting...');\n\n    // Detect mobile device\n    this.detectMobileDevice();\n\n    // Set up test listeners\n    this.setupTestListeners();\n\n    // Start auto-testing if enabled\n    if (this.config.enableAutoTesting) {\n      this.startAutoTesting();\n    }\n\n    this.logger.info('MobileTesting initialized successfully');\n  }\n\n  /**\n   * Cleanup the testing utility\n   */\n  cleanup() {\n    this.logger.info('Cleaning up MobileTesting...');\n\n    // Stop auto-testing\n    this.stopAutoTesting();\n\n    // Remove test listeners\n    this.removeTestListeners();\n\n    this.logger.info('MobileTesting cleaned up');\n  }\n\n  /**\n   * Detect mobile device and capabilities\n   */\n  detectMobileDevice() {\n    const userAgent = navigator.userAgent;\n    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);\n    const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n    const isTablet = /iPad|Android/i.test(userAgent) && 'ontouchstart' in window;\n\n    this.testResults.device = {\n      isMobile,\n      isTouch,\n      isTablet,\n      userAgent,\n      screenWidth: window.screen.width,\n      screenHeight: window.screen.height,\n      viewportWidth: window.innerWidth,\n      viewportHeight: window.innerHeight,\n      pixelRatio: window.devicePixelRatio || 1,\n      orientation: window.innerHeight > window.innerWidth ? 'portrait' : 'landscape',\n      maxTouchPoints: navigator.maxTouchPoints || 0,\n      hasVibration: 'vibrate' in navigator,\n      hasHaptics: 'vibrate' in navigator,\n      hasGeolocation: 'geolocation' in navigator,\n      hasCamera: 'mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices,\n      hasAccelerometer: 'DeviceMotionEvent' in window,\n      hasGyroscope: 'DeviceOrientationEvent' in window,\n    };\n\n    this.logger.info('Mobile device detected:', this.testResults.device);\n  }\n\n  /**\n   * Set up test listeners\n   */\n  setupTestListeners() {\n    // Gesture test listeners\n    if (this.config.enableGestureTesting) {\n      this.setupGestureTestListeners();\n    }\n\n    // Control test listeners\n    if (this.config.enableControlTesting) {\n      this.setupControlTestListeners();\n    }\n\n    // Performance test listeners\n    if (this.config.enablePerformanceTesting) {\n      this.setupPerformanceTestListeners();\n    }\n\n    // Accessibility test listeners\n    if (this.config.enableAccessibilityTesting) {\n      this.setupAccessibilityTestListeners();\n    }\n  }\n\n  /**\n   * Set up gesture test listeners\n   */\n  setupGestureTestListeners() {\n    const gestureTests = [\n      { name: 'tap', test: this.testTapGesture.bind(this) },\n      { name: 'doubleTap', test: this.testDoubleTapGesture.bind(this) },\n      { name: 'longPress', test: this.testLongPressGesture.bind(this) },\n      { name: 'swipe', test: this.testSwipeGesture.bind(this) },\n      { name: 'pinch', test: this.testPinchGesture.bind(this) },\n      { name: 'rotate', test: this.testRotateGesture.bind(this) },\n    ];\n\n    gestureTests.forEach(({ name, test }) => {\n      this.testListeners.set(`gesture:${name}`, test);\n    });\n  }\n\n  /**\n   * Set up control test listeners\n   */\n  setupControlTestListeners() {\n    const controlTests = [\n      { name: 'virtualJoystick', test: this.testVirtualJoystick.bind(this) },\n      { name: 'actionButtons', test: this.testActionButtons.bind(this) },\n      { name: 'menuButton', test: this.testMenuButton.bind(this) },\n      { name: 'pauseButton', test: this.testPauseButton.bind(this) },\n    ];\n\n    controlTests.forEach(({ name, test }) => {\n      this.testListeners.set(`control:${name}`, test);\n    });\n  }\n\n  /**\n   * Set up performance test listeners\n   */\n  setupPerformanceTestListeners() {\n    this.testListeners.set('performance:test', this.testPerformance.bind(this));\n  }\n\n  /**\n   * Set up accessibility test listeners\n   */\n  setupAccessibilityTestListeners() {\n    this.testListeners.set('accessibility:test', this.testAccessibility.bind(this));\n  }\n\n  /**\n   * Remove test listeners\n   */\n  removeTestListeners() {\n    this.testListeners.clear();\n  }\n\n  /**\n   * Start auto-testing\n   */\n  startAutoTesting() {\n    if (this.isTesting) return;\n\n    this.isTesting = true;\n    this.autoTestInterval = setInterval(() => {\n      this.runAllTests();\n    }, this.config.testInterval);\n\n    this.logger.info('Auto-testing started');\n  }\n\n  /**\n   * Stop auto-testing\n   */\n  stopAutoTesting() {\n    if (!this.isTesting) return;\n\n    this.isTesting = false;\n    if (this.autoTestInterval) {\n      clearInterval(this.autoTestInterval);\n      this.autoTestInterval = null;\n    }\n\n    this.logger.info('Auto-testing stopped');\n  }\n\n  /**\n   * Run all tests\n   */\n  async runAllTests() {\n    this.logger.info('Running mobile tests...');\n\n    try {\n      // Test gestures\n      if (this.config.enableGestureTesting) {\n        await this.testAllGestures();\n      }\n\n      // Test controls\n      if (this.config.enableControlTesting) {\n        await this.testAllControls();\n      }\n\n      // Test performance\n      if (this.config.enablePerformanceTesting) {\n        await this.testPerformance();\n      }\n\n      // Test accessibility\n      if (this.config.enableAccessibilityTesting) {\n        await this.testAccessibility();\n      }\n\n      // Calculate overall score\n      this.calculateOverallScore();\n\n      // Emit test results\n      this.eventBus.emit('mobileTesting:results', this.testResults);\n\n      this.logger.info('Mobile tests completed');\n    } catch (error) {\n      this.logger.error('Error running mobile tests:', error);\n    }\n  }\n\n  /**\n   * Test all gestures\n   */\n  async testAllGestures() {\n    const gestureNames = ['tap', 'doubleTap', 'longPress', 'swipe', 'pinch', 'rotate'];\n    \n    for (const gestureName of gestureNames) {\n      try {\n        const result = await this.testGesture(gestureName);\n        this.testResults.gestures.set(gestureName, result);\n      } catch (error) {\n        this.logger.error(`Error testing gesture ${gestureName}:`, error);\n        this.testResults.gestures.set(gestureName, { success: false, error: error.message });\n      }\n    }\n  }\n\n  /**\n   * Test a specific gesture\n   */\n  async testGesture(gestureName) {\n    const testFunction = this.testListeners.get(`gesture:${gestureName}`);\n    if (!testFunction) {\n      throw new Error(`No test function found for gesture: ${gestureName}`);\n    }\n\n    return await testFunction();\n  }\n\n  /**\n   * Test tap gesture\n   */\n  async testTapGesture() {\n    return new Promise((resolve) => {\n      let tapDetected = false;\n      let startTime = Date.now();\n\n      const handleTap = () => {\n        tapDetected = true;\n        const responseTime = Date.now() - startTime;\n        document.removeEventListener('touchstart', handleTap);\n        resolve({\n          success: true,\n          responseTime,\n          timestamp: Date.now(),\n        });\n      };\n\n      document.addEventListener('touchstart', handleTap, { once: true });\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        if (!tapDetected) {\n          document.removeEventListener('touchstart', handleTap);\n          resolve({\n            success: false,\n            error: 'Timeout',\n            timestamp: Date.now(),\n          });\n        }\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test double tap gesture\n   */\n  async testDoubleTapGesture() {\n    return new Promise((resolve) => {\n      let tapCount = 0;\n      let lastTapTime = 0;\n      let startTime = Date.now();\n\n      const handleTap = () => {\n        const currentTime = Date.now();\n        tapCount++;\n\n        if (tapCount === 1) {\n          lastTapTime = currentTime;\n        } else if (tapCount === 2) {\n          const timeDiff = currentTime - lastTapTime;\n          const success = timeDiff < 500; // Double tap within 500ms\n          \n          document.removeEventListener('touchstart', handleTap);\n          resolve({\n            success,\n            timeDiff,\n            timestamp: Date.now(),\n          });\n        }\n      };\n\n      document.addEventListener('touchstart', handleTap);\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        document.removeEventListener('touchstart', handleTap);\n        resolve({\n          success: false,\n          error: 'Timeout',\n          timestamp: Date.now(),\n        });\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test long press gesture\n   */\n  async testLongPressGesture() {\n    return new Promise((resolve) => {\n      let longPressDetected = false;\n      let startTime = Date.now();\n\n      const handleTouchStart = () => {\n        startTime = Date.now();\n      };\n\n      const handleTouchEnd = () => {\n        const duration = Date.now() - startTime;\n        const success = duration >= 500; // Long press >= 500ms\n        \n        if (success) {\n          longPressDetected = true;\n          resolve({\n            success: true,\n            duration,\n            timestamp: Date.now(),\n          });\n        }\n      };\n\n      document.addEventListener('touchstart', handleTouchStart);\n      document.addEventListener('touchend', handleTouchEnd);\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        document.removeEventListener('touchstart', handleTouchStart);\n        document.removeEventListener('touchend', handleTouchEnd);\n        \n        if (!longPressDetected) {\n          resolve({\n            success: false,\n            error: 'Timeout',\n            timestamp: Date.now(),\n          });\n        }\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test swipe gesture\n   */\n  async testSwipeGesture() {\n    return new Promise((resolve) => {\n      let swipeDetected = false;\n      let startTouch = null;\n\n      const handleTouchStart = (e) => {\n        startTouch = e.touches[0];\n      };\n\n      const handleTouchEnd = (e) => {\n        if (!startTouch) return;\n\n        const endTouch = e.changedTouches[0];\n        const deltaX = endTouch.clientX - startTouch.clientX;\n        const deltaY = endTouch.clientY - startTouch.clientY;\n        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n        \n        const success = distance >= 50; // Swipe distance >= 50px\n        \n        if (success) {\n          swipeDetected = true;\n          resolve({\n            success: true,\n            distance,\n            direction: Math.atan2(deltaY, deltaX) * 180 / Math.PI,\n            timestamp: Date.now(),\n          });\n        }\n      };\n\n      document.addEventListener('touchstart', handleTouchStart);\n      document.addEventListener('touchend', handleTouchEnd);\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        document.removeEventListener('touchstart', handleTouchStart);\n        document.removeEventListener('touchend', handleTouchEnd);\n        \n        if (!swipeDetected) {\n          resolve({\n            success: false,\n            error: 'Timeout',\n            timestamp: Date.now(),\n          });\n        }\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test pinch gesture\n   */\n  async testPinchGesture() {\n    return new Promise((resolve) => {\n      let pinchDetected = false;\n      let startTouches = [];\n\n      const handleTouchStart = (e) => {\n        if (e.touches.length === 2) {\n          startTouches = Array.from(e.touches);\n        }\n      };\n\n      const handleTouchMove = (e) => {\n        if (e.touches.length === 2 && startTouches.length === 2) {\n          const currentTouches = Array.from(e.touches);\n          const startDistance = this.getDistance(startTouches[0], startTouches[1]);\n          const currentDistance = this.getDistance(currentTouches[0], currentTouches[1]);\n          const scale = currentDistance / startDistance;\n          \n          if (Math.abs(scale - 1) > 0.1) { // Pinch threshold\n            pinchDetected = true;\n            resolve({\n              success: true,\n              scale,\n              timestamp: Date.now(),\n            });\n          }\n        }\n      };\n\n      document.addEventListener('touchstart', handleTouchStart);\n      document.addEventListener('touchmove', handleTouchMove);\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        document.removeEventListener('touchstart', handleTouchStart);\n        document.removeEventListener('touchmove', handleTouchMove);\n        \n        if (!pinchDetected) {\n          resolve({\n            success: false,\n            error: 'Timeout',\n            timestamp: Date.now(),\n          });\n        }\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test rotate gesture\n   */\n  async testRotateGesture() {\n    return new Promise((resolve) => {\n      let rotateDetected = false;\n      let startTouches = [];\n\n      const handleTouchStart = (e) => {\n        if (e.touches.length === 2) {\n          startTouches = Array.from(e.touches);\n        }\n      };\n\n      const handleTouchMove = (e) => {\n        if (e.touches.length === 2 && startTouches.length === 2) {\n          const currentTouches = Array.from(e.touches);\n          const startAngle = this.getAngle(startTouches[0], startTouches[1]);\n          const currentAngle = this.getAngle(currentTouches[0], currentTouches[1]);\n          const rotation = currentAngle - startAngle;\n          \n          if (Math.abs(rotation) > 0.1) { // Rotation threshold\n            rotateDetected = true;\n            resolve({\n              success: true,\n              rotation: rotation * 180 / Math.PI,\n              timestamp: Date.now(),\n            });\n          }\n        }\n      };\n\n      document.addEventListener('touchstart', handleTouchStart);\n      document.addEventListener('touchmove', handleTouchMove);\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        document.removeEventListener('touchstart', handleTouchStart);\n        document.removeEventListener('touchmove', handleTouchMove);\n        \n        if (!rotateDetected) {\n          resolve({\n            success: false,\n            error: 'Timeout',\n            timestamp: Date.now(),\n          });\n        }\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test all controls\n   */\n  async testAllControls() {\n    const controlNames = ['virtualJoystick', 'actionButtons', 'menuButton', 'pauseButton'];\n    \n    for (const controlName of controlNames) {\n      try {\n        const result = await this.testControl(controlName);\n        this.testResults.controls.set(controlName, result);\n      } catch (error) {\n        this.logger.error(`Error testing control ${controlName}:`, error);\n        this.testResults.controls.set(controlName, { success: false, error: error.message });\n      }\n    }\n  }\n\n  /**\n   * Test a specific control\n   */\n  async testControl(controlName) {\n    const testFunction = this.testListeners.get(`control:${controlName}`);\n    if (!testFunction) {\n      throw new Error(`No test function found for control: ${controlName}`);\n    }\n\n    return await testFunction();\n  }\n\n  /**\n   * Test virtual joystick\n   */\n  async testVirtualJoystick() {\n    if (!this.inputManager || !this.inputManager.mobileUI.virtualJoystick.element) {\n      return {\n        success: false,\n        error: 'Virtual joystick not available',\n        timestamp: Date.now(),\n      };\n    }\n\n    const joystick = this.inputManager.mobileUI.virtualJoystick;\n    const rect = joystick.element.getBoundingClientRect();\n    \n    return {\n      success: true,\n      position: {\n        x: rect.left,\n        y: rect.top,\n        width: rect.width,\n        height: rect.height,\n      },\n      active: joystick.active,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Test action buttons\n   */\n  async testActionButtons() {\n    if (!this.inputManager || !this.inputManager.mobileUI.actionButtons) {\n      return {\n        success: false,\n        error: 'Action buttons not available',\n        timestamp: Date.now(),\n      };\n    }\n\n    const buttons = Array.from(this.inputManager.mobileUI.actionButtons.entries()).map(([id, button]) => {\n      const rect = button.getBoundingClientRect();\n      return {\n        id,\n        position: {\n          x: rect.left,\n          y: rect.top,\n          width: rect.width,\n          height: rect.height,\n        },\n        visible: button.offsetParent !== null,\n      };\n    });\n\n    return {\n      success: true,\n      buttons,\n      count: buttons.length,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Test menu button\n   */\n  async testMenuButton() {\n    const menuButton = document.querySelector('.menu-button');\n    \n    if (!menuButton) {\n      return {\n        success: false,\n        error: 'Menu button not found',\n        timestamp: Date.now(),\n      };\n    }\n\n    const rect = menuButton.getBoundingClientRect();\n    \n    return {\n      success: true,\n      position: {\n        x: rect.left,\n        y: rect.top,\n        width: rect.width,\n        height: rect.height,\n      },\n      visible: menuButton.offsetParent !== null,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Test pause button\n   */\n  async testPauseButton() {\n    const pauseButton = document.querySelector('.pause-button');\n    \n    if (!pauseButton) {\n      return {\n        success: false,\n        error: 'Pause button not found',\n        timestamp: Date.now(),\n      };\n    }\n\n    const rect = pauseButton.getBoundingClientRect();\n    \n    return {\n      success: true,\n      position: {\n        x: rect.left,\n        y: rect.top,\n        width: rect.width,\n        height: rect.height,\n      },\n      visible: pauseButton.offsetParent !== null,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Test performance\n   */\n  async testPerformance() {\n    if (!this.performanceMonitor) {\n      return {\n        success: false,\n        error: 'Performance monitor not available',\n        timestamp: Date.now(),\n      };\n    }\n\n    const metrics = this.performanceMonitor.getMetrics();\n    const score = this.performanceMonitor.getPerformanceScore();\n    \n    this.testResults.performance = {\n      success: true,\n      score,\n      metrics: {\n        fps: metrics.fps.current,\n        frameTime: metrics.frameTime.current,\n        memory: metrics.memory.used,\n        audio: metrics.audio.contextState,\n      },\n      timestamp: Date.now(),\n    };\n\n    return this.testResults.performance;\n  }\n\n  /**\n   * Test accessibility\n   */\n  async testAccessibility() {\n    const accessibilityTests = [\n      this.testScreenReaderSupport(),\n      this.testKeyboardNavigation(),\n      this.testHighContrast(),\n      this.testTextScaling(),\n    ];\n\n    const results = await Promise.all(accessibilityTests);\n    \n    this.testResults.accessibility = {\n      success: true,\n      tests: results,\n      overallScore: results.reduce((sum, test) => sum + (test.success ? 1 : 0), 0) / results.length,\n      timestamp: Date.now(),\n    };\n\n    return this.testResults.accessibility;\n  }\n\n  /**\n   * Test screen reader support\n   */\n  async testScreenReaderSupport() {\n    const hasScreenReader = 'speechSynthesis' in window;\n    const hasAriaSupport = document.querySelector('[aria-label]') !== null;\n    \n    return {\n      name: 'screenReader',\n      success: hasScreenReader && hasAriaSupport,\n      details: {\n        hasScreenReader,\n        hasAriaSupport,\n      },\n    };\n  }\n\n  /**\n   * Test keyboard navigation\n   */\n  async testKeyboardNavigation() {\n    const focusableElements = document.querySelectorAll(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    \n    return {\n      name: 'keyboardNavigation',\n      success: focusableElements.length > 0,\n      details: {\n        focusableElements: focusableElements.length,\n      },\n    };\n  }\n\n  /**\n   * Test high contrast\n   */\n  async testHighContrast() {\n    const hasHighContrast = document.documentElement.classList.contains('high-contrast');\n    \n    return {\n      name: 'highContrast',\n      success: true, // Always available\n      details: {\n        enabled: hasHighContrast,\n      },\n    };\n  }\n\n  /**\n   * Test text scaling\n   */\n  async testTextScaling() {\n    const textScale = getComputedStyle(document.documentElement).getPropertyValue('--text-scale') || '1';\n    \n    return {\n      name: 'textScaling',\n      success: true, // Always available\n      details: {\n        scale: parseFloat(textScale),\n      },\n    };\n  }\n\n  /**\n   * Calculate overall score\n   */\n  calculateOverallScore() {\n    let totalScore = 0;\n    let testCount = 0;\n\n    // Device score (always 1 if mobile detected)\n    if (this.testResults.device?.isMobile) {\n      totalScore += 1;\n      testCount += 1;\n    }\n\n    // Gesture scores\n    for (const [name, result] of this.testResults.gestures) {\n      totalScore += result.success ? 1 : 0;\n      testCount += 1;\n    }\n\n    // Control scores\n    for (const [name, result] of this.testResults.controls) {\n      totalScore += result.success ? 1 : 0;\n      testCount += 1;\n    }\n\n    // Performance score\n    if (this.testResults.performance) {\n      totalScore += this.testResults.performance.score / 100;\n      testCount += 1;\n    }\n\n    // Accessibility score\n    if (this.testResults.accessibility) {\n      totalScore += this.testResults.accessibility.overallScore;\n      testCount += 1;\n    }\n\n    this.testResults.overall = {\n      score: testCount > 0 ? totalScore / testCount : 0,\n      totalTests: testCount,\n      passedTests: Math.round(totalScore),\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Get distance between two touch points\n   */\n  getDistance(touch1, touch2) {\n    const dx = touch1.clientX - touch2.clientX;\n    const dy = touch1.clientY - touch2.clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Get angle between two touch points\n   */\n  getAngle(touch1, touch2) {\n    return Math.atan2(touch2.clientY - touch1.clientY, touch2.clientX - touch1.clientX);\n  }\n\n  /**\n   * Get test results\n   */\n  getTestResults() {\n    return this.testResults;\n  }\n\n  /**\n   * Get test report\n   */\n  getTestReport() {\n    return {\n      device: this.testResults.device,\n      gestures: Object.fromEntries(this.testResults.gestures),\n      controls: Object.fromEntries(this.testResults.controls),\n      performance: this.testResults.performance,\n      accessibility: this.testResults.accessibility,\n      overall: this.testResults.overall,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Export test results\n   */\n  exportTestResults() {\n    return JSON.stringify(this.getTestReport(), null, 2);\n  }\n\n  /**\n   * Update test configuration\n   */\n  updateConfig(newConfig) {\n    this.config = { ...this.config, ...newConfig };\n  }\n}\n\nexport default MobileTesting;","/**\n * SettingsUI.js - Settings user interface component\n * \n * Provides a comprehensive settings interface with proper UI-to-system contracts\n * for managing game settings, audio preferences, and accessibility options.\n */\n\nimport { EventBus } from '../core/EventBus.js';\nimport { Logger } from '../utils/Logger.js';\n\nexport class SettingsUI {\n  constructor(config = {}) {\n    // Validate required dependencies\n    if (!config.eventBus || !(config.eventBus instanceof EventBus)) {\n      throw new Error('SettingsUI: eventBus is required and must be an EventBus instance');\n    }\n    if (!config.logger || !(config.logger instanceof Logger)) {\n      throw new Error('SettingsUI: logger is required and must be a Logger instance');\n    }\n\n    this.eventBus = config.eventBus;\n    this.logger = config.logger;\n    this.container = config.container || document.body;\n    this.isVisible = false;\n    this.settings = this.getDefaultSettings();\n    \n    // Bind methods\n    this.show = this.show.bind(this);\n    this.hide = this.hide.bind(this);\n    this.toggle = this.toggle.bind(this);\n    this.updateSetting = this.updateSetting.bind(this);\n    this.resetToDefaults = this.resetToDefaults.bind(this);\n    this.saveSettings = this.saveSettings.bind(this);\n    this.loadSettings = this.loadSettings.bind(this);\n\n    // Initialize UI\n    this.initializeUI();\n    this.setupEventListeners();\n    this.loadSettings();\n\n    this.logger.info('SettingsUI initialized');\n  }\n\n  /**\n   * Get default settings configuration\n   */\n  getDefaultSettings() {\n    return {\n      // Audio settings\n      audio: {\n        masterVolume: 1.0,\n        musicVolume: 0.8,\n        sfxVolume: 0.9,\n        muteAll: false,\n        muteMusic: false,\n        muteSfx: false\n      },\n      // Graphics settings\n      graphics: {\n        quality: 'high', // low, medium, high, ultra\n        fullscreen: false,\n        vsync: true,\n        particleEffects: true,\n        shadows: true,\n        antiAliasing: true\n      },\n      // Gameplay settings\n      gameplay: {\n        difficulty: 'normal', // easy, normal, hard, expert\n        autoSave: true,\n        autoPause: true,\n        showFPS: false,\n        showDebugInfo: false,\n        tutorialEnabled: true\n      },\n      // Accessibility settings\n      accessibility: {\n        highContrast: false,\n        largeText: false,\n        screenReader: false,\n        colorBlindMode: 'none', // none, protanopia, deuteranopia, tritanopia\n        reducedMotion: false,\n        keyboardNavigation: true\n      },\n      // Controls settings\n      controls: {\n        keyBindings: this.getDefaultKeyBindings(),\n        mouseSensitivity: 1.0,\n        invertY: false,\n        autoAim: false\n      }\n    };\n  }\n\n  /**\n   * Get default key bindings\n   */\n  getDefaultKeyBindings() {\n    return {\n      moveUp: 'KeyW',\n      moveDown: 'KeyS',\n      moveLeft: 'KeyA',\n      moveRight: 'KeyD',\n      jump: 'Space',\n      action: 'KeyE',\n      pause: 'Escape',\n      inventory: 'KeyI',\n      map: 'KeyM',\n      chat: 'KeyT'\n    };\n  }\n\n  /**\n   * Initialize the settings UI DOM structure\n   */\n  initializeUI() {\n    // Create main settings container\n    this.settingsContainer = document.createElement('div');\n    this.settingsContainer.className = 'settings-container';\n    this.settingsContainer.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: none;\n      z-index: 1000;\n      overflow-y: auto;\n    `;\n\n    // Create settings panel\n    this.settingsPanel = document.createElement('div');\n    this.settingsPanel.className = 'settings-panel';\n    this.settingsPanel.style.cssText = `\n      position: relative;\n      max-width: 800px;\n      margin: 2rem auto;\n      background: #1a1a1a;\n      border-radius: 8px;\n      padding: 2rem;\n      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);\n    `;\n\n    // Create header\n    this.createHeader();\n    \n    // Create settings sections\n    this.createAudioSection();\n    this.createGraphicsSection();\n    this.createGameplaySection();\n    this.createAccessibilitySection();\n    this.createControlsSection();\n    \n    // Create footer with action buttons\n    this.createFooter();\n\n    this.settingsContainer.appendChild(this.settingsPanel);\n    this.container.appendChild(this.settingsContainer);\n  }\n\n  /**\n   * Create settings header\n   */\n  createHeader() {\n    const header = document.createElement('div');\n    header.className = 'settings-header';\n    header.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 2rem;\n      padding-bottom: 1rem;\n      border-bottom: 1px solid #333;\n    `;\n\n    const title = document.createElement('h2');\n    title.textContent = 'Game Settings';\n    title.style.cssText = `\n      color: #fff;\n      margin: 0;\n      font-size: 1.5rem;\n    `;\n\n    const closeButton = document.createElement('button');\n    closeButton.textContent = 'Ã—';\n    closeButton.className = 'settings-close';\n    closeButton.style.cssText = `\n      background: none;\n      border: none;\n      color: #fff;\n      font-size: 2rem;\n      cursor: pointer;\n      padding: 0;\n      width: 40px;\n      height: 40px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    `;\n    closeButton.addEventListener('click', this.hide);\n\n    header.appendChild(title);\n    header.appendChild(closeButton);\n    this.settingsPanel.appendChild(header);\n  }\n\n  /**\n   * Create audio settings section\n   */\n  createAudioSection() {\n    const section = this.createSection('Audio Settings', 'audio');\n    \n    // Master volume\n    this.createSliderControl(section, 'Master Volume', 'audio.masterVolume', 0, 1, 0.1);\n    \n    // Music volume\n    this.createSliderControl(section, 'Music Volume', 'audio.musicVolume', 0, 1, 0.1);\n    \n    // SFX volume\n    this.createSliderControl(section, 'SFX Volume', 'audio.sfxVolume', 0, 1, 0.1);\n    \n    // Mute options\n    this.createCheckboxControl(section, 'Mute All', 'audio.muteAll');\n    this.createCheckboxControl(section, 'Mute Music', 'audio.muteMusic');\n    this.createCheckboxControl(section, 'Mute SFX', 'audio.muteSfx');\n  }\n\n  /**\n   * Create graphics settings section\n   */\n  createGraphicsSection() {\n    const section = this.createSection('Graphics Settings', 'graphics');\n    \n    // Quality preset\n    this.createSelectControl(section, 'Quality Preset', 'graphics.quality', [\n      { value: 'low', label: 'Low' },\n      { value: 'medium', label: 'Medium' },\n      { value: 'high', label: 'High' },\n      { value: 'ultra', label: 'Ultra' }\n    ]);\n    \n    // Graphics options\n    this.createCheckboxControl(section, 'Fullscreen', 'graphics.fullscreen');\n    this.createCheckboxControl(section, 'VSync', 'graphics.vsync');\n    this.createCheckboxControl(section, 'Particle Effects', 'graphics.particleEffects');\n    this.createCheckboxControl(section, 'Shadows', 'graphics.shadows');\n    this.createCheckboxControl(section, 'Anti-Aliasing', 'graphics.antiAliasing');\n  }\n\n  /**\n   * Create gameplay settings section\n   */\n  createGameplaySection() {\n    const section = this.createSection('Gameplay Settings', 'gameplay');\n    \n    // Difficulty\n    this.createSelectControl(section, 'Difficulty', 'gameplay.difficulty', [\n      { value: 'easy', label: 'Easy' },\n      { value: 'normal', label: 'Normal' },\n      { value: 'hard', label: 'Hard' },\n      { value: 'expert', label: 'Expert' }\n    ]);\n    \n    // Gameplay options\n    this.createCheckboxControl(section, 'Auto Save', 'gameplay.autoSave');\n    this.createCheckboxControl(section, 'Auto Pause', 'gameplay.autoPause');\n    this.createCheckboxControl(section, 'Show FPS', 'gameplay.showFPS');\n    this.createCheckboxControl(section, 'Show Debug Info', 'gameplay.showDebugInfo');\n    this.createCheckboxControl(section, 'Tutorial Enabled', 'gameplay.tutorialEnabled');\n  }\n\n  /**\n   * Create accessibility settings section\n   */\n  createAccessibilitySection() {\n    const section = this.createSection('Accessibility Settings', 'accessibility');\n    \n    // Accessibility options\n    this.createCheckboxControl(section, 'High Contrast', 'accessibility.highContrast');\n    this.createCheckboxControl(section, 'Large Text', 'accessibility.largeText');\n    this.createCheckboxControl(section, 'Screen Reader Support', 'accessibility.screenReader');\n    this.createCheckboxControl(section, 'Reduced Motion', 'accessibility.reducedMotion');\n    this.createCheckboxControl(section, 'Keyboard Navigation', 'accessibility.keyboardNavigation');\n    \n    // Color blind mode\n    this.createSelectControl(section, 'Color Blind Mode', 'accessibility.colorBlindMode', [\n      { value: 'none', label: 'None' },\n      { value: 'protanopia', label: 'Protanopia' },\n      { value: 'deuteranopia', label: 'Deuteranopia' },\n      { value: 'tritanopia', label: 'Tritanopia' }\n    ]);\n  }\n\n  /**\n   * Create controls settings section\n   */\n  createControlsSection() {\n    const section = this.createSection('Controls Settings', 'controls');\n    \n    // Mouse sensitivity\n    this.createSliderControl(section, 'Mouse Sensitivity', 'controls.mouseSensitivity', 0.1, 3.0, 0.1);\n    \n    // Control options\n    this.createCheckboxControl(section, 'Invert Y Axis', 'controls.invertY');\n    this.createCheckboxControl(section, 'Auto Aim', 'controls.autoAim');\n    \n    // Key bindings (simplified for now)\n    const keyBindingsDiv = document.createElement('div');\n    keyBindingsDiv.innerHTML = '<h4>Key Bindings</h4><p>Key binding customization coming soon...</p>';\n    section.appendChild(keyBindingsDiv);\n  }\n\n  /**\n   * Create a settings section container\n   */\n  createSection(title, id) {\n    const section = document.createElement('div');\n    section.className = `settings-section settings-section-${id}`;\n    section.style.cssText = `\n      margin-bottom: 2rem;\n      padding: 1rem;\n      background: #2a2a2a;\n      border-radius: 4px;\n    `;\n\n    const sectionTitle = document.createElement('h3');\n    sectionTitle.textContent = title;\n    sectionTitle.style.cssText = `\n      color: #fff;\n      margin: 0 0 1rem 0;\n      font-size: 1.2rem;\n    `;\n\n    section.appendChild(sectionTitle);\n    this.settingsPanel.appendChild(section);\n    return section;\n  }\n\n  /**\n   * Create a slider control\n   */\n  createSliderControl(container, label, settingPath, min, max, step) {\n    const controlDiv = document.createElement('div');\n    controlDiv.className = 'settings-control';\n    controlDiv.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1rem;\n    `;\n\n    const labelEl = document.createElement('label');\n    labelEl.textContent = label;\n    labelEl.style.cssText = `\n      color: #fff;\n      margin-right: 1rem;\n      min-width: 150px;\n    `;\n\n    const slider = document.createElement('input');\n    slider.type = 'range';\n    slider.min = min;\n    slider.max = max;\n    slider.step = step;\n    slider.value = this.getSettingValue(settingPath);\n    slider.style.cssText = `\n      flex: 1;\n      margin-right: 1rem;\n    `;\n\n    const valueDisplay = document.createElement('span');\n    valueDisplay.textContent = slider.value;\n    valueDisplay.style.cssText = `\n      color: #fff;\n      min-width: 50px;\n      text-align: right;\n    `;\n\n    slider.addEventListener('input', (e) => {\n      valueDisplay.textContent = e.target.value;\n      this.updateSetting(settingPath, parseFloat(e.target.value));\n    });\n\n    controlDiv.appendChild(labelEl);\n    controlDiv.appendChild(slider);\n    controlDiv.appendChild(valueDisplay);\n    container.appendChild(controlDiv);\n  }\n\n  /**\n   * Create a checkbox control\n   */\n  createCheckboxControl(container, label, settingPath) {\n    const controlDiv = document.createElement('div');\n    controlDiv.className = 'settings-control';\n    controlDiv.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1rem;\n    `;\n\n    const labelEl = document.createElement('label');\n    labelEl.textContent = label;\n    labelEl.style.cssText = `\n      color: #fff;\n      margin-right: 1rem;\n      flex: 1;\n    `;\n\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.checked = this.getSettingValue(settingPath);\n    checkbox.style.cssText = `\n      width: 20px;\n      height: 20px;\n    `;\n\n    checkbox.addEventListener('change', (e) => {\n      this.updateSetting(settingPath, e.target.checked);\n    });\n\n    controlDiv.appendChild(labelEl);\n    controlDiv.appendChild(checkbox);\n    container.appendChild(controlDiv);\n  }\n\n  /**\n   * Create a select control\n   */\n  createSelectControl(container, label, settingPath, options) {\n    const controlDiv = document.createElement('div');\n    controlDiv.className = 'settings-control';\n    controlDiv.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1rem;\n    `;\n\n    const labelEl = document.createElement('label');\n    labelEl.textContent = label;\n    labelEl.style.cssText = `\n      color: #fff;\n      margin-right: 1rem;\n      min-width: 150px;\n    `;\n\n    const select = document.createElement('select');\n    select.value = this.getSettingValue(settingPath);\n    select.style.cssText = `\n      flex: 1;\n      padding: 0.5rem;\n      background: #333;\n      color: #fff;\n      border: 1px solid #555;\n      border-radius: 4px;\n    `;\n\n    options.forEach(option => {\n      const optionEl = document.createElement('option');\n      optionEl.value = option.value;\n      optionEl.textContent = option.label;\n      select.appendChild(optionEl);\n    });\n\n    select.addEventListener('change', (e) => {\n      this.updateSetting(settingPath, e.target.value);\n    });\n\n    controlDiv.appendChild(labelEl);\n    controlDiv.appendChild(select);\n    container.appendChild(controlDiv);\n  }\n\n  /**\n   * Create footer with action buttons\n   */\n  createFooter() {\n    const footer = document.createElement('div');\n    footer.className = 'settings-footer';\n    footer.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      margin-top: 2rem;\n      padding-top: 1rem;\n      border-top: 1px solid #333;\n    `;\n\n    const resetButton = document.createElement('button');\n    resetButton.textContent = 'Reset to Defaults';\n    resetButton.className = 'settings-reset';\n    resetButton.style.cssText = `\n      background: #666;\n      color: #fff;\n      border: none;\n      padding: 0.75rem 1.5rem;\n      border-radius: 4px;\n      cursor: pointer;\n    `;\n    resetButton.addEventListener('click', this.resetToDefaults);\n\n    const buttonGroup = document.createElement('div');\n    buttonGroup.style.cssText = `\n      display: flex;\n      gap: 1rem;\n    `;\n\n    const cancelButton = document.createElement('button');\n    cancelButton.textContent = 'Cancel';\n    cancelButton.className = 'settings-cancel';\n    cancelButton.style.cssText = `\n      background: #666;\n      color: #fff;\n      border: none;\n      padding: 0.75rem 1.5rem;\n      border-radius: 4px;\n      cursor: pointer;\n    `;\n    cancelButton.addEventListener('click', this.hide);\n\n    const saveButton = document.createElement('button');\n    saveButton.textContent = 'Save Settings';\n    saveButton.className = 'settings-save';\n    saveButton.style.cssText = `\n      background: #4CAF50;\n      color: #fff;\n      border: none;\n      padding: 0.75rem 1.5rem;\n      border-radius: 4px;\n      cursor: pointer;\n    `;\n    saveButton.addEventListener('click', this.saveSettings);\n\n    buttonGroup.appendChild(cancelButton);\n    buttonGroup.appendChild(saveButton);\n    footer.appendChild(resetButton);\n    footer.appendChild(buttonGroup);\n    this.settingsPanel.appendChild(footer);\n  }\n\n  /**\n   * Set up event listeners\n   */\n  setupEventListeners() {\n    // Close on escape key\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape' && this.isVisible) {\n        this.hide();\n      }\n    });\n\n    // Close on backdrop click\n    this.settingsContainer.addEventListener('click', (e) => {\n      if (e.target === this.settingsContainer) {\n        this.hide();\n      }\n    });\n  }\n\n  /**\n   * Get setting value by path\n   */\n  getSettingValue(path) {\n    if (!path || typeof path !== 'string') {\n      return undefined;\n    }\n    \n    const keys = path.split('.');\n    let value = this.settings;\n    for (const key of keys) {\n      if (value && typeof value === 'object' && key in value) {\n        value = value[key];\n      } else {\n        return undefined;\n      }\n    }\n    return value;\n  }\n\n  /**\n   * Update setting value by path\n   */\n  updateSetting(path, value) {\n    const keys = path.split('.');\n    let target = this.settings;\n    for (let i = 0; i < keys.length - 1; i++) {\n      target = target[keys[i]];\n    }\n    target[keys[keys.length - 1]] = value;\n\n    // Emit setting change event\n    this.eventBus.emit('settings:changed', {\n      path,\n      value,\n      settings: this.settings\n    });\n\n    this.logger.debug(`Setting updated: ${path} = ${value}`);\n  }\n\n  /**\n   * Show settings UI\n   */\n  show() {\n    this.settingsContainer.style.display = 'block';\n    this.isVisible = true;\n    this.eventBus.emit('settings:opened');\n    this.logger.info('Settings UI opened');\n  }\n\n  /**\n   * Hide settings UI\n   */\n  hide() {\n    this.settingsContainer.style.display = 'none';\n    this.isVisible = false;\n    this.eventBus.emit('settings:closed');\n    this.logger.info('Settings UI closed');\n  }\n\n  /**\n   * Toggle settings UI visibility\n   */\n  toggle() {\n    if (this.isVisible) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  }\n\n  /**\n   * Reset all settings to defaults\n   */\n  resetToDefaults() {\n    this.settings = this.getDefaultSettings();\n    this.loadSettings();\n    this.eventBus.emit('settings:reset');\n    this.logger.info('Settings reset to defaults');\n  }\n\n  /**\n   * Save settings to localStorage\n   */\n  saveSettings() {\n    try {\n      localStorage.setItem('gameSettings', JSON.stringify(this.settings));\n      this.eventBus.emit('settings:saved', this.settings);\n      this.logger.info('Settings saved successfully');\n      this.hide();\n    } catch (error) {\n      this.logger.error('Failed to save settings:', error);\n      this.eventBus.emit('settings:saveError', error);\n    }\n  }\n\n  /**\n   * Load settings from localStorage\n   */\n  loadSettings() {\n    try {\n      const saved = localStorage.getItem('gameSettings');\n      if (saved) {\n        const parsedSettings = JSON.parse(saved);\n        this.settings = this.mergeSettings(this.settings, parsedSettings);\n        this.eventBus.emit('settings:loaded', this.settings);\n        this.logger.info('Settings loaded successfully');\n      }\n    } catch (error) {\n      this.logger.error('Failed to load settings:', error);\n      this.eventBus.emit('settings:loadError', error);\n    }\n  }\n\n  /**\n   * Merge settings objects\n   */\n  mergeSettings(defaults, saved) {\n    const merged = { ...defaults };\n    for (const key in saved) {\n      if (typeof saved[key] === 'object' && !Array.isArray(saved[key])) {\n        merged[key] = this.mergeSettings(defaults[key] || {}, saved[key]);\n      } else {\n        merged[key] = saved[key];\n      }\n    }\n    return merged;\n  }\n\n  /**\n   * Get current settings\n   */\n  getSettings() {\n    return { ...this.settings };\n  }\n\n  /**\n   * Update settings programmatically\n   */\n  setSettings(newSettings) {\n    this.settings = this.mergeSettings(this.settings, newSettings);\n    this.eventBus.emit('settings:updated', this.settings);\n    this.logger.info('Settings updated programmatically');\n  }\n\n  /**\n   * Cleanup resources\n   */\n  cleanup() {\n    if (this.settingsContainer && this.settingsContainer.parentNode) {\n      this.settingsContainer.parentNode.removeChild(this.settingsContainer);\n    }\n    this.eventBus.emit('settings:cleanup');\n    this.logger.info('SettingsUI cleaned up');\n  }\n}","/**\n * GameRefactored.js - Main game controller with cross-cutting features integration\n *\n * This file serves as the central orchestrator for the game, integrating:\n * - Core gameplay mechanics\n * - Achievements system\n * - Daily challenges\n * - Accessibility features\n * - Modular component architecture with dependency injection\n */\n\nimport { GameManager } from './managers/GameManager.js';\nimport { AchievementManager } from './managers/AchievementManager.js';\nimport { DailyChallengeManager } from './managers/DailyChallengeManager.js';\nimport { AccessibilityManager } from './managers/AccessibilityManager.js';\nimport { EventBus } from './core/EventBus.js';\nimport { Logger } from './utils/Logger.js';\nimport { PerformanceMonitor } from './core/PerformanceMonitor.js';\nimport { InputManager } from './core/InputManager.js';\nimport { MobileTesting } from './utils/MobileTesting.js';\nimport { SettingsUI } from './ui/SettingsUI.js';\nimport { AudioSystem } from './systems/AudioSystem.js';\n\nexport class GameRefactored {\n  constructor(config = {}) {\n    // Validate and normalize config\n    this.config = this.validateConfig({\n      debug: false,\n      enableAchievements: true,\n      enableDailyChallenges: true,\n      enableAccessibility: true,\n      ...config,\n    });\n\n    // Assert config validation\n    if (typeof this.config.debug !== 'boolean') {\n      throw new Error('GameRefactored: config.debug must be a boolean');\n    }\n    if (typeof this.config.enableAchievements !== 'boolean') {\n      throw new Error(\n        'GameRefactored: config.enableAchievements must be a boolean'\n      );\n    }\n    if (typeof this.config.enableDailyChallenges !== 'boolean') {\n      throw new Error(\n        'GameRefactored: config.enableDailyChallenges must be a boolean'\n      );\n    }\n    if (typeof this.config.enableAccessibility !== 'boolean') {\n      throw new Error(\n        'GameRefactored: config.enableAccessibility must be a boolean'\n      );\n    }\n\n    // Core systems - with assertions\n    this.eventBus = new EventBus();\n    if (!this.eventBus || typeof this.eventBus.emit !== 'function') {\n      throw new Error('GameRefactored: EventBus initialization failed');\n    }\n\n    this.logger = new Logger(this.config.debug);\n    if (!this.logger || typeof this.logger.info !== 'function') {\n      throw new Error('GameRefactored: Logger initialization failed');\n    }\n\n    // Game state - with assertions\n    this.gameState = {\n      isRunning: false,\n      isPaused: false,\n      currentLevel: 1,\n      score: 0,\n      player: null,\n      gameObjects: [],\n      startTime: null,\n      lastUpdateTime: null,\n      activePowerUps: new Map(), // Track active power-ups\n    };\n\n    // Assert game state structure\n    if (typeof this.gameState.isRunning !== 'boolean') {\n      throw new Error('GameRefactored: gameState.isRunning must be a boolean');\n    }\n    if (\n      typeof this.gameState.currentLevel !== 'number' ||\n      this.gameState.currentLevel < 1\n    ) {\n      throw new Error(\n        'GameRefactored: gameState.currentLevel must be a positive number'\n      );\n    }\n    if (typeof this.gameState.score !== 'number' || this.gameState.score < 0) {\n      throw new Error(\n        'GameRefactored: gameState.score must be a non-negative number'\n      );\n    }\n    if (!Array.isArray(this.gameState.gameObjects)) {\n      throw new Error('GameRefactored: gameState.gameObjects must be an array');\n    }\n\n    // Manager instances (dependency injection) - with assertions\n    this.managers = {};\n    this.initializeManagers();\n\n    // Performance monitoring\n    this.performanceMonitor = new PerformanceMonitor({\n      eventBus: this.eventBus,\n      logger: this.logger,\n      config: this.config,\n    });\n\n    // Input management\n    this.inputManager = new InputManager({\n      eventBus: this.eventBus,\n      logger: this.logger,\n      config: this.config,\n    });\n\n    // Mobile testing\n    this.mobileTesting = new MobileTesting({\n      eventBus: this.eventBus,\n      logger: this.logger,\n      inputManager: this.inputManager,\n      performanceMonitor: this.performanceMonitor,\n      config: this.config,\n    });\n\n    // UI and Audio systems\n    this.ui = {};\n    this.systems = {};\n    this.initializeUISystems();\n\n    // Assert managers were initialized\n    if (!this.managers.game) {\n      throw new Error('GameRefactored: GameManager initialization failed');\n    }\n    if (this.config.enableAchievements && !this.managers.achievements) {\n      throw new Error(\n        'GameRefactored: AchievementManager initialization failed when enabled'\n      );\n    }\n    if (this.config.enableDailyChallenges && !this.managers.dailyChallenges) {\n      throw new Error(\n        'GameRefactored: DailyChallengeManager initialization failed when enabled'\n      );\n    }\n    if (this.config.enableAccessibility && !this.managers.accessibility) {\n      throw new Error(\n        'GameRefactored: AccessibilityManager initialization failed when enabled'\n      );\n    }\n\n    // Assert UI and audio systems were initialized\n    if (!this.ui.settings) {\n      throw new Error('GameRefactored: SettingsUI initialization failed');\n    }\n    if (!this.systems.audio) {\n      throw new Error('GameRefactored: AudioSystem initialization failed');\n    }\n\n    // Bind methods - with assertions\n    this.update = this.update.bind(this);\n    this.render = this.render.bind(this);\n    this.handleInput = this.handleInput.bind(this);\n\n    // Assert methods are bound correctly\n    if (typeof this.update !== 'function') {\n      throw new Error('GameRefactored: update method binding failed');\n    }\n    if (typeof this.render !== 'function') {\n      throw new Error('GameRefactored: render method binding failed');\n    }\n    if (typeof this.handleInput !== 'function') {\n      throw new Error('GameRefactored: handleInput method binding failed');\n    }\n\n    this.logger.info('GameRefactored initialized');\n  }\n\n  /**\n   * Validate and normalize configuration\n   */\n  validateConfig(config) {\n    const validatedConfig = { ...config };\n\n    // Normalize boolean values\n    validatedConfig.debug = Boolean(validatedConfig.debug);\n    validatedConfig.enableAchievements = Boolean(\n      validatedConfig.enableAchievements\n    );\n    validatedConfig.enableDailyChallenges = Boolean(\n      validatedConfig.enableDailyChallenges\n    );\n    validatedConfig.enableAccessibility = Boolean(\n      validatedConfig.enableAccessibility\n    );\n\n    return validatedConfig;\n  }\n\n  /**\n   * Initialize all game managers with dependency injection\n   */\n  initializeManagers() {\n    // Core game manager\n    this.managers.game = new GameManager({\n      eventBus: this.eventBus,\n      logger: this.logger,\n      config: this.config,\n    });\n\n    // Cross-cutting feature managers\n    if (this.config.enableAchievements) {\n      this.managers.achievements = new AchievementManager({\n        eventBus: this.eventBus,\n        logger: this.logger,\n        gameState: () => this.gameState,\n      });\n    }\n\n    if (this.config.enableDailyChallenges) {\n      this.managers.dailyChallenges = new DailyChallengeManager({\n        eventBus: this.eventBus,\n        logger: this.logger,\n        gameState: () => this.gameState,\n      });\n    }\n\n    if (this.config.enableAccessibility) {\n      this.managers.accessibility = new AccessibilityManager({\n        eventBus: this.eventBus,\n        logger: this.logger,\n        gameState: () => this.gameState,\n      });\n    }\n\n    // Set up cross-manager communication\n    this.setupManagerCommunication();\n  }\n\n  /**\n   * Initialize UI and Audio systems\n   */\n  initializeUISystems() {\n    // Settings UI\n    this.ui.settings = new SettingsUI({\n      eventBus: this.eventBus,\n      logger: this.logger,\n      container: document.body\n    });\n\n    // Audio System\n    this.systems.audio = new AudioSystem({\n      eventBus: this.eventBus,\n      logger: this.logger\n    });\n\n    // Set up UI and audio integration\n    this.setupUIIntegration();\n  }\n\n  /**\n   * Set up UI and audio integration\n   */\n  setupUIIntegration() {\n    // Settings changes should update audio system\n    this.eventBus.on('settings:changed', (data) => {\n      if (data.path.startsWith('audio.')) {\n        // Audio settings are handled by AudioSystem directly\n        this.logger.debug(`Audio setting changed: ${data.path} = ${data.value}`);\n      }\n    });\n\n    // Game state changes should update UI\n    this.eventBus.on('game:stateChanged', (data) => {\n      if (this.ui.settings) {\n        // Update UI based on game state changes\n        this.logger.debug(`Game state changed: ${JSON.stringify(data)}`);\n      }\n    });\n  }\n\n  /**\n   * Set up communication between managers\n   */\n  setupManagerCommunication() {\n    // Game events that affect achievements\n    this.eventBus.on('player:scoreChanged', (data) => {\n      if (this.managers.achievements) {\n        this.managers.achievements.checkScoreAchievements(data.score);\n      }\n      // Update UI with score change\n      this.updateUI('score', data.score);\n    });\n\n    this.eventBus.on('player:levelCompleted', (data) => {\n      if (this.managers.achievements) {\n        this.managers.achievements.checkLevelAchievements(data.level);\n      }\n      if (this.managers.dailyChallenges) {\n        this.managers.dailyChallenges.checkLevelChallenge(data.level);\n      }\n      // Update UI with level completion\n      this.updateUI('level', data.level);\n    });\n\n    this.eventBus.on('player:itemCollected', (data) => {\n      if (this.managers.achievements) {\n        this.managers.achievements.checkCollectionAchievements(data.itemType);\n      }\n      if (this.managers.dailyChallenges) {\n        this.managers.dailyChallenges.checkCollectionChallenge(data.itemType);\n      }\n      // Update UI with item collection\n      this.updateUI('item', data.itemType);\n    });\n\n    // Accessibility events\n    this.eventBus.on('game:stateChanged', (data) => {\n      if (this.managers.accessibility) {\n        this.managers.accessibility.announceStateChange(data);\n      }\n    });\n\n    // Achievement events that affect gameplay\n    this.eventBus.on('achievement:unlocked', (data) => {\n      this.logger.info(`Achievement unlocked: ${data.name}`);\n      if (this.managers.game) {\n        this.managers.game.handleAchievementUnlock(data);\n      }\n      // Update UI with achievement\n      this.updateUI('achievement', data);\n    });\n\n    // Daily challenge events\n    this.eventBus.on('dailyChallenge:completed', (data) => {\n      this.logger.info(`Daily challenge completed: ${data.name}`);\n      if (this.managers.game) {\n        this.managers.game.handleDailyChallengeCompletion(data);\n      }\n      // Update UI with challenge completion\n      this.updateUI('challenge', data);\n    });\n\n    // Power-up events\n    this.eventBus.on('powerup:activated', (data) => {\n      this.gameState.activePowerUps.set(data.type, {\n        ...data,\n        startTime: Date.now(),\n        duration: data.duration || 10000 // 10 seconds default\n      });\n      this.updateUI('powerup', data);\n    });\n\n    this.eventBus.on('powerup:expired', (data) => {\n      this.gameState.activePowerUps.delete(data.type);\n      this.updateUI('powerupExpired', data);\n    });\n\n    // Console/Play integration events\n    this.eventBus.on('console:command', (data) => {\n      this.handleConsoleCommand(data);\n    });\n\n    this.eventBus.on('play:action', (data) => {\n      this.handlePlayAction(data);\n    });\n  }\n\n  /**\n   * Update UI with game state changes\n   */\n  updateUI(type, data) {\n    // This method provides a centralized way to update UI elements\n    // based on game state changes\n    this.eventBus.emit('ui:update', {\n      type,\n      data,\n      timestamp: Date.now()\n    });\n  }\n\n  /**\n   * Handle console commands for debugging and testing\n   */\n  handleConsoleCommand(data) {\n    const { command, args } = data;\n    \n    switch (command) {\n      case 'setScore':\n        this.gameState.score = parseInt(args[0]) || 0;\n        this.eventBus.emit('player:scoreChanged', { score: this.gameState.score });\n        this.logger.info(`Console: Score set to ${this.gameState.score}`);\n        break;\n        \n      case 'setLevel':\n        this.gameState.currentLevel = parseInt(args[0]) || 1;\n        this.eventBus.emit('player:levelCompleted', { level: this.gameState.currentLevel });\n        this.logger.info(`Console: Level set to ${this.gameState.currentLevel}`);\n        break;\n        \n      case 'addPowerUp':\n        const powerUpType = args[0] || 'speed';\n        this.eventBus.emit('powerup:activated', { \n          type: powerUpType, \n          duration: 10000 \n        });\n        this.logger.info(`Console: Power-up ${powerUpType} added`);\n        break;\n        \n      case 'unlockAchievement':\n        const achievementName = args[0] || 'test';\n        this.eventBus.emit('achievement:unlocked', { \n          name: achievementName,\n          description: 'Console unlocked achievement'\n        });\n        this.logger.info(`Console: Achievement ${achievementName} unlocked`);\n        break;\n        \n      case 'toggleSettings':\n        if (this.ui.settings) {\n          this.ui.settings.toggle();\n        }\n        break;\n        \n      case 'muteAudio':\n        if (this.systems.audio) {\n          this.systems.audio.muteAll();\n        }\n        break;\n        \n      case 'unmuteAudio':\n        if (this.systems.audio) {\n          this.systems.audio.unmuteAll();\n        }\n        break;\n        \n      default:\n        this.logger.warn(`Console: Unknown command: ${command}`);\n    }\n  }\n\n  /**\n   * Handle play actions for game interaction\n   */\n  handlePlayAction(data) {\n    const { action, params } = data;\n    \n    switch (action) {\n      case 'jump':\n        this.eventBus.emit('player:jump', params);\n        break;\n        \n      case 'collect':\n        this.eventBus.emit('player:collect', params);\n        break;\n        \n      case 'damage':\n        this.eventBus.emit('player:damage', params);\n        break;\n        \n      case 'pause':\n        this.pause();\n        break;\n        \n      case 'resume':\n        this.resume();\n        break;\n        \n      case 'restart':\n        this.stop();\n        this.start();\n        break;\n        \n      default:\n        this.logger.warn(`Play: Unknown action: ${action}`);\n    }\n  }\n\n  /**\n   * Start the game\n   */\n  async start() {\n    try {\n      this.logger.info('Starting game...');\n\n      // Initialize all managers\n      for (const [name, manager] of Object.entries(this.managers)) {\n        if (manager.initialize) {\n          await manager.initialize();\n        }\n      }\n\n      // Initialize performance monitoring\n      if (this.performanceMonitor.initialize) {\n        await this.performanceMonitor.initialize();\n      }\n\n      // Initialize input management\n      if (this.inputManager.initialize) {\n        await this.inputManager.initialize();\n      }\n\n      // Initialize mobile testing\n      if (this.mobileTesting.initialize) {\n        await this.mobileTesting.initialize();\n      }\n\n      // Initialize UI and audio systems\n      if (this.systems.audio && this.systems.audio.initialize) {\n        await this.systems.audio.initialize();\n      }\n\n      // Set up game state\n      this.gameState.isRunning = true;\n      this.gameState.startTime = Date.now();\n      this.gameState.lastUpdateTime = performance.now();\n\n      // Start game loop\n      this.gameLoopId = requestAnimationFrame(this.update);\n\n      // Emit game start event\n      this.eventBus.emit('game:started', {\n        timestamp: this.gameState.startTime,\n        config: this.config,\n      });\n\n      // Start background music\n      if (this.systems.audio) {\n        this.systems.audio.playMusic('mainTheme');\n      }\n\n      this.logger.info('Game started successfully');\n    } catch (error) {\n      this.logger.error('Failed to start game:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Pause the game\n   */\n  pause() {\n    if (this.gameState.isRunning && !this.gameState.isPaused) {\n      this.gameState.isPaused = true;\n      cancelAnimationFrame(this.gameLoopId);\n\n      this.eventBus.emit('game:paused', {\n        timestamp: Date.now(),\n        pauseTime: this.gameState.startTime,\n      });\n\n      this.logger.info('Game paused');\n    }\n  }\n\n  /**\n   * Resume the game\n   */\n  resume() {\n    if (this.gameState.isRunning && this.gameState.isPaused) {\n      this.gameState.isPaused = false;\n      this.gameState.lastUpdateTime = performance.now();\n      this.gameLoopId = requestAnimationFrame(this.update);\n\n      this.eventBus.emit('game:resumed', {\n        timestamp: Date.now(),\n      });\n\n      this.logger.info('Game resumed');\n    }\n  }\n\n  /**\n   * Stop the game\n   */\n  stop() {\n    this.gameState.isRunning = false;\n    this.gameState.isPaused = false;\n\n    if (this.gameLoopId) {\n      cancelAnimationFrame(this.gameLoopId);\n    }\n\n    // Cleanup managers\n    for (const [name, manager] of Object.entries(this.managers)) {\n      if (manager.cleanup) {\n        manager.cleanup();\n      }\n    }\n\n    // Cleanup performance monitoring\n    if (this.performanceMonitor.cleanup) {\n      this.performanceMonitor.cleanup();\n    }\n\n    // Cleanup input management\n    if (this.inputManager.cleanup) {\n      this.inputManager.cleanup();\n    }\n\n    // Cleanup mobile testing\n    if (this.mobileTesting.cleanup) {\n      this.mobileTesting.cleanup();\n    }\n\n    this.eventBus.emit('game:stopped', {\n      timestamp: Date.now(),\n      finalScore: this.gameState.score,\n      finalLevel: this.gameState.currentLevel,\n    });\n\n    this.logger.info('Game stopped');\n  }\n\n  /**\n   * Main game update loop\n   */\n  update(currentTime) {\n    if (!this.gameState.isRunning || this.gameState.isPaused) {\n      return;\n    }\n\n    const deltaTime = currentTime - this.gameState.lastUpdateTime;\n    this.gameState.lastUpdateTime = currentTime;\n\n    try {\n      // Update all managers\n      for (const [name, manager] of Object.entries(this.managers)) {\n        if (manager.update) {\n          manager.update(deltaTime, this.gameState);\n        }\n      }\n\n      // Update performance monitoring\n      if (this.performanceMonitor.update) {\n        this.performanceMonitor.update(deltaTime);\n      }\n\n      // Update input management\n      if (this.inputManager.update) {\n        this.inputManager.update(deltaTime);\n      }\n\n      // Update game objects\n      this.updateGameObjects(deltaTime);\n\n      // Continue game loop\n      this.gameLoopId = requestAnimationFrame(this.update);\n    } catch (error) {\n      this.logger.error('Error in game update loop:', error);\n      this.stop();\n    }\n  }\n\n  /**\n   * Update all game objects\n   */\n  updateGameObjects(deltaTime) {\n    // Update player\n    if (this.gameState.player && this.gameState.player.update) {\n      this.gameState.player.update(deltaTime);\n    }\n\n    // Update other game objects\n    this.gameState.gameObjects.forEach((obj) => {\n      if (obj.update) {\n        obj.update(deltaTime);\n      }\n    });\n\n    // Remove destroyed objects\n    this.gameState.gameObjects = this.gameState.gameObjects.filter(\n      (obj) => !obj.destroyed\n    );\n  }\n\n  /**\n   * Render the game\n   */\n  render() {\n    // This would typically be handled by a rendering system\n    // For now, we'll emit render events for managers to handle\n    this.eventBus.emit('game:render', {\n      gameState: this.gameState,\n      timestamp: performance.now(),\n    });\n  }\n\n  /**\n   * Handle input events\n   */\n  handleInput(inputType, data) {\n    if (!this.gameState.isRunning) {\n      return;\n    }\n\n    // Emit input event for managers to handle\n    this.eventBus.emit('game:input', {\n      type: inputType,\n      data: data,\n      timestamp: Date.now(),\n    });\n\n    // Handle player input\n    if (this.gameState.player && this.gameState.player.handleInput) {\n      this.gameState.player.handleInput(inputType, data);\n    }\n  }\n\n  /**\n   * Add a game object to the game\n   */\n  addGameObject(gameObject) {\n    this.gameState.gameObjects.push(gameObject);\n\n    this.eventBus.emit('game:objectAdded', {\n      object: gameObject,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Remove a game object from the game\n   */\n  removeGameObject(gameObjectId) {\n    const index = this.gameState.gameObjects.findIndex(\n      (obj) => obj.id === gameObjectId\n    );\n    if (index !== -1) {\n      const removedObject = this.gameState.gameObjects.splice(index, 1)[0];\n\n      this.eventBus.emit('game:objectRemoved', {\n        object: removedObject,\n        timestamp: Date.now(),\n      });\n    }\n  }\n\n  /**\n   * Get current game state (for external access)\n   */\n  getGameState() {\n    return { ...this.gameState };\n  }\n\n  /**\n   * Get manager by name\n   */\n  getManager(name) {\n    return this.managers[name];\n  }\n\n  /**\n   * Get performance monitor\n   */\n  getPerformanceMonitor() {\n    return this.performanceMonitor;\n  }\n\n  /**\n   * Get input manager\n   */\n  getInputManager() {\n    return this.inputManager;\n  }\n\n  /**\n   * Get mobile testing utility\n   */\n  getMobileTesting() {\n    return this.mobileTesting;\n  }\n\n  /**\n   * Get performance report\n   */\n  getPerformanceReport() {\n    return this.performanceMonitor ? this.performanceMonitor.getPerformanceReport() : null;\n  }\n\n  /**\n   * Get mobile controls state\n   */\n  getMobileControlsState() {\n    return this.inputManager ? this.inputManager.getMobileControlsState() : null;\n  }\n\n  /**\n   * Get mobile test results\n   */\n  getMobileTestResults() {\n    return this.mobileTesting ? this.mobileTesting.getTestResults() : null;\n  }\n\n  /**\n   * Get UI system by name\n   */\n  getUI(name) {\n    return this.ui[name];\n  }\n\n  /**\n   * Get system by name\n   */\n  getSystem(name) {\n    return this.systems[name];\n  }\n\n  /**\n   * Get all active power-ups\n   */\n  getActivePowerUps() {\n    const now = Date.now();\n    const active = [];\n    \n    for (const [type, powerUp] of this.gameState.activePowerUps) {\n      if (now - powerUp.startTime < powerUp.duration) {\n        active.push({\n          type,\n          ...powerUp,\n          remainingTime: powerUp.duration - (now - powerUp.startTime)\n        });\n      } else {\n        // Power-up expired\n        this.gameState.activePowerUps.delete(type);\n        this.eventBus.emit('powerup:expired', { type });\n      }\n    }\n    \n    return active;\n  }\n\n  /**\n   * Execute console command (for external access)\n   */\n  executeConsoleCommand(command, ...args) {\n    this.eventBus.emit('console:command', { command, args });\n  }\n\n  /**\n   * Execute play action (for external access)\n   */\n  executePlayAction(action, params = {}) {\n    this.eventBus.emit('play:action', { action, params });\n  }\n\n  /**\n   * Get game statistics\n   */\n  getGameStats() {\n    return {\n      score: this.gameState.score,\n      level: this.gameState.currentLevel,\n      isRunning: this.gameState.isRunning,\n      isPaused: this.gameState.isPaused,\n      gameTime: this.gameState.startTime ? Date.now() - this.gameState.startTime : 0,\n      activePowerUps: this.getActivePowerUps(),\n      achievements: this.managers.achievements ? this.managers.achievements.getAllAchievements() : [],\n      challenges: this.managers.dailyChallenges ? this.managers.dailyChallenges.getActiveChallenges() : []\n    };\n  }\n\n  /**\n   * Update game configuration\n   */\n  updateConfig(newConfig) {\n    this.config = { ...this.config, ...newConfig };\n\n    // Notify managers of config changes\n    this.eventBus.emit('game:configChanged', {\n      config: this.config,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Cleanup and destroy the game instance\n   */\n  destroy() {\n    this.stop();\n\n    // Cleanup UI systems\n    if (this.ui.settings) {\n      this.ui.settings.cleanup();\n    }\n\n    // Cleanup audio systems\n    if (this.systems.audio) {\n      this.systems.audio.cleanup();\n    }\n\n    // Clear all event listeners\n    this.eventBus.removeAllListeners(); // Remove all listeners (no event parameter)\n\n    // Clear game state\n    this.gameState = null;\n    this.managers = null;\n    this.ui = null;\n    this.systems = null;\n\n    this.logger.info('GameRefactored destroyed');\n  }\n}\n\n// Export for use in other modules\nexport default GameRefactored;\n"],"names":["Logger","constructor","debug","this","logLevel","logHistory","maxHistorySize","performanceMetrics","totalLogs","logsByLevel","Map","averageLogTime","levels","error","warn","info","trace","startTime","Date","now","setLevel","level","Object","prototype","hasOwnProperty","call","enableDebug","disableDebug","shouldLog","log","message","data","context","logEntry","timestamp","id","generateLogId","addToHistory","updatePerformanceMetrics","outputLog","push","length","shift","count","get","set","totalTime","toISOString","toUpperCase","Math","random","toString","substr","performance","operation","endTime","duration","toFixed","memory","used","round","usedJSHeapSize","total","totalJSHeapSize","limit","jsHeapSizeLimit","function","name","fn","result","functionAsync","event","eventName","stateChange","from","to","userAction","action","apiCall","method","url","apiResponse","status","errorWithStack","stack","group","groupAsync","getHistory","filter","history","entry","since","until","slice","getPerformanceMetrics","fromEntries","uptime","clearHistory","resetMetrics","exportLogs","JSON","stringify","importLogs","jsonString","logs","parse","Array","isArray","child","childLogger","exports","MobileTesting","dependencies","eventBus","logger","inputManager","performanceMonitor","config","enableAutoTesting","testInterval","gestureTestTimeout","performanceTestDuration","enableAccessibilityTesting","enablePerformanceTesting","enableGestureTesting","enableControlTesting","isTesting","testResults","device","gestures","controls","accessibility","overall","testListeners","initialize","detectMobileDevice","setupTestListeners","startAutoTesting","cleanup","stopAutoTesting","removeTestListeners","userAgent","navigator","isMobile","test","isTouch","window","maxTouchPoints","isTablet","screenWidth","screen","width","screenHeight","height","viewportWidth","innerWidth","viewportHeight","innerHeight","pixelRatio","devicePixelRatio","orientation","hasVibration","hasHaptics","hasGeolocation","hasCamera","mediaDevices","hasAccelerometer","hasGyroscope","setupGestureTestListeners","setupControlTestListeners","setupPerformanceTestListeners","setupAccessibilityTestListeners","testTapGesture","bind","testDoubleTapGesture","testLongPressGesture","testSwipeGesture","testPinchGesture","testRotateGesture","forEach","testVirtualJoystick","testActionButtons","testMenuButton","testPauseButton","testPerformance","testAccessibility","clear","autoTestInterval","setInterval","runAllTests","clearInterval","testAllGestures","testAllControls","calculateOverallScore","emit","gestureNames","gestureName","testGesture","success","testFunction","Error","Promise","resolve","tapDetected","handleTap","responseTime","document","removeEventListener","addEventListener","once","setTimeout","tapCount","lastTapTime","currentTime","timeDiff","longPressDetected","handleTouchStart","handleTouchEnd","swipeDetected","startTouch","e","touches","endTouch","changedTouches","deltaX","clientX","deltaY","clientY","distance","sqrt","direction","atan2","PI","pinchDetected","startTouches","handleTouchMove","currentTouches","startDistance","getDistance","scale","abs","rotateDetected","startAngle","getAngle","rotation","controlNames","controlName","testControl","mobileUI","virtualJoystick","element","joystick","rect","getBoundingClientRect","position","x","left","y","top","active","actionButtons","buttons","entries","map","button","visible","offsetParent","menuButton","querySelector","pauseButton","metrics","getMetrics","score","getPerformanceScore","fps","current","frameTime","audio","contextState","accessibilityTests","testScreenReaderSupport","testKeyboardNavigation","testHighContrast","testTextScaling","results","all","tests","overallScore","reduce","sum","hasScreenReader","hasAriaSupport","details","focusableElements","querySelectorAll","enabled","documentElement","classList","contains","textScale","getComputedStyle","getPropertyValue","parseFloat","totalScore","testCount","totalTests","passedTests","touch1","touch2","dx","dy","getTestResults","getTestReport","exportTestResults","updateConfig","newConfig","SettingsUI","EventBus","container","body","isVisible","settings","getDefaultSettings","show","hide","toggle","updateSetting","resetToDefaults","saveSettings","loadSettings","initializeUI","setupEventListeners","masterVolume","musicVolume","sfxVolume","muteAll","muteMusic","muteSfx","graphics","quality","fullscreen","vsync","particleEffects","shadows","antiAliasing","gameplay","difficulty","autoSave","autoPause","showFPS","showDebugInfo","tutorialEnabled","highContrast","largeText","screenReader","colorBlindMode","reducedMotion","keyboardNavigation","keyBindings","getDefaultKeyBindings","mouseSensitivity","invertY","autoAim","moveUp","moveDown","moveLeft","moveRight","jump","pause","inventory","chat","settingsContainer","createElement","className","style","cssText","settingsPanel","createHeader","createAudioSection","createGraphicsSection","createGameplaySection","createAccessibilitySection","createControlsSection","createFooter","appendChild","header","title","textContent","closeButton","section","createSection","createSliderControl","createCheckboxControl","createSelectControl","value","label","keyBindingsDiv","innerHTML","sectionTitle","settingPath","min","max","step","controlDiv","labelEl","slider","type","getSettingValue","valueDisplay","target","checkbox","checked","options","select","option","optionEl","footer","resetButton","buttonGroup","cancelButton","saveButton","key","path","keys","split","i","display","localStorage","setItem","saved","getItem","parsedSettings","mergeSettings","defaults","merged","getSettings","setSettings","newSettings","parentNode","removeChild","GameRefactored","validateConfig","enableAchievements","enableDailyChallenges","enableAccessibility","gameState","isRunning","isPaused","currentLevel","player","gameObjects","lastUpdateTime","activePowerUps","managers","initializeManagers","PerformanceMonitor","InputManager","mobileTesting","ui","systems","initializeUISystems","game","achievements","dailyChallenges","update","render","handleInput","validatedConfig","Boolean","GameManager","AchievementManager","DailyChallengeManager","AccessibilityManager","setupManagerCommunication","AudioSystem","setupUIIntegration","on","startsWith","checkScoreAchievements","updateUI","checkLevelAchievements","checkLevelChallenge","checkCollectionAchievements","itemType","checkCollectionChallenge","announceStateChange","handleAchievementUnlock","handleDailyChallengeCompletion","delete","handleConsoleCommand","handlePlayAction","command","args","parseInt","powerUpType","achievementName","description","unmuteAll","params","resume","stop","start","manager","gameLoopId","requestAnimationFrame","playMusic","cancelAnimationFrame","pauseTime","finalScore","finalLevel","deltaTime","updateGameObjects","obj","destroyed","inputType","addGameObject","gameObject","object","removeGameObject","gameObjectId","index","findIndex","removedObject","splice","getGameState","getManager","getPerformanceMonitor","getInputManager","getMobileTesting","getPerformanceReport","getMobileControlsState","getMobileTestResults","getUI","getSystem","getActivePowerUps","powerUp","remainingTime","executeConsoleCommand","executePlayAction","getGameStats","gameTime","getAllAchievements","challenges","getActiveChallenges","destroy","removeAllListeners"],"mappings":"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"}