{"version":3,"file":"game-core-utils-BCWYXCml.js","sources":["../../src/core/EventBus.js","../../src/core/PerformanceMonitor.js","../../src/core/InputManager.js"],"sourcesContent":["/**\n * EventBus.js - Central event management system\n *\n * This class provides:\n * - Event emission and listening\n * - Event filtering and transformation\n * - Event history and debugging\n * - Performance monitoring\n */\n\nexport class EventBus {\n  constructor() {\n    this.listeners = new Map();\n    this.eventHistory = [];\n    this.maxHistorySize = 1000;\n    this.debug = false;\n    this.performanceMetrics = {\n      totalEvents: 0,\n      averageProcessingTime: 0,\n      slowestEvent: null,\n      eventCounts: new Map(),\n    };\n  }\n\n  /**\n   * Add event listener\n   */\n  on(event, callback, options = {}) {\n    if (typeof callback !== 'function') {\n      throw new Error('Callback must be a function');\n    }\n\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, []);\n    }\n\n    const listener = {\n      callback,\n      once: options.once || false,\n      priority: options.priority || 0,\n      id: options.id || null,\n      context: options.context || null,\n    };\n\n    this.listeners.get(event).push(listener);\n\n    // Sort by priority (higher priority first)\n    this.listeners.get(event).sort((a, b) => b.priority - a.priority);\n\n    this.log(`Added listener for event: ${event}`);\n  }\n\n  /**\n   * Add one-time event listener\n   */\n  once(event, callback, options = {}) {\n    this.on(event, callback, { ...options, once: true });\n  }\n\n  /**\n   * Remove event listener\n   */\n  off(event, callback) {\n    if (!this.listeners.has(event)) {\n      return;\n    }\n\n    const eventListeners = this.listeners.get(event);\n    const index = eventListeners.findIndex(\n      (listener) => listener.callback === callback\n    );\n\n    if (index !== -1) {\n      eventListeners.splice(index, 1);\n      this.log(`Removed listener for event: ${event}`);\n    }\n  }\n\n  /**\n   * Remove all listeners for an event\n   */\n  removeAllListeners(event) {\n    if (event) {\n      this.listeners.delete(event);\n      this.log(`Removed all listeners for event: ${event}`);\n    } else {\n      this.listeners.clear();\n      this.log('Removed all listeners');\n    }\n  }\n\n  /**\n   * Alias for off method for backward compatibility\n   */\n  removeListener(event, callback) {\n    return this.off(event, callback);\n  }\n\n  /**\n   * Emit an event\n   */\n  emit(event, data = {}) {\n    const startTime = performance.now();\n\n    if (!this.listeners.has(event)) {\n      this.log(`No listeners for event: ${event}`);\n      return;\n    }\n\n    const eventListeners = this.listeners.get(event);\n    const eventData = {\n      event,\n      data,\n      timestamp: Date.now(),\n      id: this.generateEventId(),\n    };\n\n    // Add to history\n    this.addToHistory(eventData);\n\n    // Update performance metrics\n    this.updatePerformanceMetrics(event, startTime);\n\n    // Call listeners\n    const listenersToRemove = [];\n\n    for (let i = 0; i < eventListeners.length; i++) {\n      const listener = eventListeners[i];\n\n      try {\n        // Call listener with context if provided\n        if (listener.context) {\n          listener.callback.call(listener.context, eventData.data, eventData);\n        } else {\n          listener.callback(eventData.data, eventData);\n        }\n\n        // Mark for removal if it's a one-time listener\n        if (listener.once) {\n          listenersToRemove.push(i);\n        }\n      } catch (error) {\n        console.error(`Error in event listener for ${event}:`, error);\n      }\n    }\n\n    // Remove one-time listeners\n    for (let i = listenersToRemove.length - 1; i >= 0; i--) {\n      eventListeners.splice(listenersToRemove[i], 1);\n    }\n\n    this.log(`Emitted event: ${event}`, eventData);\n  }\n\n  /**\n   * Emit event asynchronously\n   */\n  async emitAsync(event, data = {}) {\n    return new Promise((resolve, reject) => {\n      try {\n        this.emit(event, data);\n        resolve();\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n\n  /**\n   * Wait for an event\n   */\n  waitFor(event, timeout = 5000) {\n    return new Promise((resolve, reject) => {\n      const timeoutId = setTimeout(() => {\n        this.off(event, handler);\n        reject(new Error(`Timeout waiting for event: ${event}`));\n      }, timeout);\n\n      const handler = (data, eventData) => {\n        clearTimeout(timeoutId);\n        this.off(event, handler);\n        resolve({ data, eventData });\n      };\n\n      this.on(event, handler);\n    });\n  }\n\n  /**\n   * Add event to history\n   */\n  addToHistory(eventData) {\n    this.eventHistory.push(eventData);\n\n    // Maintain history size limit\n    if (this.eventHistory.length > this.maxHistorySize) {\n      this.eventHistory.shift();\n    }\n  }\n\n  /**\n   * Update performance metrics\n   */\n  updatePerformanceMetrics(event, startTime) {\n    const processingTime = performance.now() - startTime;\n\n    this.performanceMetrics.totalEvents++;\n\n    // Update average processing time\n    const totalTime =\n      this.performanceMetrics.averageProcessingTime *\n      (this.performanceMetrics.totalEvents - 1);\n    this.performanceMetrics.averageProcessingTime =\n      (totalTime + processingTime) / this.performanceMetrics.totalEvents;\n\n    // Update slowest event\n    if (\n      !this.performanceMetrics.slowestEvent ||\n      processingTime > this.performanceMetrics.slowestEvent.time\n    ) {\n      this.performanceMetrics.slowestEvent = {\n        event,\n        time: processingTime,\n        timestamp: Date.now(),\n      };\n    }\n\n    // Update event counts\n    const count = this.performanceMetrics.eventCounts.get(event) || 0;\n    this.performanceMetrics.eventCounts.set(event, count + 1);\n  }\n\n  /**\n   * Generate unique event ID\n   */\n  generateEventId() {\n    return `event_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Get event history\n   */\n  getHistory(filter = {}) {\n    let history = [...this.eventHistory];\n\n    if (filter.event) {\n      history = history.filter((item) => item.event === filter.event);\n    }\n\n    if (filter.since) {\n      history = history.filter((item) => item.timestamp >= filter.since);\n    }\n\n    if (filter.until) {\n      history = history.filter((item) => item.timestamp <= filter.until);\n    }\n\n    if (filter.limit) {\n      history = history.slice(-filter.limit);\n    }\n\n    return history;\n  }\n\n  /**\n   * Get performance metrics\n   */\n  getPerformanceMetrics() {\n    return {\n      ...this.performanceMetrics,\n      eventCounts: Object.fromEntries(this.performanceMetrics.eventCounts),\n    };\n  }\n\n  /**\n   * Clear event history\n   */\n  clearHistory() {\n    this.eventHistory = [];\n    this.log('Event history cleared');\n  }\n\n  /**\n   * Reset performance metrics\n   */\n  resetMetrics() {\n    this.performanceMetrics = {\n      totalEvents: 0,\n      averageProcessingTime: 0,\n      slowestEvent: null,\n      eventCounts: new Map(),\n    };\n    this.log('Performance metrics reset');\n  }\n\n  /**\n   * Enable debug mode\n   */\n  enableDebug() {\n    this.debug = true;\n    this.log('Debug mode enabled');\n  }\n\n  /**\n   * Disable debug mode\n   */\n  disableDebug() {\n    this.debug = false;\n  }\n\n  /**\n   * Log debug message\n   */\n  log(message, data = null) {\n    if (this.debug) {\n      if (data) {\n        console.log(`[EventBus] ${message}`, data);\n      } else {\n        console.log(`[EventBus] ${message}`);\n      }\n    }\n  }\n\n  /**\n   * Get listener count for an event\n   */\n  getListenerCount(event) {\n    return this.listeners.has(event) ? this.listeners.get(event).length : 0;\n  }\n\n  /**\n   * Get all registered events\n   */\n  getRegisteredEvents() {\n    return Array.from(this.listeners.keys());\n  }\n\n  /**\n   * Check if event has listeners\n   */\n  hasListeners(event) {\n    return this.listeners.has(event) && this.listeners.get(event).length > 0;\n  }\n\n  /**\n   * Create event filter\n   */\n  createFilter(event, condition) {\n    return (data, eventData) => {\n      if (condition(data, eventData)) {\n        this.emit(event, data);\n      }\n    };\n  }\n\n  /**\n   * Create event transformer\n   */\n  createTransformer(event, transform) {\n    return (data, eventData) => {\n      const transformedData = transform(data, eventData);\n      this.emit(event, transformedData);\n    };\n  }\n\n  /**\n   * Destroy the event bus\n   */\n  destroy() {\n    this.listeners.clear();\n    this.eventHistory = [];\n    this.performanceMetrics = {\n      totalEvents: 0,\n      averageProcessingTime: 0,\n      slowestEvent: null,\n      eventCounts: new Map(),\n    };\n    this.log('EventBus destroyed');\n  }\n}\n\nexport default EventBus;\n","/**\n * PerformanceMonitor.js - Comprehensive performance monitoring and optimization system\n *\n * This monitor handles:\n * - FPS monitoring and frame time analysis\n * - Memory usage tracking and leak detection\n * - Audio context performance monitoring\n * - Rendering performance analysis\n * - Input lag measurement\n * - Network performance tracking\n * - Performance bottleneck identification\n * - Automatic optimization suggestions\n */\n\nexport class PerformanceMonitor {\n  constructor(dependencies = {}) {\n    // Dependency injection\n    this.eventBus = dependencies.eventBus;\n    this.logger = dependencies.logger;\n    this.config = dependencies.config;\n\n    // Validate required dependencies\n    if (!this.eventBus) {\n      throw new Error('PerformanceMonitor requires eventBus dependency');\n    }\n    if (!this.logger) {\n      throw new Error('PerformanceMonitor requires logger dependency');\n    }\n\n    // Performance configuration\n    this.config = {\n      enableFPSMonitoring: true,\n      enableMemoryMonitoring: true,\n      enableAudioMonitoring: true,\n      enableRenderingMonitoring: true,\n      enableInputMonitoring: true,\n      enableNetworkMonitoring: true,\n      enableAutoOptimization: true,\n      fpsTarget: 60,\n      fpsWarningThreshold: 45,\n      fpsCriticalThreshold: 30,\n      memoryWarningThreshold: 100 * 1024 * 1024, // 100MB\n      memoryCriticalThreshold: 200 * 1024 * 1024, // 200MB\n      frameTimeWarningThreshold: 16.67, // 60fps = 16.67ms per frame\n      frameTimeCriticalThreshold: 33.33, // 30fps = 33.33ms per frame\n      reportInterval: 5000, // Report every 5 seconds\n      maxHistorySize: 1000,\n      ...dependencies.config,\n    };\n\n    // Performance metrics\n    this.metrics = {\n      fps: {\n        current: 0,\n        average: 0,\n        min: Infinity,\n        max: 0,\n        history: [],\n        droppedFrames: 0,\n      },\n      frameTime: {\n        current: 0,\n        average: 0,\n        min: Infinity,\n        max: 0,\n        history: [],\n      },\n      memory: {\n        used: 0,\n        total: 0,\n        available: 0,\n        history: [],\n        leakDetected: false,\n        leakCount: 0,\n      },\n      audio: {\n        contextState: 'suspended',\n        contextRecreations: 0,\n        bufferUnderruns: 0,\n        latency: 0,\n        performanceScore: 0,\n      },\n      rendering: {\n        drawCalls: 0,\n        triangles: 0,\n        textures: 0,\n        shaders: 0,\n        batchCount: 0,\n        cullingTime: 0,\n        lightingTime: 0,\n        postProcessingTime: 0,\n      },\n      input: {\n        lag: 0,\n        eventCount: 0,\n        droppedEvents: 0,\n        averageResponseTime: 0,\n      },\n      network: {\n        latency: 0,\n        bandwidth: 0,\n        packetLoss: 0,\n        connectionQuality: 'good',\n      },\n    };\n\n    // Performance state\n    this.isMonitoring = false;\n    this.lastFrameTime = 0;\n    this.frameCount = 0;\n    this.lastReportTime = 0;\n    this.optimizationSuggestions = [];\n    this.performanceAlerts = [];\n\n    // Performance observers\n    this.observers = {\n      fps: null,\n      memory: null,\n      audio: null,\n      rendering: null,\n      input: null,\n      network: null,\n    };\n\n    // Set up performance monitoring\n    this.setupPerformanceMonitoring();\n    this.setupEventHandlers();\n\n    this.logger.info('PerformanceMonitor initialized');\n  }\n\n  /**\n   * Initialize the monitor\n   */\n  async initialize() {\n    this.logger.info('Initializing PerformanceMonitor...');\n\n    // Start monitoring if enabled\n    if (this.config.enableFPSMonitoring || this.config.enableMemoryMonitoring) {\n      this.startMonitoring();\n    }\n\n    this.logger.info('PerformanceMonitor initialized successfully');\n  }\n\n  /**\n   * Cleanup the monitor\n   */\n  cleanup() {\n    this.logger.info('Cleaning up PerformanceMonitor...');\n\n    // Stop monitoring\n    this.stopMonitoring();\n\n    // Disconnect observers\n    this.disconnectObservers();\n\n    this.logger.info('PerformanceMonitor cleaned up');\n  }\n\n  /**\n   * Set up performance monitoring\n   */\n  setupPerformanceMonitoring() {\n    // Set up FPS monitoring\n    if (this.config.enableFPSMonitoring) {\n      this.setupFPSMonitoring();\n    }\n\n    // Set up memory monitoring\n    if (this.config.enableMemoryMonitoring) {\n      this.setupMemoryMonitoring();\n    }\n\n    // Set up audio monitoring\n    if (this.config.enableAudioMonitoring) {\n      this.setupAudioMonitoring();\n    }\n\n    // Set up rendering monitoring\n    if (this.config.enableRenderingMonitoring) {\n      this.setupRenderingMonitoring();\n    }\n\n    // Set up input monitoring\n    if (this.config.enableInputMonitoring) {\n      this.setupInputMonitoring();\n    }\n\n    // Set up network monitoring\n    if (this.config.enableNetworkMonitoring) {\n      this.setupNetworkMonitoring();\n    }\n  }\n\n  /**\n   * Set up event handlers\n   */\n  setupEventHandlers() {\n    // Game events\n    this.eventBus.on('game:started', this.handleGameStarted.bind(this));\n    this.eventBus.on('game:paused', this.handleGamePaused.bind(this));\n    this.eventBus.on('game:resumed', this.handleGameResumed.bind(this));\n    this.eventBus.on('game:stopped', this.handleGameStopped.bind(this));\n\n    // Performance events\n    this.eventBus.on('performance:frame', this.handleFrame.bind(this));\n    this.eventBus.on('performance:memory', this.handleMemoryUpdate.bind(this));\n    this.eventBus.on('performance:audio', this.handleAudioUpdate.bind(this));\n    this.eventBus.on('performance:rendering', this.handleRenderingUpdate.bind(this));\n    this.eventBus.on('performance:input', this.handleInputUpdate.bind(this));\n    this.eventBus.on('performance:network', this.handleNetworkUpdate.bind(this));\n  }\n\n  /**\n   * Set up FPS monitoring\n   */\n  setupFPSMonitoring() {\n    this.lastFrameTime = performance.now();\n    this.frameCount = 0;\n\n    const measureFPS = (currentTime) => {\n      if (!this.isMonitoring) return;\n\n      const deltaTime = currentTime - this.lastFrameTime;\n      this.lastFrameTime = currentTime;\n\n      // Calculate FPS\n      const fps = 1000 / deltaTime;\n      this.updateFPSMetrics(fps, deltaTime);\n\n      // Continue monitoring\n      requestAnimationFrame(measureFPS);\n    };\n\n    this.observers.fps = measureFPS;\n  }\n\n  /**\n   * Set up memory monitoring\n   */\n  setupMemoryMonitoring() {\n    if (!performance.memory) {\n      this.logger.warn('Performance.memory API not available');\n      return;\n    }\n\n    const measureMemory = () => {\n      if (!this.isMonitoring) return;\n\n      const memory = performance.memory;\n      this.updateMemoryMetrics(memory);\n\n      // Check for memory leaks\n      this.detectMemoryLeaks();\n\n      // Continue monitoring\n      setTimeout(measureMemory, 1000);\n    };\n\n    this.observers.memory = measureMemory;\n  }\n\n  /**\n   * Set up audio monitoring\n   */\n  setupAudioMonitoring() {\n    // Monitor audio context state\n    const measureAudio = () => {\n      if (!this.isMonitoring) return;\n\n      // Check for audio context recreations\n      this.checkAudioContextHealth();\n\n      // Continue monitoring\n      setTimeout(measureAudio, 2000);\n    };\n\n    this.observers.audio = measureAudio;\n  }\n\n  /**\n   * Set up rendering monitoring\n   */\n  setupRenderingMonitoring() {\n    // This would integrate with the rendering system\n    // For now, we'll set up basic monitoring\n    const measureRendering = () => {\n      if (!this.isMonitoring) return;\n\n      // Monitor rendering performance\n      this.updateRenderingMetrics();\n\n      // Continue monitoring\n      requestAnimationFrame(measureRendering);\n    };\n\n    this.observers.rendering = measureRendering;\n  }\n\n  /**\n   * Set up input monitoring\n   */\n  setupInputMonitoring() {\n    let inputEventCount = 0;\n    let lastInputTime = 0;\n\n    const measureInput = (event) => {\n      if (!this.isMonitoring) return;\n\n      const currentTime = performance.now();\n      const responseTime = currentTime - lastInputTime;\n\n      inputEventCount++;\n      this.updateInputMetrics(responseTime);\n\n      lastInputTime = currentTime;\n    };\n\n    // Listen for input events\n    document.addEventListener('keydown', measureInput);\n    document.addEventListener('mousedown', measureInput);\n    document.addEventListener('touchstart', measureInput);\n\n    this.observers.input = measureInput;\n  }\n\n  /**\n   * Set up network monitoring\n   */\n  setupNetworkMonitoring() {\n    const measureNetwork = () => {\n      if (!this.isMonitoring) return;\n\n      // Monitor network performance\n      this.updateNetworkMetrics();\n\n      // Continue monitoring\n      setTimeout(measureNetwork, 5000);\n    };\n\n    this.observers.network = measureNetwork;\n  }\n\n  /**\n   * Start monitoring\n   */\n  startMonitoring() {\n    if (this.isMonitoring) return;\n\n    this.isMonitoring = true;\n    this.lastReportTime = performance.now();\n\n    // Start FPS monitoring\n    if (this.observers.fps) {\n      requestAnimationFrame(this.observers.fps);\n    }\n\n    // Start other monitoring\n    if (this.observers.memory) {\n      this.observers.memory();\n    }\n    if (this.observers.audio) {\n      this.observers.audio();\n    }\n    if (this.observers.rendering) {\n      requestAnimationFrame(this.observers.rendering);\n    }\n    if (this.observers.network) {\n      this.observers.network();\n    }\n\n    this.logger.info('Performance monitoring started');\n  }\n\n  /**\n   * Stop monitoring\n   */\n  stopMonitoring() {\n    if (!this.isMonitoring) return;\n\n    this.isMonitoring = false;\n\n    this.logger.info('Performance monitoring stopped');\n  }\n\n  /**\n   * Disconnect observers\n   */\n  disconnectObservers() {\n    // Remove input event listeners\n    if (this.observers.input) {\n      document.removeEventListener('keydown', this.observers.input);\n      document.removeEventListener('mousedown', this.observers.input);\n      document.removeEventListener('touchstart', this.observers.input);\n    }\n  }\n\n  /**\n   * Update FPS metrics\n   */\n  updateFPSMetrics(fps, frameTime) {\n    this.metrics.fps.current = fps;\n    this.metrics.fps.history.push(fps);\n    this.metrics.fps.min = Math.min(this.metrics.fps.min, fps);\n    this.metrics.fps.max = Math.max(this.metrics.fps.max, fps);\n\n    // Calculate average FPS\n    if (this.metrics.fps.history.length > 0) {\n      this.metrics.fps.average = this.metrics.fps.history.reduce((a, b) => a + b, 0) / this.metrics.fps.history.length;\n    }\n\n    // Update frame time metrics\n    this.metrics.frameTime.current = frameTime;\n    this.metrics.frameTime.history.push(frameTime);\n    this.metrics.frameTime.min = Math.min(this.metrics.frameTime.min, frameTime);\n    this.metrics.frameTime.max = Math.max(this.metrics.frameTime.max, frameTime);\n\n    if (this.metrics.frameTime.history.length > 0) {\n      this.metrics.frameTime.average = this.metrics.frameTime.history.reduce((a, b) => a + b, 0) / this.metrics.frameTime.history.length;\n    }\n\n    // Check for dropped frames\n    if (frameTime > this.config.frameTimeCriticalThreshold) {\n      this.metrics.fps.droppedFrames++;\n    }\n\n    // Maintain history size\n    if (this.metrics.fps.history.length > this.config.maxHistorySize) {\n      this.metrics.fps.history.shift();\n      this.metrics.frameTime.history.shift();\n    }\n\n    // Check for performance issues\n    this.checkFPSPerformance();\n  }\n\n  /**\n   * Update memory metrics\n   */\n  updateMemoryMetrics(memory) {\n    this.metrics.memory.used = memory.usedJSHeapSize;\n    this.metrics.memory.total = memory.totalJSHeapSize;\n    this.metrics.memory.available = memory.jsHeapSizeLimit - memory.usedJSHeapSize;\n\n    this.metrics.memory.history.push({\n      used: memory.usedJSHeapSize,\n      total: memory.totalJSHeapSize,\n      timestamp: performance.now(),\n    });\n\n    // Maintain history size\n    if (this.metrics.memory.history.length > this.config.maxHistorySize) {\n      this.metrics.memory.history.shift();\n    }\n\n    // Check for memory issues\n    this.checkMemoryPerformance();\n  }\n\n  /**\n   * Update audio metrics\n   */\n  updateAudioMetrics(audioData) {\n    this.metrics.audio = { ...this.metrics.audio, ...audioData };\n\n    // Check for audio performance issues\n    this.checkAudioPerformance();\n  }\n\n  /**\n   * Update rendering metrics\n   */\n  updateRenderingMetrics() {\n    // This would be populated by the rendering system\n    // For now, we'll use placeholder values\n    this.metrics.rendering.drawCalls = 0;\n    this.metrics.rendering.triangles = 0;\n    this.metrics.rendering.textures = 0;\n    this.metrics.rendering.shaders = 0;\n  }\n\n  /**\n   * Update input metrics\n   */\n  updateInputMetrics(responseTime) {\n    this.metrics.input.eventCount++;\n    this.metrics.input.lag = responseTime;\n\n    // Calculate average response time\n    if (this.metrics.input.eventCount > 0) {\n      this.metrics.input.averageResponseTime = \n        (this.metrics.input.averageResponseTime * (this.metrics.input.eventCount - 1) + responseTime) / this.metrics.input.eventCount;\n    }\n\n    // Check for input performance issues\n    this.checkInputPerformance();\n  }\n\n  /**\n   * Update network metrics\n   */\n  updateNetworkMetrics() {\n    // This would integrate with network monitoring\n    // For now, we'll use placeholder values\n    this.metrics.network.latency = 0;\n    this.metrics.network.bandwidth = 0;\n    this.metrics.network.packetLoss = 0;\n    this.metrics.network.connectionQuality = 'good';\n  }\n\n  /**\n   * Check FPS performance\n   */\n  checkFPSPerformance() {\n    const fps = this.metrics.fps.current;\n    const frameTime = this.metrics.frameTime.current;\n\n    if (fps < this.config.fpsCriticalThreshold) {\n      this.addPerformanceAlert('critical', 'FPS critically low', { fps, threshold: this.config.fpsCriticalThreshold });\n      this.suggestOptimization('fps', 'Consider reducing graphics quality or disabling non-essential features');\n    } else if (fps < this.config.fpsWarningThreshold) {\n      this.addPerformanceAlert('warning', 'FPS below target', { fps, threshold: this.config.fpsWarningThreshold });\n    }\n\n    if (frameTime > this.config.frameTimeCriticalThreshold) {\n      this.addPerformanceAlert('critical', 'Frame time too high', { frameTime, threshold: this.config.frameTimeCriticalThreshold });\n    } else if (frameTime > this.config.frameTimeWarningThreshold) {\n      this.addPerformanceAlert('warning', 'Frame time above target', { frameTime, threshold: this.config.frameTimeWarningThreshold });\n    }\n  }\n\n  /**\n   * Check memory performance\n   */\n  checkMemoryPerformance() {\n    const used = this.metrics.memory.used;\n\n    if (used > this.config.memoryCriticalThreshold) {\n      this.addPerformanceAlert('critical', 'Memory usage critically high', { used, threshold: this.config.memoryCriticalThreshold });\n      this.suggestOptimization('memory', 'Consider reducing texture quality or clearing unused assets');\n    } else if (used > this.config.memoryWarningThreshold) {\n      this.addPerformanceAlert('warning', 'Memory usage high', { used, threshold: this.config.memoryWarningThreshold });\n    }\n  }\n\n  /**\n   * Check audio performance\n   */\n  checkAudioPerformance() {\n    if (this.metrics.audio.contextRecreations > 5) {\n      this.addPerformanceAlert('warning', 'Audio context recreated multiple times', { recreations: this.metrics.audio.contextRecreations });\n      this.suggestOptimization('audio', 'Consider implementing audio context pooling or lazy initialization');\n    }\n\n    if (this.metrics.audio.bufferUnderruns > 10) {\n      this.addPerformanceAlert('warning', 'Audio buffer underruns detected', { underruns: this.metrics.audio.bufferUnderruns });\n    }\n  }\n\n  /**\n   * Check input performance\n   */\n  checkInputPerformance() {\n    const lag = this.metrics.input.lag;\n\n    if (lag > 100) {\n      this.addPerformanceAlert('warning', 'Input lag detected', { lag });\n      this.suggestOptimization('input', 'Consider optimizing input handling or reducing input processing overhead');\n    }\n  }\n\n  /**\n   * Detect memory leaks\n   */\n  detectMemoryLeaks() {\n    const history = this.metrics.memory.history;\n    if (history.length < 10) return;\n\n    // Check if memory usage is consistently increasing\n    const recent = history.slice(-10);\n    const isIncreasing = recent.every((entry, index) => {\n      if (index === 0) return true;\n      return entry.used > recent[index - 1].used;\n    });\n\n    if (isIncreasing) {\n      this.metrics.memory.leakDetected = true;\n      this.metrics.memory.leakCount++;\n      this.addPerformanceAlert('warning', 'Potential memory leak detected', { leakCount: this.metrics.memory.leakCount });\n      this.suggestOptimization('memory', 'Check for circular references or unremoved event listeners');\n    }\n  }\n\n  /**\n   * Check audio context health\n   */\n  checkAudioContextHealth() {\n    // This would check the actual audio context state\n    // For now, we'll simulate the check\n    const contextState = 'running'; // This would be the actual context state\n\n    if (contextState !== this.metrics.audio.contextState) {\n      if (this.metrics.audio.contextState === 'suspended' && contextState === 'running') {\n        this.metrics.audio.contextRecreations++;\n        this.addPerformanceAlert('info', 'Audio context recreated', { recreations: this.metrics.audio.contextRecreations });\n      }\n      this.metrics.audio.contextState = contextState;\n    }\n  }\n\n  /**\n   * Add performance alert\n   */\n  addPerformanceAlert(level, message, data) {\n    const alert = {\n      level,\n      message,\n      data,\n      timestamp: performance.now(),\n    };\n\n    this.performanceAlerts.push(alert);\n\n    // Emit alert event\n    this.eventBus.emit('performance:alert', alert);\n\n    // Log alert\n    switch (level) {\n      case 'critical':\n        this.logger.error(`Performance Alert: ${message}`, data);\n        break;\n      case 'warning':\n        this.logger.warn(`Performance Alert: ${message}`, data);\n        break;\n      case 'info':\n        this.logger.info(`Performance Alert: ${message}`, data);\n        break;\n    }\n  }\n\n  /**\n   * Suggest optimization\n   */\n  suggestOptimization(category, suggestion) {\n    const optimization = {\n      category,\n      suggestion,\n      timestamp: performance.now(),\n    };\n\n    this.optimizationSuggestions.push(optimization);\n\n    // Emit optimization event\n    this.eventBus.emit('performance:optimization', optimization);\n\n    this.logger.info(`Performance Optimization: ${suggestion}`);\n  }\n\n  /**\n   * Get performance report\n   */\n  getPerformanceReport() {\n    return {\n      metrics: this.metrics,\n      alerts: this.performanceAlerts,\n      suggestions: this.optimizationSuggestions,\n      timestamp: performance.now(),\n    };\n  }\n\n  /**\n   * Get performance score\n   */\n  getPerformanceScore() {\n    let score = 100;\n\n    // FPS score\n    const fps = this.metrics.fps.current;\n    if (fps < this.config.fpsCriticalThreshold) {\n      score -= 40;\n    } else if (fps < this.config.fpsWarningThreshold) {\n      score -= 20;\n    }\n\n    // Memory score\n    const memoryUsage = this.metrics.memory.used / this.metrics.memory.total;\n    if (memoryUsage > 0.9) {\n      score -= 30;\n    } else if (memoryUsage > 0.7) {\n      score -= 15;\n    }\n\n    // Frame time score\n    const frameTime = this.metrics.frameTime.current;\n    if (frameTime > this.config.frameTimeCriticalThreshold) {\n      score -= 20;\n    } else if (frameTime > this.config.frameTimeWarningThreshold) {\n      score -= 10;\n    }\n\n    return Math.max(0, Math.min(100, score));\n  }\n\n  /**\n   * Handle game started\n   */\n  handleGameStarted(data) {\n    this.startMonitoring();\n  }\n\n  /**\n   * Handle game paused\n   */\n  handleGamePaused(data) {\n    // Continue monitoring but reduce frequency\n  }\n\n  /**\n   * Handle game resumed\n   */\n  handleGameResumed(data) {\n    // Resume normal monitoring\n  }\n\n  /**\n   * Handle game stopped\n   */\n  handleGameStopped(data) {\n    this.stopMonitoring();\n  }\n\n  /**\n   * Handle frame event\n   */\n  handleFrame(data) {\n    // This would be called by the rendering system\n  }\n\n  /**\n   * Handle memory update\n   */\n  handleMemoryUpdate(data) {\n    this.updateMemoryMetrics(data);\n  }\n\n  /**\n   * Handle audio update\n   */\n  handleAudioUpdate(data) {\n    this.updateAudioMetrics(data);\n  }\n\n  /**\n   * Handle rendering update\n   */\n  handleRenderingUpdate(data) {\n    this.metrics.rendering = { ...this.metrics.rendering, ...data };\n  }\n\n  /**\n   * Handle input update\n   */\n  handleInputUpdate(data) {\n    this.updateInputMetrics(data.responseTime);\n  }\n\n  /**\n   * Handle network update\n   */\n  handleNetworkUpdate(data) {\n    this.metrics.network = { ...this.metrics.network, ...data };\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(newConfig) {\n    this.config = { ...this.config, ...newConfig };\n  }\n\n  /**\n   * Get current metrics\n   */\n  getMetrics() {\n    return this.metrics;\n  }\n\n  /**\n   * Get alerts\n   */\n  getAlerts() {\n    return this.performanceAlerts;\n  }\n\n  /**\n   * Get optimization suggestions\n   */\n  getOptimizationSuggestions() {\n    return this.optimizationSuggestions;\n  }\n\n  /**\n   * Clear alerts\n   */\n  clearAlerts() {\n    this.performanceAlerts = [];\n  }\n\n  /**\n   * Clear optimization suggestions\n   */\n  clearOptimizationSuggestions() {\n    this.optimizationSuggestions = [];\n  }\n}\n\nexport default PerformanceMonitor;","/**\n * InputManager.js - Comprehensive input handling with accessibility support\n *\n * This manager handles:\n * - Keyboard input with accessibility support\n * - Mouse input and touch events\n * - Gamepad support\n * - Input mapping and customization\n * - Accessibility features (keyboard navigation, focus management)\n * - Input event normalization\n */\n\nexport class InputManager {\n  constructor(dependencies = {}) {\n    // Dependency injection\n    this.eventBus = dependencies.eventBus;\n    this.logger = dependencies.logger;\n    this.config = dependencies.config;\n\n    // Validate required dependencies\n    if (!this.eventBus) {\n      throw new Error('InputManager requires eventBus dependency');\n    }\n    if (!this.logger) {\n      throw new Error('InputManager requires logger dependency');\n    }\n\n    // Input state\n    this.keys = new Map();\n    this.mouse = {\n      x: 0,\n      y: 0,\n      buttons: new Map(),\n      wheel: 0,\n    };\n    this.touch = {\n      touches: new Map(),\n      gestures: new Map(),\n      activeGestures: new Map(),\n      lastTapTime: 0,\n      lastTapPosition: { x: 0, y: 0 },\n      longPressTimer: null,\n      doubleTapTimer: null,\n    };\n\n    // Mobile UI state\n    this.mobileUI = {\n      virtualJoystick: {\n        active: false,\n        center: { x: 0, y: 0 },\n        position: { x: 0, y: 0 },\n        radius: 60,\n        touchId: null,\n      },\n      actionButtons: new Map(),\n      isVisible: false,\n      orientation: 'portrait',\n    };\n    this.gamepad = {\n      controllers: new Map(),\n      lastUpdate: 0,\n    };\n\n    // Input mapping\n    this.keyMappings = new Map();\n    this.mouseMappings = new Map();\n    this.gamepadMappings = new Map();\n    this.touchMappings = new Map();\n\n    // Accessibility features\n    this.accessibility = {\n      keyboardNavigation: false,\n      focusManagement: true,\n      tabOrder: [],\n      currentFocusIndex: 0,\n      focusableElements: new Set(),\n      skipLinks: new Map(),\n    };\n\n    // Input configuration\n    this.settings = {\n      mouseSensitivity: 1.0,\n      keyboardLayout: 'qwerty',\n      enableMouseLook: true,\n      enableKeyboardNavigation: true,\n      enableGamepad: true,\n      enableTouch: true,\n      invertY: false,\n      deadzone: 0.1,\n      repeatDelay: 500,\n      repeatRate: 50,\n      // Mobile-specific settings\n      mobileControls: {\n        enabled: true,\n        layout: 'default', // 'default', 'compact', 'custom'\n        size: 'medium', // 'small', 'medium', 'large'\n        opacity: 0.8,\n        position: 'bottom', // 'bottom', 'top', 'left', 'right', 'custom'\n        showLabels: true,\n        hapticFeedback: true,\n        gestureSensitivity: 1.0,\n        touchDeadzone: 0.05,\n        multiTouch: true,\n        pinchToZoom: true,\n        swipeThreshold: 50,\n        longPressDelay: 500,\n        doubleTapDelay: 300,\n      },\n      // Touch gesture settings\n      gestures: {\n        enableSwipe: true,\n        enablePinch: true,\n        enableRotate: true,\n        enableLongPress: true,\n        enableDoubleTap: true,\n        swipeDirections: ['up', 'down', 'left', 'right'],\n        pinchThreshold: 0.1,\n        rotateThreshold: 5, // degrees\n      },\n      // Mobile UI controls\n      mobileUI: {\n        showVirtualJoystick: true,\n        showActionButtons: true,\n        showMenuButton: true,\n        showPauseButton: true,\n        buttonSpacing: 10,\n        buttonSize: 60,\n        joystickSize: 120,\n        joystickDeadzone: 0.1,\n        buttonOpacity: 0.8,\n        buttonPressScale: 0.9,\n        enableButtonHaptics: true,\n      },\n    };\n\n    // Event handling\n    this.boundHandlers = new Map();\n    this.isEnabled = true;\n    this.isCaptured = false;\n\n    // Initialize input system\n    this.initializeInputMappings();\n    this.setupEventHandlers();\n    this.setupAccessibility();\n    this.setupMobileControls();\n\n    this.logger.info('InputManager initialized');\n  }\n\n  /**\n   * Initialize the manager\n   */\n  async initialize() {\n    this.logger.info('Initializing InputManager...');\n\n    // Load input settings from config\n    if (this.config) {\n      this.loadSettingsFromConfig();\n    }\n\n    // Set up focus management\n    this.setupFocusManagement();\n\n    this.logger.info('InputManager initialized successfully');\n  }\n\n  /**\n   * Cleanup the manager\n   */\n  cleanup() {\n    this.logger.info('Cleaning up InputManager...');\n\n    // Remove event listeners\n    this.removeEventHandlers();\n\n    // Clear state\n    this.keys.clear();\n    this.mouse.buttons.clear();\n    this.touch.touches.clear();\n    this.gamepad.controllers.clear();\n\n    this.logger.info('InputManager cleaned up');\n  }\n\n  /**\n   * Update the manager\n   */\n  update(deltaTime) {\n    if (!this.isEnabled) return;\n\n    // Update gamepad state\n    this.updateGamepadState();\n\n    // Update accessibility features\n    this.updateAccessibilityFeatures();\n\n    // Process input events\n    this.processInputEvents();\n  }\n\n  /**\n   * Initialize input mappings\n   */\n  initializeInputMappings() {\n    // Keyboard mappings\n    this.keyMappings.set('moveUp', ['KeyW', 'ArrowUp']);\n    this.keyMappings.set('moveDown', ['KeyS', 'ArrowDown']);\n    this.keyMappings.set('moveLeft', ['KeyA', 'ArrowLeft']);\n    this.keyMappings.set('moveRight', ['KeyD', 'ArrowRight']);\n    this.keyMappings.set('jump', ['Space']);\n    this.keyMappings.set('crouch', ['KeyC', 'ShiftLeft']);\n    this.keyMappings.set('run', ['ShiftLeft']);\n    this.keyMappings.set('interact', ['KeyE', 'Enter']);\n    this.keyMappings.set('pause', ['Escape', 'KeyP']);\n    this.keyMappings.set('inventory', ['KeyI', 'Tab']);\n    this.keyMappings.set('menu', ['Escape', 'KeyM']);\n    this.keyMappings.set('confirm', ['Enter', 'Space']);\n    this.keyMappings.set('cancel', ['Escape', 'Backspace']);\n    this.keyMappings.set('next', ['Tab', 'ArrowDown']);\n    this.keyMappings.set('previous', ['ShiftLeft+Tab', 'ArrowUp']);\n\n    // Mouse mappings\n    this.mouseMappings.set('leftClick', 0);\n    this.mouseMappings.set('rightClick', 2);\n    this.mouseMappings.set('middleClick', 1);\n    this.mouseMappings.set('scrollUp', 'wheelUp');\n    this.mouseMappings.set('scrollDown', 'wheelDown');\n\n    // Gamepad mappings\n    this.gamepadMappings.set('moveUp', 'dpadUp');\n    this.gamepadMappings.set('moveDown', 'dpadDown');\n    this.gamepadMappings.set('moveLeft', 'dpadLeft');\n    this.gamepadMappings.set('moveRight', 'dpadRight');\n    this.gamepadMappings.set('jump', 'buttonA');\n    this.gamepadMappings.set('interact', 'buttonX');\n    this.gamepadMappings.set('pause', 'buttonStart');\n    this.gamepadMappings.set('menu', 'buttonSelect');\n    this.gamepadMappings.set('confirm', 'buttonA');\n    this.gamepadMappings.set('cancel', 'buttonB');\n\n    // Touch mappings\n    this.touchMappings.set('tap', 'tap');\n    this.touchMappings.set('doubleTap', 'doubleTap');\n    this.touchMappings.set('longPress', 'longPress');\n    this.touchMappings.set('swipe', 'swipe');\n    this.touchMappings.set('pinch', 'pinch');\n    this.touchMappings.set('rotate', 'rotate');\n  }\n\n  /**\n   * Set up event handlers\n   */\n  setupEventHandlers() {\n    // Keyboard events\n    this.boundHandlers.set('keydown', this.handleKeyDown.bind(this));\n    this.boundHandlers.set('keyup', this.handleKeyUp.bind(this));\n    this.boundHandlers.set('keypress', this.handleKeyPress.bind(this));\n\n    // Mouse events\n    this.boundHandlers.set('mousedown', this.handleMouseDown.bind(this));\n    this.boundHandlers.set('mouseup', this.handleMouseUp.bind(this));\n    this.boundHandlers.set('mousemove', this.handleMouseMove.bind(this));\n    this.boundHandlers.set('wheel', this.handleWheel.bind(this));\n    this.boundHandlers.set('contextmenu', this.handleContextMenu.bind(this));\n\n    // Touch events\n    this.boundHandlers.set('touchstart', this.handleTouchStart.bind(this));\n    this.boundHandlers.set('touchend', this.handleTouchEnd.bind(this));\n    this.boundHandlers.set('touchmove', this.handleTouchMove.bind(this));\n    this.boundHandlers.set('touchcancel', this.handleTouchCancel.bind(this));\n\n    // Gamepad events\n    this.boundHandlers.set(\n      'gamepadconnected',\n      this.handleGamepadConnected.bind(this)\n    );\n    this.boundHandlers.set(\n      'gamepaddisconnected',\n      this.handleGamepadDisconnected.bind(this)\n    );\n\n    // Focus events\n    this.boundHandlers.set('focusin', this.handleFocusIn.bind(this));\n    this.boundHandlers.set('focusout', this.handleFocusOut.bind(this));\n\n    // Add event listeners\n    this.addEventListeners();\n  }\n\n  /**\n   * Add event listeners\n   */\n  addEventListeners() {\n    for (const [event, handler] of this.boundHandlers) {\n      document.addEventListener(event, handler, { passive: false });\n    }\n  }\n\n  /**\n   * Remove event handlers\n   */\n  removeEventHandlers() {\n    for (const [event, handler] of this.boundHandlers) {\n      document.removeEventListener(event, handler);\n    }\n    this.boundHandlers.clear();\n  }\n\n  /**\n   * Set up accessibility features\n   */\n  setupAccessibility() {\n    // Set up keyboard navigation\n    if (this.settings.enableKeyboardNavigation) {\n      this.accessibility.keyboardNavigation = true;\n    }\n\n    // Set up focus management\n    this.setupFocusManagement();\n  }\n\n  /**\n   * Set up focus management\n   */\n  setupFocusManagement() {\n    // Find all focusable elements\n    this.updateFocusableElements();\n\n    // Set up tab order\n    this.updateTabOrder();\n\n    // Set up skip links\n    this.setupSkipLinks();\n  }\n\n  /**\n   * Update focusable elements\n   */\n  updateFocusableElements() {\n    this.accessibility.focusableElements.clear();\n\n    const focusableSelectors = [\n      'button:not([disabled])',\n      'input:not([disabled])',\n      'select:not([disabled])',\n      'textarea:not([disabled])',\n      'a[href]',\n      '[tabindex]:not([tabindex=\"-1\"])',\n      '[role=\"button\"]:not([disabled])',\n      '[role=\"link\"]',\n      '[role=\"menuitem\"]',\n      '[role=\"tab\"]',\n      '[role=\"option\"]',\n    ];\n\n    const elements = document.querySelectorAll(focusableSelectors.join(', '));\n    elements.forEach((element) => {\n      this.accessibility.focusableElements.add(element);\n    });\n  }\n\n  /**\n   * Update tab order\n   */\n  updateTabOrder() {\n    this.accessibility.tabOrder = Array.from(\n      this.accessibility.focusableElements\n    ).sort((a, b) => {\n      const aTabIndex = parseInt(a.getAttribute('tabindex') || '0');\n      const bTabIndex = parseInt(b.getAttribute('tabindex') || '0');\n      return aTabIndex - bTabIndex;\n    });\n  }\n\n  /**\n   * Set up skip links\n   */\n  setupSkipLinks() {\n    // Create skip links for accessibility\n    const skipLinks = [\n      { id: 'skip-main', text: 'Skip to main content', target: 'main' },\n      { id: 'skip-nav', text: 'Skip to navigation', target: 'nav' },\n      { id: 'skip-content', text: 'Skip to content', target: 'content' },\n    ];\n\n    skipLinks.forEach((link) => {\n      this.accessibility.skipLinks.set(link.id, link);\n    });\n  }\n\n  /**\n   * Set up mobile controls\n   */\n  setupMobileControls() {\n    if (!this.settings.enableTouch || !this.settings.mobileControls.enabled) {\n      return;\n    }\n\n    // Skip mobile controls setup in test environments\n    if (typeof window !== 'undefined' && window.navigator && window.navigator.userAgent.includes('jsdom')) {\n      this.logger.info('Skipping mobile controls setup in test environment');\n      return;\n    }\n\n    // Detect mobile device\n    this.detectMobileDevice();\n\n    // Create mobile UI elements\n    this.createMobileUI();\n\n    // Set up orientation handling\n    this.setupOrientationHandling();\n\n    // Set up gesture recognition\n    this.setupGestureRecognition();\n\n    this.logger.info('Mobile controls initialized');\n  }\n\n  /**\n   * Detect mobile device\n   */\n  detectMobileDevice() {\n    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n    const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n    \n    this.isMobile = isMobile || isTouch;\n    \n    if (this.isMobile) {\n      this.logger.info('Mobile device detected');\n    }\n  }\n\n  /**\n   * Create mobile UI elements\n   */\n  createMobileUI() {\n    if (!this.isMobile) return;\n\n    // Create mobile controls container\n    this.mobileControlsContainer = document.createElement('div');\n    this.mobileControlsContainer.id = 'mobile-controls';\n    this.mobileControlsContainer.className = 'mobile-controls';\n    this.mobileControlsContainer.style.cssText = `\n      position: fixed;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      height: 200px;\n      pointer-events: none;\n      z-index: 1000;\n      display: ${this.settings.mobileControls.enabled ? 'block' : 'none'};\n    `;\n    \n    // Ensure the element is properly initialized\n    if (!this.mobileControlsContainer.nodeType) {\n      this.mobileControlsContainer = null;\n      return;\n    }\n\n    // Create virtual joystick\n    if (this.settings.mobileUI.showVirtualJoystick) {\n      this.createVirtualJoystick();\n    }\n\n    // Create action buttons\n    if (this.settings.mobileUI.showActionButtons) {\n      this.createActionButtons();\n    }\n\n    // Create menu button\n    if (this.settings.mobileUI.showMenuButton) {\n      this.createMenuButton();\n    }\n\n    // Create pause button\n    if (this.settings.mobileUI.showPauseButton) {\n      this.createPauseButton();\n    }\n\n    if (document.body) {\n      document.body.appendChild(this.mobileControlsContainer);\n    }\n  }\n\n  /**\n   * Create virtual joystick\n   */\n  createVirtualJoystick() {\n    const joystickContainer = document.createElement('div');\n    joystickContainer.className = 'virtual-joystick';\n    joystickContainer.style.cssText = `\n      position: absolute;\n      left: 20px;\n      bottom: 20px;\n      width: ${this.settings.mobileUI.joystickSize}px;\n      height: ${this.settings.mobileUI.joystickSize}px;\n      pointer-events: auto;\n    `;\n\n    const joystickBase = document.createElement('div');\n    joystickBase.className = 'joystick-base';\n    joystickBase.style.cssText = `\n      width: 100%;\n      height: 100%;\n      border-radius: 50%;\n      background: rgba(255, 255, 255, ${this.settings.mobileUI.buttonOpacity});\n      border: 2px solid rgba(0, 0, 0, 0.3);\n      position: relative;\n    `;\n\n    const joystickKnob = document.createElement('div');\n    joystickKnob.className = 'joystick-knob';\n    joystickKnob.style.cssText = `\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      background: rgba(0, 0, 0, 0.5);\n      transform: translate(-50%, -50%);\n      transition: transform 0.1s ease;\n    `;\n\n    joystickBase.appendChild(joystickKnob);\n    joystickContainer.appendChild(joystickBase);\n    if (this.mobileControlsContainer) {\n      this.mobileControlsContainer.appendChild(joystickContainer);\n    }\n\n    // Store references\n    this.mobileUI.virtualJoystick.element = joystickContainer;\n    this.mobileUI.virtualJoystick.base = joystickBase;\n    this.mobileUI.virtualJoystick.knob = joystickKnob;\n    this.mobileUI.virtualJoystick.center = {\n      x: this.settings.mobileUI.joystickSize / 2,\n      y: this.settings.mobileUI.joystickSize / 2,\n    };\n  }\n\n  /**\n   * Create action buttons\n   */\n  createActionButtons() {\n    const buttonContainer = document.createElement('div');\n    buttonContainer.className = 'action-buttons';\n    buttonContainer.style.cssText = `\n      position: absolute;\n      right: 20px;\n      bottom: 20px;\n      display: flex;\n      flex-direction: column;\n      gap: ${this.settings.mobileUI.buttonSpacing}px;\n      pointer-events: auto;\n    `;\n\n    const buttons = [\n      { id: 'jump', label: 'Jump', key: 'Space' },\n      { id: 'interact', label: 'Interact', key: 'KeyE' },\n      { id: 'crouch', label: 'Crouch', key: 'KeyC' },\n      { id: 'run', label: 'Run', key: 'ShiftLeft' },\n    ];\n\n    buttons.forEach((button) => {\n      const buttonElement = document.createElement('button');\n      buttonElement.className = `action-button ${button.id}`;\n      buttonElement.textContent = this.settings.mobileControls.showLabels ? button.label : '';\n      buttonElement.style.cssText = `\n        width: ${this.settings.mobileUI.buttonSize}px;\n        height: ${this.settings.mobileUI.buttonSize}px;\n        border-radius: 50%;\n        background: rgba(255, 255, 255, ${this.settings.mobileUI.buttonOpacity});\n        border: 2px solid rgba(0, 0, 0, 0.3);\n        color: #000;\n        font-size: 12px;\n        font-weight: bold;\n        cursor: pointer;\n        user-select: none;\n        transition: transform 0.1s ease;\n      `;\n\n      // Add touch event handlers\n      buttonElement.addEventListener('touchstart', (e) => {\n        e.preventDefault();\n        this.handleMobileButtonPress(button.id, button.key, 'down');\n        buttonElement.style.transform = `scale(${this.settings.mobileUI.buttonPressScale})`;\n      });\n\n      buttonElement.addEventListener('touchend', (e) => {\n        e.preventDefault();\n        this.handleMobileButtonPress(button.id, button.key, 'up');\n        buttonElement.style.transform = 'scale(1)';\n      });\n\n      buttonContainer.appendChild(buttonElement);\n      this.mobileUI.actionButtons.set(button.id, buttonElement);\n    });\n\n    if (this.mobileControlsContainer) {\n      this.mobileControlsContainer.appendChild(buttonContainer);\n    }\n  }\n\n  /**\n   * Create menu button\n   */\n  createMenuButton() {\n    const menuButton = document.createElement('button');\n    menuButton.className = 'menu-button';\n    menuButton.innerHTML = '☰';\n    menuButton.style.cssText = `\n      position: absolute;\n      top: 20px;\n      right: 20px;\n      width: ${this.settings.mobileUI.buttonSize}px;\n      height: ${this.settings.mobileUI.buttonSize}px;\n      border-radius: 50%;\n      background: rgba(255, 255, 255, ${this.settings.mobileUI.buttonOpacity});\n      border: 2px solid rgba(0, 0, 0, 0.3);\n      color: #000;\n      font-size: 20px;\n      cursor: pointer;\n      pointer-events: auto;\n      user-select: none;\n    `;\n\n    menuButton.addEventListener('touchstart', (e) => {\n      e.preventDefault();\n      this.handleMobileButtonPress('menu', 'KeyM', 'down');\n    });\n\n    if (this.mobileControlsContainer) {\n      this.mobileControlsContainer.appendChild(menuButton);\n    }\n  }\n\n  /**\n   * Create pause button\n   */\n  createPauseButton() {\n    const pauseButton = document.createElement('button');\n    pauseButton.className = 'pause-button';\n    pauseButton.innerHTML = '⏸';\n    pauseButton.style.cssText = `\n      position: absolute;\n      top: 20px;\n      left: 20px;\n      width: ${this.settings.mobileUI.buttonSize}px;\n      height: ${this.settings.mobileUI.buttonSize}px;\n      border-radius: 50%;\n      background: rgba(255, 255, 255, ${this.settings.mobileUI.buttonOpacity});\n      border: 2px solid rgba(0, 0, 0, 0.3);\n      color: #000;\n      font-size: 20px;\n      cursor: pointer;\n      pointer-events: auto;\n      user-select: none;\n    `;\n\n    pauseButton.addEventListener('touchstart', (e) => {\n      e.preventDefault();\n      this.handleMobileButtonPress('pause', 'Escape', 'down');\n    });\n\n    if (this.mobileControlsContainer) {\n      this.mobileControlsContainer.appendChild(pauseButton);\n    }\n  }\n\n  /**\n   * Set up orientation handling\n   */\n  setupOrientationHandling() {\n    const updateOrientation = () => {\n      const isPortrait = window.innerHeight > window.innerWidth;\n      this.mobileUI.orientation = isPortrait ? 'portrait' : 'landscape';\n      \n      // Adjust mobile controls for orientation\n      this.adjustMobileControlsForOrientation();\n    };\n\n    window.addEventListener('orientationchange', updateOrientation);\n    window.addEventListener('resize', updateOrientation);\n    updateOrientation();\n  }\n\n  /**\n   * Adjust mobile controls for orientation\n   */\n  adjustMobileControlsForOrientation() {\n    if (!this.mobileControlsContainer) return;\n\n    if (this.mobileUI.orientation === 'landscape') {\n      // Adjust for landscape mode\n      this.mobileControlsContainer.style.height = '150px';\n    } else {\n      // Adjust for portrait mode\n      this.mobileControlsContainer.style.height = '200px';\n    }\n  }\n\n  /**\n   * Set up gesture recognition\n   */\n  setupGestureRecognition() {\n    if (!this.settings.gestures.enableSwipe && \n        !this.settings.gestures.enablePinch && \n        !this.settings.gestures.enableRotate) {\n      return;\n    }\n\n    // This would integrate with a gesture recognition library\n    // For now, we'll implement basic gesture detection\n    this.setupBasicGestureDetection();\n  }\n\n  /**\n   * Set up basic gesture detection\n   */\n  setupBasicGestureDetection() {\n    let startTouches = [];\n    let startDistance = 0;\n    let startAngle = 0;\n\n    const handleTouchStart = (e) => {\n      startTouches = Array.from(e.touches);\n      if (startTouches.length === 2) {\n        startDistance = this.getDistance(startTouches[0], startTouches[1]);\n        startAngle = this.getAngle(startTouches[0], startTouches[1]);\n      }\n    };\n\n    const handleTouchMove = (e) => {\n      if (e.touches.length === 2 && this.settings.gestures.enablePinch) {\n        const currentDistance = this.getDistance(e.touches[0], e.touches[1]);\n        const scale = currentDistance / startDistance;\n        \n        if (Math.abs(scale - 1) > this.settings.gestures.pinchThreshold) {\n          this.handlePinchGesture(scale);\n        }\n      }\n\n      if (e.touches.length === 2 && this.settings.gestures.enableRotate) {\n        const currentAngle = this.getAngle(e.touches[0], e.touches[1]);\n        const rotation = currentAngle - startAngle;\n        \n        if (Math.abs(rotation) > this.settings.gestures.rotateThreshold) {\n          this.handleRotateGesture(rotation);\n        }\n      }\n    };\n\n    const handleTouchEnd = (e) => {\n      if (e.touches.length === 0 && startTouches.length === 1) {\n        // Single touch ended - check for swipe\n        this.checkForSwipe(startTouches[0], e.changedTouches[0]);\n      }\n    };\n\n    document.addEventListener('touchstart', handleTouchStart, { passive: true });\n    document.addEventListener('touchmove', handleTouchMove, { passive: true });\n    document.addEventListener('touchend', handleTouchEnd, { passive: true });\n  }\n\n  /**\n   * Handle keyboard down events\n   */\n  handleKeyDown(event) {\n    if (!this.isEnabled) return;\n\n    const key = event.code;\n    const keyName = this.getKeyName(key);\n\n    // Update key state\n    this.keys.set(key, {\n      pressed: true,\n      timestamp: Date.now(),\n      repeat: this.keys.has(key),\n    });\n\n    // Handle accessibility features\n    if (this.accessibility.keyboardNavigation) {\n      this.handleAccessibilityKeyDown(event);\n    }\n\n    // Emit input event\n    this.eventBus.emit('input:keyDown', {\n      key,\n      keyName,\n      code: event.code,\n      keyCode: event.keyCode,\n      repeat: this.keys.get(key).repeat,\n      ctrlKey: event.ctrlKey,\n      shiftKey: event.shiftKey,\n      altKey: event.altKey,\n      metaKey: event.metaKey,\n      timestamp: Date.now(),\n    });\n\n    // Handle mapped actions\n    this.handleMappedAction('keyboard', key, 'down', event);\n  }\n\n  /**\n   * Handle keyboard up events\n   */\n  handleKeyUp(event) {\n    if (!this.isEnabled) return;\n\n    const key = event.code;\n    const keyName = this.getKeyName(key);\n\n    // Update key state\n    this.keys.set(key, {\n      pressed: false,\n      timestamp: Date.now(),\n      repeat: false,\n    });\n\n    // Emit input event\n    this.eventBus.emit('input:keyUp', {\n      key,\n      keyName,\n      code: event.code,\n      keyCode: event.keyCode,\n      ctrlKey: event.ctrlKey,\n      shiftKey: event.shiftKey,\n      altKey: event.altKey,\n      metaKey: event.metaKey,\n      timestamp: Date.now(),\n    });\n\n    // Handle mapped actions\n    this.handleMappedAction('keyboard', key, 'up', event);\n  }\n\n  /**\n   * Handle keyboard press events\n   */\n  handleKeyPress(event) {\n    if (!this.isEnabled) return;\n\n    const key = event.key;\n    const charCode = event.charCode;\n\n    // Emit input event\n    this.eventBus.emit('input:keyPress', {\n      key,\n      charCode,\n      ctrlKey: event.ctrlKey,\n      shiftKey: event.shiftKey,\n      altKey: event.altKey,\n      metaKey: event.metaKey,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle mouse down events\n   */\n  handleMouseDown(event) {\n    if (!this.isEnabled) return;\n\n    const button = event.button;\n    const buttonName = this.getMouseButtonName(button);\n\n    // Update mouse state\n    this.mouse.buttons.set(button, {\n      pressed: true,\n      timestamp: Date.now(),\n    });\n\n    // Update mouse position\n    this.mouse.x = event.clientX;\n    this.mouse.y = event.clientY;\n\n    // Emit input event\n    this.eventBus.emit('input:mouseDown', {\n      button,\n      buttonName,\n      x: event.clientX,\n      y: event.clientY,\n      ctrlKey: event.ctrlKey,\n      shiftKey: event.shiftKey,\n      altKey: event.altKey,\n      metaKey: event.metaKey,\n      timestamp: Date.now(),\n    });\n\n    // Handle mapped actions\n    this.handleMappedAction('mouse', button, 'down', event);\n  }\n\n  /**\n   * Handle mouse up events\n   */\n  handleMouseUp(event) {\n    if (!this.isEnabled) return;\n\n    const button = event.button;\n    const buttonName = this.getMouseButtonName(button);\n\n    // Update mouse state\n    this.mouse.buttons.set(button, {\n      pressed: false,\n      timestamp: Date.now(),\n    });\n\n    // Update mouse position\n    this.mouse.x = event.clientX;\n    this.mouse.y = event.clientY;\n\n    // Emit input event\n    this.eventBus.emit('input:mouseUp', {\n      button,\n      buttonName,\n      x: event.clientX,\n      y: event.clientY,\n      ctrlKey: event.ctrlKey,\n      shiftKey: event.shiftKey,\n      altKey: event.altKey,\n      metaKey: event.metaKey,\n      timestamp: Date.now(),\n    });\n\n    // Handle mapped actions\n    this.handleMappedAction('mouse', button, 'up', event);\n  }\n\n  /**\n   * Handle mouse move events\n   */\n  handleMouseMove(event) {\n    if (!this.isEnabled) return;\n\n    // Update mouse position\n    const deltaX = event.clientX - this.mouse.x;\n    const deltaY = event.clientY - this.mouse.y;\n\n    this.mouse.x = event.clientX;\n    this.mouse.y = event.clientY;\n\n    // Apply sensitivity\n    const sensitivity = this.settings.mouseSensitivity;\n    const adjustedDeltaX = deltaX * sensitivity;\n    const adjustedDeltaY = this.settings.invertY\n      ? -deltaY * sensitivity\n      : deltaY * sensitivity;\n\n    // Emit input event\n    this.eventBus.emit('input:mouseMove', {\n      x: event.clientX,\n      y: event.clientY,\n      deltaX: adjustedDeltaX,\n      deltaY: adjustedDeltaY,\n      ctrlKey: event.ctrlKey,\n      shiftKey: event.shiftKey,\n      altKey: event.altKey,\n      metaKey: event.metaKey,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle wheel events\n   */\n  handleWheel(event) {\n    if (!this.isEnabled) return;\n\n    const deltaY = event.deltaY;\n    const direction = deltaY > 0 ? 'down' : 'up';\n\n    this.mouse.wheel = deltaY;\n\n    // Emit input event\n    this.eventBus.emit('input:wheel', {\n      deltaY,\n      direction,\n      x: event.clientX,\n      y: event.clientY,\n      ctrlKey: event.ctrlKey,\n      shiftKey: event.shiftKey,\n      altKey: event.altKey,\n      metaKey: event.metaKey,\n      timestamp: Date.now(),\n    });\n\n    // Handle mapped actions\n    this.handleMappedAction('mouse', direction, 'wheel', event);\n  }\n\n  /**\n   * Handle context menu events\n   */\n  handleContextMenu(event) {\n    if (!this.isEnabled) return;\n\n    // Prevent context menu if needed\n    if (this.isCaptured) {\n      event.preventDefault();\n    }\n\n    // Emit input event\n    this.eventBus.emit('input:contextMenu', {\n      x: event.clientX,\n      y: event.clientY,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle touch start events\n   */\n  handleTouchStart(event) {\n    if (!this.isEnabled || !this.settings.enableTouch) return;\n\n    // Prevent default to avoid mouse events\n    event.preventDefault();\n\n    // Update touch state\n    for (const touch of event.changedTouches) {\n      this.touch.touches.set(touch.identifier, {\n        x: touch.clientX,\n        y: touch.clientY,\n        startX: touch.clientX,\n        startY: touch.clientY,\n        startTime: Date.now(),\n        pressure: touch.force || 1.0,\n      });\n\n      // Handle mobile-specific touch events\n      if (this.isMobile) {\n        this.handleMobileTouchStart(touch, event);\n      }\n    }\n\n    // Emit input event\n    this.eventBus.emit('input:touchStart', {\n      touches: Array.from(event.changedTouches).map((touch) => ({\n        id: touch.identifier,\n        x: touch.clientX,\n        y: touch.clientY,\n        pressure: touch.force || 1.0,\n      })),\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle touch end events\n   */\n  handleTouchEnd(event) {\n    if (!this.isEnabled || !this.settings.enableTouch) return;\n\n    // Prevent default\n    event.preventDefault();\n\n    // Update touch state\n    for (const touch of event.changedTouches) {\n      // Handle mobile-specific touch events\n      if (this.isMobile) {\n        this.handleMobileTouchEnd(touch, event);\n      }\n\n      this.touch.touches.delete(touch.identifier);\n    }\n\n    // Emit input event\n    this.eventBus.emit('input:touchEnd', {\n      touches: Array.from(event.changedTouches).map((touch) => ({\n        id: touch.identifier,\n        x: touch.clientX,\n        y: touch.clientY,\n      })),\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle touch move events\n   */\n  handleTouchMove(event) {\n    if (!this.isEnabled || !this.settings.enableTouch) return;\n\n    // Prevent default to avoid scrolling\n    event.preventDefault();\n\n    // Update touch state\n    for (const touch of event.changedTouches) {\n      if (this.touch.touches.has(touch.identifier)) {\n        const touchData = this.touch.touches.get(touch.identifier);\n        touchData.x = touch.clientX;\n        touchData.y = touch.clientY;\n\n        // Handle mobile-specific touch events\n        if (this.isMobile) {\n          this.handleMobileTouchMove(touch, event);\n        }\n      }\n    }\n\n    // Emit input event\n    this.eventBus.emit('input:touchMove', {\n      touches: Array.from(event.changedTouches).map((touch) => ({\n        id: touch.identifier,\n        x: touch.clientX,\n        y: touch.clientY,\n        pressure: touch.force || 1.0,\n      })),\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle touch cancel events\n   */\n  handleTouchCancel(event) {\n    if (!this.isEnabled || !this.settings.enableTouch) return;\n\n    // Update touch state\n    for (const touch of event.changedTouches) {\n      this.touch.touches.delete(touch.identifier);\n    }\n\n    // Emit input event\n    this.eventBus.emit('input:touchCancel', {\n      touches: Array.from(event.changedTouches).map((touch) => ({\n        id: touch.identifier,\n        x: touch.clientX,\n        y: touch.clientY,\n      })),\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle gamepad connected events\n   */\n  handleGamepadConnected(event) {\n    if (!this.settings.enableGamepad) return;\n\n    const gamepad = event.gamepad;\n    this.gamepad.controllers.set(gamepad.index, {\n      id: gamepad.id,\n      index: gamepad.index,\n      connected: true,\n      buttons: new Map(),\n      axes: new Map(),\n    });\n\n    this.logger.info(`Gamepad connected: ${gamepad.id}`);\n\n    // Emit input event\n    this.eventBus.emit('input:gamepadConnected', {\n      id: gamepad.id,\n      index: gamepad.index,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle gamepad disconnected events\n   */\n  handleGamepadDisconnected(event) {\n    const gamepad = event.gamepad;\n    this.gamepad.controllers.delete(gamepad.index);\n\n    this.logger.info(`Gamepad disconnected: ${gamepad.id}`);\n\n    // Emit input event\n    this.eventBus.emit('input:gamepadDisconnected', {\n      id: gamepad.id,\n      index: gamepad.index,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle focus in events\n   */\n  handleFocusIn(event) {\n    if (!this.accessibility.focusManagement) return;\n\n    const element = event.target;\n    const index = this.accessibility.tabOrder.indexOf(element);\n\n    if (index !== -1) {\n      this.accessibility.currentFocusIndex = index;\n    }\n\n    // Emit input event\n    this.eventBus.emit('input:focusIn', {\n      element,\n      index,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle focus out events\n   */\n  handleFocusOut(event) {\n    if (!this.accessibility.focusManagement) return;\n\n    const element = event.target;\n\n    // Emit input event\n    this.eventBus.emit('input:focusOut', {\n      element,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle accessibility key down events\n   */\n  handleAccessibilityKeyDown(event) {\n    const key = event.key;\n\n    switch (key) {\n      case 'Tab':\n        this.handleTabNavigation(event);\n        break;\n      case 'Enter':\n      case ' ':\n        this.handleActivation(event);\n        break;\n      case 'Escape':\n        this.handleEscape(event);\n        break;\n      case 'ArrowUp':\n      case 'ArrowDown':\n      case 'ArrowLeft':\n      case 'ArrowRight':\n        this.handleArrowNavigation(event);\n        break;\n    }\n  }\n\n  /**\n   * Handle tab navigation\n   */\n  handleTabNavigation(event) {\n    if (this.accessibility.tabOrder.length === 0) return;\n\n    const direction = event.shiftKey ? -1 : 1;\n    const newIndex =\n      (this.accessibility.currentFocusIndex +\n        direction +\n        this.accessibility.tabOrder.length) %\n      this.accessibility.tabOrder.length;\n\n    const nextElement = this.accessibility.tabOrder[newIndex];\n    if (nextElement) {\n      nextElement.focus();\n      this.accessibility.currentFocusIndex = newIndex;\n    }\n  }\n\n  /**\n   * Handle activation\n   */\n  handleActivation(event) {\n    const element = document.activeElement;\n    if (element && element.click) {\n      element.click();\n    }\n  }\n\n  /**\n   * Handle escape key\n   */\n  handleEscape(event) {\n    // Emit escape event for game to handle\n    this.eventBus.emit('input:escape', {\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Handle arrow navigation\n   */\n  handleArrowNavigation(event) {\n    // Emit arrow navigation event\n    this.eventBus.emit('input:arrowNavigation', {\n      direction: event.key.replace('Arrow', '').toLowerCase(),\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Update gamepad state\n   */\n  updateGamepadState() {\n    if (!this.settings.enableGamepad) return;\n\n    const gamepads = navigator.getGamepads();\n\n    for (let i = 0; i < gamepads.length; i++) {\n      const gamepad = gamepads[i];\n      if (!gamepad) continue;\n\n      const controller = this.gamepad.controllers.get(i);\n      if (!controller) continue;\n\n      // Update button states\n      for (let j = 0; j < gamepad.buttons.length; j++) {\n        const button = gamepad.buttons[j];\n        const wasPressed = controller.buttons.get(j)?.pressed || false;\n        const isPressed = button.pressed;\n\n        if (isPressed !== wasPressed) {\n          controller.buttons.set(j, {\n            pressed: isPressed,\n            value: button.value,\n            timestamp: Date.now(),\n          });\n\n          // Emit button event\n          this.eventBus.emit('input:gamepadButton', {\n            controller: i,\n            button: j,\n            pressed: isPressed,\n            value: button.value,\n            timestamp: Date.now(),\n          });\n        }\n      }\n\n      // Update axis states\n      for (let j = 0; j < gamepad.axes.length; j++) {\n        const axis = gamepad.axes[j];\n        const previousAxis = controller.axes.get(j) || 0;\n\n        // Apply deadzone\n        const deadzone = this.settings.deadzone;\n        const adjustedAxis = Math.abs(axis) < deadzone ? 0 : axis;\n\n        if (Math.abs(adjustedAxis - previousAxis) > 0.01) {\n          controller.axes.set(j, adjustedAxis);\n\n          // Emit axis event\n          this.eventBus.emit('input:gamepadAxis', {\n            controller: i,\n            axis: j,\n            value: adjustedAxis,\n            timestamp: Date.now(),\n          });\n        }\n      }\n    }\n  }\n\n  /**\n   * Update accessibility features\n   */\n  updateAccessibilityFeatures() {\n    // Update focusable elements if DOM has changed\n    this.updateFocusableElements();\n    this.updateTabOrder();\n  }\n\n  /**\n   * Process input events\n   */\n  processInputEvents() {\n    // Process any queued input events\n    // This could include input buffering, input prediction, etc.\n  }\n\n  /**\n   * Handle mapped actions\n   */\n  handleMappedAction(inputType, input, action, event) {\n    let mapping;\n\n    switch (inputType) {\n      case 'keyboard':\n        mapping = this.keyMappings;\n        break;\n      case 'mouse':\n        mapping = this.mouseMappings;\n        break;\n      case 'gamepad':\n        mapping = this.gamepadMappings;\n        break;\n      case 'touch':\n        mapping = this.touchMappings;\n        break;\n      default:\n        return;\n    }\n\n    // Find mapped action\n    for (const [actionName, inputs] of mapping) {\n      if (inputs.includes(input)) {\n        this.eventBus.emit('input:action', {\n          action: actionName,\n          inputType,\n          input,\n          state: action,\n          event,\n          timestamp: Date.now(),\n        });\n      }\n    }\n  }\n\n  /**\n   * Get key name from key code\n   */\n  getKeyName(keyCode) {\n    const keyNames = {\n      KeyA: 'A',\n      KeyB: 'B',\n      KeyC: 'C',\n      KeyD: 'D',\n      KeyE: 'E',\n      KeyF: 'F',\n      KeyG: 'G',\n      KeyH: 'H',\n      KeyI: 'I',\n      KeyJ: 'J',\n      KeyK: 'K',\n      KeyL: 'L',\n      KeyM: 'M',\n      KeyN: 'N',\n      KeyO: 'O',\n      KeyP: 'P',\n      KeyQ: 'Q',\n      KeyR: 'R',\n      KeyS: 'S',\n      KeyT: 'T',\n      KeyU: 'U',\n      KeyV: 'V',\n      KeyW: 'W',\n      KeyX: 'X',\n      KeyY: 'Y',\n      KeyZ: 'Z',\n      Digit0: '0',\n      Digit1: '1',\n      Digit2: '2',\n      Digit3: '3',\n      Digit4: '4',\n      Digit5: '5',\n      Digit6: '6',\n      Digit7: '7',\n      Digit8: '8',\n      Digit9: '9',\n      Space: 'Space',\n      Enter: 'Enter',\n      Escape: 'Escape',\n      Backspace: 'Backspace',\n      Tab: 'Tab',\n      ShiftLeft: 'Left Shift',\n      ShiftRight: 'Right Shift',\n      ControlLeft: 'Left Ctrl',\n      ControlRight: 'Right Ctrl',\n      AltLeft: 'Left Alt',\n      AltRight: 'Right Alt',\n      ArrowUp: 'Up Arrow',\n      ArrowDown: 'Down Arrow',\n      ArrowLeft: 'Left Arrow',\n      ArrowRight: 'Right Arrow',\n    };\n\n    return keyNames[keyCode] || keyCode;\n  }\n\n  /**\n   * Get mouse button name\n   */\n  getMouseButtonName(button) {\n    const buttonNames = {\n      0: 'Left',\n      1: 'Middle',\n      2: 'Right',\n      3: 'Back',\n      4: 'Forward',\n    };\n\n    return buttonNames[button] || `Button ${button}`;\n  }\n\n  /**\n   * Load settings from config\n   */\n  loadSettingsFromConfig() {\n    if (!this.config) return;\n\n    this.settings = {\n      ...this.settings,\n      mouseSensitivity:\n        this.config.getConfigValue('input.mouseSensitivity') ||\n        this.settings.mouseSensitivity,\n      keyboardLayout:\n        this.config.getConfigValue('input.keyboardLayout') ||\n        this.settings.keyboardLayout,\n      enableMouseLook:\n        this.config.getConfigValue('input.enableMouseLook') ??\n        this.settings.enableMouseLook,\n      enableKeyboardNavigation:\n        this.config.getConfigValue('input.enableKeyboardNavigation') ??\n        this.settings.enableKeyboardNavigation,\n      enableGamepad:\n        this.config.getConfigValue('input.enableGamepad') ??\n        this.settings.enableGamepad,\n      enableTouch:\n        this.config.getConfigValue('input.enableTouch') ??\n        this.settings.enableTouch,\n      invertY:\n        this.config.getConfigValue('input.invertY') ?? this.settings.invertY,\n      deadzone:\n        this.config.getConfigValue('input.deadzone') || this.settings.deadzone,\n    };\n  }\n\n  /**\n   * Enable input\n   */\n  enable() {\n    this.isEnabled = true;\n    this.logger.info('Input enabled');\n  }\n\n  /**\n   * Disable input\n   */\n  disable() {\n    this.isEnabled = false;\n    this.logger.info('Input disabled');\n  }\n\n  /**\n   * Capture input\n   */\n  capture() {\n    this.isCaptured = true;\n    document.body.style.cursor = 'none';\n    this.logger.info('Input captured');\n  }\n\n  /**\n   * Release input\n   */\n  release() {\n    this.isCaptured = false;\n    document.body.style.cursor = 'default';\n    this.logger.info('Input released');\n  }\n\n  /**\n   * Get input state\n   */\n  getInputState() {\n    return {\n      keyboard: Object.fromEntries(this.keys),\n      mouse: this.mouse,\n      touch: Object.fromEntries(this.touch.touches),\n      gamepad: Object.fromEntries(this.gamepad.controllers),\n      accessibility: this.accessibility,\n    };\n  }\n\n  /**\n   * Set key mapping\n   */\n  setKeyMapping(action, keys) {\n    this.keyMappings.set(action, keys);\n  }\n\n  /**\n   * Get key mapping\n   */\n  getKeyMapping(action) {\n    return this.keyMappings.get(action) || [];\n  }\n\n  /**\n   * Check if key is pressed\n   */\n  isKeyPressed(key) {\n    const keyState = this.keys.get(key);\n    return keyState ? keyState.pressed : false;\n  }\n\n  /**\n   * Check if mouse button is pressed\n   */\n  isMouseButtonPressed(button) {\n    const buttonState = this.mouse.buttons.get(button);\n    return buttonState ? buttonState.pressed : false;\n  }\n\n  /**\n   * Get mouse position\n   */\n  getMousePosition() {\n    return { x: this.mouse.x, y: this.mouse.y };\n  }\n\n  /**\n   * Get gamepad state\n   */\n  getGamepadState(index) {\n    return this.gamepad.controllers.get(index);\n  }\n\n  /**\n   * Get all gamepads\n   */\n  getAllGamepads() {\n    return Array.from(this.gamepad.controllers.values());\n  }\n\n  /**\n   * Handle mobile touch start\n   */\n  handleMobileTouchStart(touch, event) {\n    // Check if touch is on virtual joystick\n    if (this.isTouchOnVirtualJoystick(touch)) {\n      this.activateVirtualJoystick(touch);\n      return;\n    }\n\n    // Check if touch is on action buttons\n    const button = this.getTouchedButton(touch);\n    if (button) {\n      this.handleMobileButtonPress(button.id, button.key, 'down');\n      return;\n    }\n\n    // Handle gesture recognition\n    this.handleGestureStart(touch, event);\n  }\n\n  /**\n   * Handle mobile touch move\n   */\n  handleMobileTouchMove(touch, event) {\n    // Update virtual joystick if active\n    if (this.mobileUI.virtualJoystick.active && \n        this.mobileUI.virtualJoystick.touchId === touch.identifier) {\n      this.updateVirtualJoystick(touch);\n    }\n\n    // Handle gesture recognition\n    this.handleGestureMove(touch, event);\n  }\n\n  /**\n   * Handle mobile touch end\n   */\n  handleMobileTouchEnd(touch, event) {\n    // Deactivate virtual joystick if it was active\n    if (this.mobileUI.virtualJoystick.active && \n        this.mobileUI.virtualJoystick.touchId === touch.identifier) {\n      this.deactivateVirtualJoystick();\n    }\n\n    // Handle gesture recognition\n    this.handleGestureEnd(touch, event);\n  }\n\n  /**\n   * Check if touch is on virtual joystick\n   */\n  isTouchOnVirtualJoystick(touch) {\n    if (!this.mobileUI.virtualJoystick.element) return false;\n\n    const rect = this.mobileUI.virtualJoystick.element.getBoundingClientRect();\n    return touch.clientX >= rect.left && \n           touch.clientX <= rect.right && \n           touch.clientY >= rect.top && \n           touch.clientY <= rect.bottom;\n  }\n\n  /**\n   * Activate virtual joystick\n   */\n  activateVirtualJoystick(touch) {\n    this.mobileUI.virtualJoystick.active = true;\n    this.mobileUI.virtualJoystick.touchId = touch.identifier;\n    \n    const rect = this.mobileUI.virtualJoystick.element.getBoundingClientRect();\n    this.mobileUI.virtualJoystick.center = {\n      x: rect.left + rect.width / 2,\n      y: rect.top + rect.height / 2,\n    };\n\n    this.logger.info('Virtual joystick activated');\n  }\n\n  /**\n   * Update virtual joystick\n   */\n  updateVirtualJoystick(touch) {\n    if (!this.mobileUI.virtualJoystick.active) return;\n\n    const center = this.mobileUI.virtualJoystick.center;\n    const deltaX = touch.clientX - center.x;\n    const deltaY = touch.clientY - center.y;\n    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n    const maxDistance = this.settings.mobileUI.joystickSize / 2;\n\n    // Clamp to joystick radius\n    const clampedDistance = Math.min(distance, maxDistance);\n    const angle = Math.atan2(deltaY, deltaX);\n\n    const knobX = Math.cos(angle) * clampedDistance;\n    const knobY = Math.sin(angle) * clampedDistance;\n\n    // Update knob position\n    if (this.mobileUI.virtualJoystick.knob) {\n      this.mobileUI.virtualJoystick.knob.style.transform = \n        `translate(calc(-50% + ${knobX}px), calc(-50% + ${knobY}px))`;\n    }\n\n    // Calculate normalized values\n    const normalizedX = deltaX / maxDistance;\n    const normalizedY = deltaY / maxDistance;\n\n    // Apply deadzone\n    const deadzone = this.settings.mobileUI.joystickDeadzone;\n    const finalX = Math.abs(normalizedX) < deadzone ? 0 : normalizedX;\n    const finalY = Math.abs(normalizedY) < deadzone ? 0 : normalizedY;\n\n    // Emit joystick movement event\n    this.eventBus.emit('input:joystickMove', {\n      x: finalX,\n      y: finalY,\n      angle: angle * 180 / Math.PI,\n      distance: clampedDistance / maxDistance,\n      timestamp: Date.now(),\n    });\n\n    // Map to keyboard events for compatibility\n    this.mapJoystickToKeyboard(finalX, finalY);\n  }\n\n  /**\n   * Deactivate virtual joystick\n   */\n  deactivateVirtualJoystick() {\n    this.mobileUI.virtualJoystick.active = false;\n    this.mobileUI.virtualJoystick.touchId = null;\n\n    // Reset knob position\n    if (this.mobileUI.virtualJoystick.knob) {\n      this.mobileUI.virtualJoystick.knob.style.transform = 'translate(-50%, -50%)';\n    }\n\n    // Emit joystick release event\n    this.eventBus.emit('input:joystickRelease', {\n      timestamp: Date.now(),\n    });\n\n    this.logger.info('Virtual joystick deactivated');\n  }\n\n  /**\n   * Map joystick movement to keyboard events\n   */\n  mapJoystickToKeyboard(x, y) {\n    const threshold = 0.3;\n\n    // Horizontal movement\n    if (x > threshold) {\n      this.handleMappedAction('keyboard', 'KeyD', 'down', { synthetic: true });\n    } else if (x < -threshold) {\n      this.handleMappedAction('keyboard', 'KeyA', 'down', { synthetic: true });\n    }\n\n    // Vertical movement\n    if (y > threshold) {\n      this.handleMappedAction('keyboard', 'KeyS', 'down', { synthetic: true });\n    } else if (y < -threshold) {\n      this.handleMappedAction('keyboard', 'KeyW', 'down', { synthetic: true });\n    }\n  }\n\n  /**\n   * Get touched button\n   */\n  getTouchedButton(touch) {\n    for (const [id, button] of this.mobileUI.actionButtons) {\n      const rect = button.getBoundingClientRect();\n      if (touch.clientX >= rect.left && \n          touch.clientX <= rect.right && \n          touch.clientY >= rect.top && \n          touch.clientY <= rect.bottom) {\n        return { id, key: this.getButtonKey(id) };\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Get button key mapping\n   */\n  getButtonKey(buttonId) {\n    const keyMap = {\n      jump: 'Space',\n      interact: 'KeyE',\n      crouch: 'KeyC',\n      run: 'ShiftLeft',\n      menu: 'KeyM',\n      pause: 'Escape',\n    };\n    return keyMap[buttonId] || null;\n  }\n\n  /**\n   * Handle mobile button press\n   */\n  handleMobileButtonPress(buttonId, key, action) {\n    // Emit haptic feedback if enabled\n    if (this.settings.mobileControls.hapticFeedback && navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    // Emit input event\n    this.eventBus.emit('input:mobileButton', {\n      buttonId,\n      key,\n      action,\n      timestamp: Date.now(),\n    });\n\n    // Map to keyboard event for compatibility\n    if (key) {\n      this.handleMappedAction('keyboard', key, action, { synthetic: true });\n    }\n\n    this.logger.info(`Mobile button ${action}: ${buttonId}`);\n  }\n\n  /**\n   * Handle gesture start\n   */\n  handleGestureStart(touch, event) {\n    const currentTime = Date.now();\n    \n    // Check for double tap\n    if (this.settings.gestures.enableDoubleTap) {\n      const timeDiff = currentTime - this.touch.lastTapTime;\n      const distance = this.getDistance(touch, this.touch.lastTapPosition);\n      \n      if (timeDiff < this.settings.mobileControls.doubleTapDelay && distance < 50) {\n        this.handleDoubleTap(touch);\n        return;\n      }\n    }\n\n    // Set up long press timer\n    if (this.settings.gestures.enableLongPress) {\n      this.touch.longPressTimer = setTimeout(() => {\n        this.handleLongPress(touch);\n      }, this.settings.mobileControls.longPressDelay);\n    }\n\n    // Update last tap info\n    this.touch.lastTapTime = currentTime;\n    this.touch.lastTapPosition = { x: touch.clientX, y: touch.clientY };\n  }\n\n  /**\n   * Handle gesture move\n   */\n  handleGestureMove(touch, event) {\n    // Clear long press timer if moving\n    if (this.touch.longPressTimer) {\n      clearTimeout(this.touch.longPressTimer);\n      this.touch.longPressTimer = null;\n    }\n  }\n\n  /**\n   * Handle gesture end\n   */\n  handleGestureEnd(touch, event) {\n    // Clear long press timer\n    if (this.touch.longPressTimer) {\n      clearTimeout(this.touch.longPressTimer);\n      this.touch.longPressTimer = null;\n    }\n\n    // Check for swipe\n    if (this.settings.gestures.enableSwipe) {\n      this.checkForSwipe(touch, touch);\n    }\n  }\n\n  /**\n   * Check for swipe gesture\n   */\n  checkForSwipe(startTouch, endTouch) {\n    const deltaX = endTouch.clientX - startTouch.startX;\n    const deltaY = endTouch.clientY - startTouch.startY;\n    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n    \n    if (distance < this.settings.mobileControls.swipeThreshold) {\n      return; // Not a swipe\n    }\n\n    const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;\n    let direction = '';\n\n    if (angle > -45 && angle <= 45) {\n      direction = 'right';\n    } else if (angle > 45 && angle <= 135) {\n      direction = 'down';\n    } else if (angle > 135 || angle <= -135) {\n      direction = 'left';\n    } else if (angle > -135 && angle <= -45) {\n      direction = 'up';\n    }\n\n    if (this.settings.gestures.swipeDirections.includes(direction)) {\n      this.handleSwipeGesture(direction, distance);\n    }\n  }\n\n  /**\n   * Handle swipe gesture\n   */\n  handleSwipeGesture(direction, distance) {\n    this.eventBus.emit('input:swipe', {\n      direction,\n      distance,\n      timestamp: Date.now(),\n    });\n\n    this.logger.info(`Swipe detected: ${direction}`);\n  }\n\n  /**\n   * Handle pinch gesture\n   */\n  handlePinchGesture(scale) {\n    this.eventBus.emit('input:pinch', {\n      scale,\n      timestamp: Date.now(),\n    });\n\n    this.logger.info(`Pinch detected: ${scale.toFixed(2)}`);\n  }\n\n  /**\n   * Handle rotate gesture\n   */\n  handleRotateGesture(rotation) {\n    this.eventBus.emit('input:rotate', {\n      rotation,\n      timestamp: Date.now(),\n    });\n\n    this.logger.info(`Rotate detected: ${rotation.toFixed(2)}°`);\n  }\n\n  /**\n   * Handle double tap\n   */\n  handleDoubleTap(touch) {\n    this.eventBus.emit('input:doubleTap', {\n      x: touch.clientX,\n      y: touch.clientY,\n      timestamp: Date.now(),\n    });\n\n    this.logger.info('Double tap detected');\n  }\n\n  /**\n   * Handle long press\n   */\n  handleLongPress(touch) {\n    this.eventBus.emit('input:longPress', {\n      x: touch.clientX,\n      y: touch.clientY,\n      timestamp: Date.now(),\n    });\n\n    this.logger.info('Long press detected');\n  }\n\n  /**\n   * Get distance between two touch points\n   */\n  getDistance(touch1, touch2) {\n    const dx = touch1.clientX - touch2.clientX;\n    const dy = touch1.clientY - touch2.clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Get angle between two touch points\n   */\n  getAngle(touch1, touch2) {\n    return Math.atan2(touch2.clientY - touch1.clientY, touch2.clientX - touch1.clientX);\n  }\n\n  /**\n   * Update mobile controls visibility\n   */\n  updateMobileControlsVisibility(visible) {\n    this.mobileUI.isVisible = visible;\n    \n    if (this.mobileControlsContainer) {\n      this.mobileControlsContainer.style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Update mobile controls settings\n   */\n  updateMobileSettings(newSettings) {\n    this.settings.mobileControls = { ...this.settings.mobileControls, ...newSettings };\n    this.settings.gestures = { ...this.settings.gestures, ...newSettings.gestures };\n    this.settings.mobileUI = { ...this.settings.mobileUI, ...newSettings.mobileUI };\n\n    // Recreate mobile UI if needed\n    if (this.mobileControlsContainer) {\n      this.mobileControlsContainer.remove();\n      this.createMobileUI();\n    }\n\n    this.logger.info('Mobile settings updated');\n  }\n\n  /**\n   * Get mobile controls state\n   */\n  getMobileControlsState() {\n    return {\n      isMobile: this.isMobile,\n      isVisible: this.mobileUI.isVisible,\n      orientation: this.mobileUI.orientation,\n      virtualJoystick: {\n        active: this.mobileUI.virtualJoystick.active,\n        position: this.mobileUI.virtualJoystick.position,\n      },\n      settings: {\n        mobileControls: this.settings.mobileControls,\n        gestures: this.settings.gestures,\n        mobileUI: this.settings.mobileUI,\n      },\n    };\n  }\n}\n\nexport default InputManager;\n"],"names":["EventBus","constructor","this","listeners","Map","eventHistory","maxHistorySize","debug","performanceMetrics","totalEvents","averageProcessingTime","slowestEvent","eventCounts","on","event","callback","options","Error","has","set","listener","once","priority","id","context","get","push","sort","a","b","log","concat","off","eventListeners","index","findIndex","splice","removeAllListeners","delete","clear","removeListener","emit","data","startTime","performance","now","eventData","timestamp","Date","generateEventId","addToHistory","updatePerformanceMetrics","listenersToRemove","i","length","call","error","emitAsync","Promise","resolve","reject","waitFor","timeout","timeoutId","setTimeout","handler","clearTimeout","shift","processingTime","totalTime","time","count","Math","random","toString","substr","getHistory","filter","history","item","since","until","limit","slice","getPerformanceMetrics","Object","fromEntries","clearHistory","resetMetrics","enableDebug","disableDebug","message","getListenerCount","getRegisteredEvents","Array","from","keys","hasListeners","createFilter","condition","createTransformer","transform","transformedData","destroy","PerformanceMonitor","dependencies","eventBus","logger","config","enableFPSMonitoring","enableMemoryMonitoring","enableAudioMonitoring","enableRenderingMonitoring","enableInputMonitoring","enableNetworkMonitoring","enableAutoOptimization","fpsTarget","fpsWarningThreshold","fpsCriticalThreshold","memoryWarningThreshold","memoryCriticalThreshold","frameTimeWarningThreshold","frameTimeCriticalThreshold","reportInterval","metrics","fps","current","average","min","Infinity","max","droppedFrames","frameTime","memory","used","total","available","leakDetected","leakCount","audio","contextState","contextRecreations","bufferUnderruns","latency","performanceScore","rendering","drawCalls","triangles","textures","shaders","batchCount","cullingTime","lightingTime","postProcessingTime","input","lag","eventCount","droppedEvents","averageResponseTime","network","bandwidth","packetLoss","connectionQuality","isMonitoring","lastFrameTime","frameCount","lastReportTime","optimizationSuggestions","performanceAlerts","observers","setupPerformanceMonitoring","setupEventHandlers","info","initialize","startMonitoring","cleanup","stopMonitoring","disconnectObservers","setupFPSMonitoring","setupMemoryMonitoring","setupAudioMonitoring","setupRenderingMonitoring","setupInputMonitoring","setupNetworkMonitoring","handleGameStarted","bind","handleGamePaused","handleGameResumed","handleGameStopped","handleFrame","handleMemoryUpdate","handleAudioUpdate","handleRenderingUpdate","handleInputUpdate","handleNetworkUpdate","measureFPS","currentTime","deltaTime","updateFPSMetrics","requestAnimationFrame","warn","measureMemory","updateMemoryMetrics","detectMemoryLeaks","measureAudio","checkAudioContextHealth","measureRendering","updateRenderingMetrics","lastInputTime","measureInput","responseTime","updateInputMetrics","document","addEventListener","measureNetwork","updateNetworkMetrics","removeEventListener","reduce","checkFPSPerformance","usedJSHeapSize","totalJSHeapSize","jsHeapSizeLimit","checkMemoryPerformance","updateAudioMetrics","audioData","checkAudioPerformance","checkInputPerformance","addPerformanceAlert","threshold","suggestOptimization","recreations","underruns","recent","every","entry","level","alert","category","suggestion","optimization","getPerformanceReport","alerts","suggestions","getPerformanceScore","score","memoryUsage","updateConfig","newConfig","getMetrics","getAlerts","getOptimizationSuggestions","clearAlerts","clearOptimizationSuggestions","InputManager","mouse","x","y","buttons","wheel","touch","touches","gestures","activeGestures","lastTapTime","lastTapPosition","longPressTimer","doubleTapTimer","mobileUI","virtualJoystick","active","center","position","radius","touchId","actionButtons","isVisible","orientation","gamepad","controllers","lastUpdate","keyMappings","mouseMappings","gamepadMappings","touchMappings","accessibility","keyboardNavigation","focusManagement","tabOrder","currentFocusIndex","focusableElements","Set","skipLinks","settings","mouseSensitivity","keyboardLayout","enableMouseLook","enableKeyboardNavigation","enableGamepad","enableTouch","invertY","deadzone","repeatDelay","repeatRate","mobileControls","enabled","layout","size","opacity","showLabels","hapticFeedback","gestureSensitivity","touchDeadzone","multiTouch","pinchToZoom","swipeThreshold","longPressDelay","doubleTapDelay","enableSwipe","enablePinch","enableRotate","enableLongPress","enableDoubleTap","swipeDirections","pinchThreshold","rotateThreshold","showVirtualJoystick","showActionButtons","showMenuButton","showPauseButton","buttonSpacing","buttonSize","joystickSize","joystickDeadzone","buttonOpacity","buttonPressScale","enableButtonHaptics","boundHandlers","isEnabled","isCaptured","initializeInputMappings","setupAccessibility","setupMobileControls","loadSettingsFromConfig","setupFocusManagement","removeEventHandlers","update","updateGamepadState","updateAccessibilityFeatures","processInputEvents","handleKeyDown","handleKeyUp","handleKeyPress","handleMouseDown","handleMouseUp","handleMouseMove","handleWheel","handleContextMenu","handleTouchStart","handleTouchEnd","handleTouchMove","handleTouchCancel","handleGamepadConnected","handleGamepadDisconnected","handleFocusIn","handleFocusOut","addEventListeners","passive","updateFocusableElements","updateTabOrder","setupSkipLinks","querySelectorAll","join","forEach","element","add","parseInt","getAttribute","text","target","link","window","navigator","userAgent","includes","detectMobileDevice","createMobileUI","setupOrientationHandling","setupGestureRecognition","isMobile","test","isTouch","maxTouchPoints","mobileControlsContainer","createElement","className","style","cssText","nodeType","createVirtualJoystick","createActionButtons","createMenuButton","createPauseButton","body","appendChild","joystickContainer","joystickBase","joystickKnob","base","knob","buttonContainer","label","key","button","buttonElement","textContent","e","preventDefault","handleMobileButtonPress","menuButton","innerHTML","pauseButton","updateOrientation","isPortrait","innerHeight","innerWidth","adjustMobileControlsForOrientation","height","setupBasicGestureDetection","startTouches","startDistance","startAngle","getDistance","getAngle","scale","abs","handlePinchGesture","rotation","handleRotateGesture","checkForSwipe","changedTouches","code","keyName","getKeyName","pressed","repeat","handleAccessibilityKeyDown","keyCode","ctrlKey","shiftKey","altKey","metaKey","handleMappedAction","charCode","buttonName","getMouseButtonName","clientX","clientY","deltaX","deltaY","sensitivity","adjustedDeltaX","adjustedDeltaY","direction","identifier","startX","startY","pressure","force","handleMobileTouchStart","map","handleMobileTouchEnd","touchData","handleMobileTouchMove","connected","axes","indexOf","handleTabNavigation","handleActivation","handleEscape","handleArrowNavigation","newIndex","nextElement","focus","activeElement","click","replace","toLowerCase","_a","gamepads","getGamepads","controller","j","wasPressed","isPressed","value","axis","previousAxis","adjustedAxis","inputType","action","mapping","actionName","inputs","state","KeyA","KeyB","KeyC","KeyD","KeyE","KeyF","KeyG","KeyH","KeyI","KeyJ","KeyK","KeyL","KeyM","KeyN","KeyO","KeyP","KeyQ","KeyR","KeyS","KeyT","KeyU","KeyV","KeyW","KeyX","KeyY","KeyZ","Digit0","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Space","Enter","Escape","Backspace","Tab","ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","_b","_c","_d","_e","getConfigValue","enable","disable","capture","cursor","release","getInputState","keyboard","setKeyMapping","getKeyMapping","isKeyPressed","keyState","isMouseButtonPressed","buttonState","getMousePosition","getGamepadState","getAllGamepads","values","isTouchOnVirtualJoystick","activateVirtualJoystick","getTouchedButton","handleGestureStart","updateVirtualJoystick","handleGestureMove","deactivateVirtualJoystick","handleGestureEnd","rect","getBoundingClientRect","left","right","top","bottom","width","distance","sqrt","maxDistance","clampedDistance","angle","atan2","knobX","cos","knobY","sin","normalizedX","normalizedY","finalX","finalY","PI","mapJoystickToKeyboard","synthetic","getButtonKey","buttonId","jump","interact","crouch","run","menu","pause","vibrate","timeDiff","handleDoubleTap","handleLongPress","startTouch","endTouch","handleSwipeGesture","toFixed","touch1","touch2","dx","dy","updateMobileControlsVisibility","visible","display","updateMobileSettings","newSettings","remove","getMobileControlsState"],"mappings":"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"}