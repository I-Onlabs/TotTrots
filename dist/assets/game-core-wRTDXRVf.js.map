{"version":3,"file":"game-core-wRTDXRVf.js","sources":["../../src/utils/Logger.js","../../src/utils/MobileTesting.js","../../src/ui/SettingsUI.js","../../src/GameRefactored.js"],"sourcesContent":["/**\n * Logger.js - Centralized logging system\n *\n * This class provides:\n * - Multiple log levels\n * - Log filtering and formatting\n * - Performance monitoring\n * - Log persistence\n * - Debug utilities\n */\n\nexport class Logger {\n  constructor(debug = false) {\n    this.debug = debug;\n    this.logLevel = debug ? 'debug' : 'info';\n    this.logHistory = [];\n    this.maxHistorySize = 1000;\n    this.performanceMetrics = {\n      totalLogs: 0,\n      logsByLevel: new Map(),\n      averageLogTime: 0,\n    };\n\n    // Log levels\n    this.levels = {\n      error: 0,\n      warn: 1,\n      info: 2,\n      debug: 3,\n      trace: 4,\n    };\n\n    // Initialize performance monitoring\n    this.startTime = Date.now();\n  }\n\n  /**\n   * Set log level\n   */\n  setLevel(level) {\n    if (Object.prototype.hasOwnProperty.call(this.levels, level)) {\n      this.logLevel = level;\n    } else {\n      this.warn(`Invalid log level: ${level}`);\n    }\n  }\n\n  /**\n   * Enable debug mode\n   */\n  enableDebug() {\n    this.debug = true;\n    this.setLevel('debug');\n  }\n\n  /**\n   * Disable debug mode\n   */\n  disableDebug() {\n    this.debug = false;\n    this.setLevel('info');\n  }\n\n  /**\n   * Check if log level should be processed\n   */\n  shouldLog(level) {\n    return this.levels[level] <= this.levels[this.logLevel];\n  }\n\n  /**\n   * Log a message\n   */\n  log(level, message, data = null, context = null) {\n    if (!this.shouldLog(level)) {\n      return;\n    }\n\n    const timestamp = Date.now();\n    const logEntry = {\n      level,\n      message,\n      data,\n      context,\n      timestamp,\n      id: this.generateLogId(),\n    };\n\n    // Add to history\n    this.addToHistory(logEntry);\n\n    // Update performance metrics\n    this.updatePerformanceMetrics(level);\n\n    // Format and output log\n    this.outputLog(logEntry);\n  }\n\n  /**\n   * Add log entry to history\n   */\n  addToHistory(logEntry) {\n    this.logHistory.push(logEntry);\n\n    // Maintain history size limit\n    if (this.logHistory.length > this.maxHistorySize) {\n      this.logHistory.shift();\n    }\n  }\n\n  /**\n   * Update performance metrics\n   */\n  updatePerformanceMetrics(level) {\n    this.performanceMetrics.totalLogs++;\n\n    const count = this.performanceMetrics.logsByLevel.get(level) || 0;\n    this.performanceMetrics.logsByLevel.set(level, count + 1);\n\n    // Update average log time\n    const totalTime =\n      this.performanceMetrics.averageLogTime *\n      (this.performanceMetrics.totalLogs - 1);\n    this.performanceMetrics.averageLogTime =\n      (totalTime + 1) / this.performanceMetrics.totalLogs;\n  }\n\n  /**\n   * Output log to console\n   */\n  outputLog(logEntry) {\n    const { level, message, data, context, timestamp } = logEntry;\n    const timeString = new Date(timestamp).toISOString();\n    const contextString = context ? `[${context}]` : '';\n    const prefix = `[${timeString}] ${level.toUpperCase()}${contextString}`;\n\n    switch (level) {\n      case 'error':\n        console.error(prefix, message, data || '');\n        break;\n      case 'warn':\n        console.warn(prefix, message, data || '');\n        break;\n      case 'info':\n        console.info(prefix, message, data || '');\n        break;\n      case 'debug':\n        console.debug(prefix, message, data || '');\n        break;\n      case 'trace':\n        console.trace(prefix, message, data || '');\n        break;\n      default:\n        console.log(prefix, message, data || '');\n    }\n  }\n\n  /**\n   * Generate unique log ID\n   */\n  generateLogId() {\n    return `log_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  /**\n   * Error level logging\n   */\n  error(message, data = null, context = null) {\n    this.log('error', message, data, context);\n  }\n\n  /**\n   * Warning level logging\n   */\n  warn(message, data = null, context = null) {\n    this.log('warn', message, data, context);\n  }\n\n  /**\n   * Info level logging\n   */\n  info(message, data = null, context = null) {\n    this.log('info', message, data, context);\n  }\n\n  /**\n   * Debug level logging\n   */\n  debug(message, data = null, context = null) {\n    this.log('debug', message, data, context);\n  }\n\n  /**\n   * Trace level logging\n   */\n  trace(message, data = null, context = null) {\n    this.log('trace', message, data, context);\n  }\n\n  /**\n   * Log performance metrics\n   */\n  performance(operation, startTime, endTime = null) {\n    const duration = (endTime || performance.now()) - startTime;\n    this.debug(`Performance: ${operation} took ${duration.toFixed(2)}ms`);\n    return duration;\n  }\n\n  /**\n   * Log memory usage\n   */\n  memory() {\n    if (performance.memory) {\n      const memory = performance.memory;\n      this.debug('Memory usage:', {\n        used: `${Math.round(memory.usedJSHeapSize / 1024 / 1024)}MB`,\n        total: `${Math.round(memory.totalJSHeapSize / 1024 / 1024)}MB`,\n        limit: `${Math.round(memory.jsHeapSizeLimit / 1024 / 1024)}MB`,\n      });\n    }\n  }\n\n  /**\n   * Log function execution\n   */\n  function(name, fn, context = null) {\n    const startTime = performance.now();\n    this.debug(`Function started: ${name}`, null, context);\n\n    try {\n      const result = fn();\n      const duration = this.performance(name, startTime);\n      this.debug(`Function completed: ${name}`, { duration }, context);\n      return result;\n    } catch (error) {\n      const duration = this.performance(name, startTime);\n      this.error(\n        `Function failed: ${name}`,\n        { error: error.message, duration },\n        context\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Log async function execution\n   */\n  async functionAsync(name, fn, context = null) {\n    const startTime = performance.now();\n    this.debug(`Async function started: ${name}`, null, context);\n\n    try {\n      const result = await fn();\n      const duration = this.performance(name, startTime);\n      this.debug(`Async function completed: ${name}`, { duration }, context);\n      return result;\n    } catch (error) {\n      const duration = this.performance(name, startTime);\n      this.error(\n        `Async function failed: ${name}`,\n        { error: error.message, duration },\n        context\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Log event\n   */\n  event(eventName, data = null, context = null) {\n    this.debug(`Event: ${eventName}`, data, context);\n  }\n\n  /**\n   * Log state change\n   */\n  stateChange(from, to, data = null, context = null) {\n    this.info(`State changed: ${from} -> ${to}`, data, context);\n  }\n\n  /**\n   * Log user action\n   */\n  userAction(action, data = null, context = null) {\n    this.info(`User action: ${action}`, data, context);\n  }\n\n  /**\n   * Log API call\n   */\n  apiCall(method, url, data = null, context = null) {\n    this.debug(`API call: ${method} ${url}`, data, context);\n  }\n\n  /**\n   * Log API response\n   */\n  apiResponse(method, url, status, data = null, context = null) {\n    const level = status >= 400 ? 'error' : 'debug';\n    this.log(\n      level,\n      `API response: ${method} ${url} - ${status}`,\n      data,\n      context\n    );\n  }\n\n  /**\n   * Log error with stack trace\n   */\n  errorWithStack(message, error, context = null) {\n    this.error(\n      message,\n      {\n        error: error.message,\n        stack: error.stack,\n      },\n      context\n    );\n  }\n\n  /**\n   * Log group of related messages\n   */\n  group(name, fn, context = null) {\n    const startTime = performance.now();\n    this.debug(`Group started: ${name}`, null, context);\n\n    try {\n      const result = fn();\n      const duration = this.performance(name, startTime);\n      this.debug(`Group completed: ${name}`, { duration }, context);\n      return result;\n    } catch (error) {\n      const duration = this.performance(name, startTime);\n      this.error(\n        `Group failed: ${name}`,\n        { error: error.message, duration },\n        context\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Log async group of related messages\n   */\n  async groupAsync(name, fn, context = null) {\n    const startTime = performance.now();\n    this.debug(`Async group started: ${name}`, null, context);\n\n    try {\n      const result = await fn();\n      const duration = this.performance(name, startTime);\n      this.debug(`Async group completed: ${name}`, { duration }, context);\n      return result;\n    } catch (error) {\n      const duration = this.performance(name, startTime);\n      this.error(\n        `Async group failed: ${name}`,\n        { error: error.message, duration },\n        context\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Get log history\n   */\n  getHistory(filter = {}) {\n    let history = [...this.logHistory];\n\n    if (filter.level) {\n      history = history.filter((entry) => entry.level === filter.level);\n    }\n\n    if (filter.context) {\n      history = history.filter((entry) => entry.context === filter.context);\n    }\n\n    if (filter.since) {\n      history = history.filter((entry) => entry.timestamp >= filter.since);\n    }\n\n    if (filter.until) {\n      history = history.filter((entry) => entry.timestamp <= filter.until);\n    }\n\n    if (filter.limit) {\n      history = history.slice(-filter.limit);\n    }\n\n    return history;\n  }\n\n  /**\n   * Get performance metrics\n   */\n  getPerformanceMetrics() {\n    return {\n      ...this.performanceMetrics,\n      logsByLevel: Object.fromEntries(this.performanceMetrics.logsByLevel),\n      uptime: Date.now() - this.startTime,\n    };\n  }\n\n  /**\n   * Clear log history\n   */\n  clearHistory() {\n    this.logHistory = [];\n    this.debug('Log history cleared');\n  }\n\n  /**\n   * Reset performance metrics\n   */\n  resetMetrics() {\n    this.performanceMetrics = {\n      totalLogs: 0,\n      logsByLevel: new Map(),\n      averageLogTime: 0,\n    };\n    this.startTime = Date.now();\n    this.debug('Performance metrics reset');\n  }\n\n  /**\n   * Export logs to JSON\n   */\n  exportLogs(filter = {}) {\n    const history = this.getHistory(filter);\n    return JSON.stringify(history, null, 2);\n  }\n\n  /**\n   * Import logs from JSON\n   */\n  importLogs(jsonString) {\n    try {\n      const logs = JSON.parse(jsonString);\n      if (Array.isArray(logs)) {\n        this.logHistory = logs;\n        this.debug(`Imported ${logs.length} log entries`);\n      }\n    } catch (error) {\n      this.error('Failed to import logs:', error);\n    }\n  }\n\n  /**\n   * Create a child logger with context\n   */\n  child(context) {\n    const childLogger = new Logger(this.debug);\n    childLogger.logLevel = this.logLevel;\n    childLogger.context = context;\n    return childLogger;\n  }\n}\n\nexport default Logger;\n","/**\n * MobileTesting.js - Mobile UX testing and validation utilities\n *\n * This utility provides:\n * - Mobile device detection and testing\n * - Touch gesture validation\n * - Mobile controls testing\n * - Performance testing on mobile devices\n * - Accessibility testing for mobile\n * - Mobile-specific UI validation\n */\n\nexport class MobileTesting {\n  constructor(dependencies = {}) {\n    // Dependency injection\n    this.eventBus = dependencies.eventBus;\n    this.logger = dependencies.logger;\n    this.inputManager = dependencies.inputManager;\n    this.performanceMonitor = dependencies.performanceMonitor;\n\n    // Test configuration\n    this.config = {\n      enableAutoTesting: true,\n      testInterval: 5000,\n      gestureTestTimeout: 2000,\n      performanceTestDuration: 10000,\n      enableAccessibilityTesting: true,\n      enablePerformanceTesting: true,\n      enableGestureTesting: true,\n      enableControlTesting: true,\n      ...dependencies.config,\n    };\n\n    // Test state\n    this.isTesting = false;\n    this.testResults = {\n      device: null,\n      gestures: new Map(),\n      controls: new Map(),\n      performance: null,\n      accessibility: null,\n      overall: null,\n    };\n\n    // Test listeners\n    this.testListeners = new Map();\n\n    this.logger.info('MobileTesting initialized');\n  }\n\n  /**\n   * Initialize the testing utility\n   */\n  async initialize() {\n    this.logger.info('Initializing MobileTesting...');\n\n    // Detect mobile device\n    this.detectMobileDevice();\n\n    // Set up test listeners\n    this.setupTestListeners();\n\n    // Start auto-testing if enabled\n    if (this.config.enableAutoTesting) {\n      this.startAutoTesting();\n    }\n\n    this.logger.info('MobileTesting initialized successfully');\n  }\n\n  /**\n   * Cleanup the testing utility\n   */\n  cleanup() {\n    this.logger.info('Cleaning up MobileTesting...');\n\n    // Stop auto-testing\n    this.stopAutoTesting();\n\n    // Remove test listeners\n    this.removeTestListeners();\n\n    this.logger.info('MobileTesting cleaned up');\n  }\n\n  /**\n   * Detect mobile device and capabilities\n   */\n  detectMobileDevice() {\n    const userAgent = navigator.userAgent;\n    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);\n    const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n    const isTablet = /iPad|Android/i.test(userAgent) && 'ontouchstart' in window;\n\n    this.testResults.device = {\n      isMobile,\n      isTouch,\n      isTablet,\n      userAgent,\n      screenWidth: window.screen.width,\n      screenHeight: window.screen.height,\n      viewportWidth: window.innerWidth,\n      viewportHeight: window.innerHeight,\n      pixelRatio: window.devicePixelRatio || 1,\n      orientation: window.innerHeight > window.innerWidth ? 'portrait' : 'landscape',\n      maxTouchPoints: navigator.maxTouchPoints || 0,\n      hasVibration: 'vibrate' in navigator,\n      hasHaptics: 'vibrate' in navigator,\n      hasGeolocation: 'geolocation' in navigator,\n      hasCamera: 'mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices,\n      hasAccelerometer: 'DeviceMotionEvent' in window,\n      hasGyroscope: 'DeviceOrientationEvent' in window,\n    };\n\n    this.logger.info('Mobile device detected:', this.testResults.device);\n  }\n\n  /**\n   * Set up test listeners\n   */\n  setupTestListeners() {\n    // Gesture test listeners\n    if (this.config.enableGestureTesting) {\n      this.setupGestureTestListeners();\n    }\n\n    // Control test listeners\n    if (this.config.enableControlTesting) {\n      this.setupControlTestListeners();\n    }\n\n    // Performance test listeners\n    if (this.config.enablePerformanceTesting) {\n      this.setupPerformanceTestListeners();\n    }\n\n    // Accessibility test listeners\n    if (this.config.enableAccessibilityTesting) {\n      this.setupAccessibilityTestListeners();\n    }\n  }\n\n  /**\n   * Set up gesture test listeners\n   */\n  setupGestureTestListeners() {\n    const gestureTests = [\n      { name: 'tap', test: this.testTapGesture.bind(this) },\n      { name: 'doubleTap', test: this.testDoubleTapGesture.bind(this) },\n      { name: 'longPress', test: this.testLongPressGesture.bind(this) },\n      { name: 'swipe', test: this.testSwipeGesture.bind(this) },\n      { name: 'pinch', test: this.testPinchGesture.bind(this) },\n      { name: 'rotate', test: this.testRotateGesture.bind(this) },\n    ];\n\n    gestureTests.forEach(({ name, test }) => {\n      this.testListeners.set(`gesture:${name}`, test);\n    });\n  }\n\n  /**\n   * Set up control test listeners\n   */\n  setupControlTestListeners() {\n    const controlTests = [\n      { name: 'virtualJoystick', test: this.testVirtualJoystick.bind(this) },\n      { name: 'actionButtons', test: this.testActionButtons.bind(this) },\n      { name: 'menuButton', test: this.testMenuButton.bind(this) },\n      { name: 'pauseButton', test: this.testPauseButton.bind(this) },\n    ];\n\n    controlTests.forEach(({ name, test }) => {\n      this.testListeners.set(`control:${name}`, test);\n    });\n  }\n\n  /**\n   * Set up performance test listeners\n   */\n  setupPerformanceTestListeners() {\n    this.testListeners.set('performance:test', this.testPerformance.bind(this));\n  }\n\n  /**\n   * Set up accessibility test listeners\n   */\n  setupAccessibilityTestListeners() {\n    this.testListeners.set('accessibility:test', this.testAccessibility.bind(this));\n  }\n\n  /**\n   * Remove test listeners\n   */\n  removeTestListeners() {\n    this.testListeners.clear();\n  }\n\n  /**\n   * Start auto-testing\n   */\n  startAutoTesting() {\n    if (this.isTesting) return;\n\n    this.isTesting = true;\n    this.autoTestInterval = setInterval(() => {\n      this.runAllTests();\n    }, this.config.testInterval);\n\n    this.logger.info('Auto-testing started');\n  }\n\n  /**\n   * Stop auto-testing\n   */\n  stopAutoTesting() {\n    if (!this.isTesting) return;\n\n    this.isTesting = false;\n    if (this.autoTestInterval) {\n      clearInterval(this.autoTestInterval);\n      this.autoTestInterval = null;\n    }\n\n    this.logger.info('Auto-testing stopped');\n  }\n\n  /**\n   * Run all tests\n   */\n  async runAllTests() {\n    this.logger.info('Running mobile tests...');\n\n    try {\n      // Test gestures\n      if (this.config.enableGestureTesting) {\n        await this.testAllGestures();\n      }\n\n      // Test controls\n      if (this.config.enableControlTesting) {\n        await this.testAllControls();\n      }\n\n      // Test performance\n      if (this.config.enablePerformanceTesting) {\n        await this.testPerformance();\n      }\n\n      // Test accessibility\n      if (this.config.enableAccessibilityTesting) {\n        await this.testAccessibility();\n      }\n\n      // Calculate overall score\n      this.calculateOverallScore();\n\n      // Emit test results\n      this.eventBus.emit('mobileTesting:results', this.testResults);\n\n      this.logger.info('Mobile tests completed');\n    } catch (error) {\n      this.logger.error('Error running mobile tests:', error);\n    }\n  }\n\n  /**\n   * Test all gestures\n   */\n  async testAllGestures() {\n    const gestureNames = ['tap', 'doubleTap', 'longPress', 'swipe', 'pinch', 'rotate'];\n    \n    for (const gestureName of gestureNames) {\n      try {\n        const result = await this.testGesture(gestureName);\n        this.testResults.gestures.set(gestureName, result);\n      } catch (error) {\n        this.logger.error(`Error testing gesture ${gestureName}:`, error);\n        this.testResults.gestures.set(gestureName, { success: false, error: error.message });\n      }\n    }\n  }\n\n  /**\n   * Test a specific gesture\n   */\n  async testGesture(gestureName) {\n    const testFunction = this.testListeners.get(`gesture:${gestureName}`);\n    if (!testFunction) {\n      throw new Error(`No test function found for gesture: ${gestureName}`);\n    }\n\n    return await testFunction();\n  }\n\n  /**\n   * Test tap gesture\n   */\n  async testTapGesture() {\n    return new Promise((resolve) => {\n      let tapDetected = false;\n      let startTime = Date.now();\n\n      const handleTap = () => {\n        tapDetected = true;\n        const responseTime = Date.now() - startTime;\n        document.removeEventListener('touchstart', handleTap);\n        resolve({\n          success: true,\n          responseTime,\n          timestamp: Date.now(),\n        });\n      };\n\n      document.addEventListener('touchstart', handleTap, { once: true });\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        if (!tapDetected) {\n          document.removeEventListener('touchstart', handleTap);\n          resolve({\n            success: false,\n            error: 'Timeout',\n            timestamp: Date.now(),\n          });\n        }\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test double tap gesture\n   */\n  async testDoubleTapGesture() {\n    return new Promise((resolve) => {\n      let tapCount = 0;\n      let lastTapTime = 0;\n      let startTime = Date.now();\n\n      const handleTap = () => {\n        const currentTime = Date.now();\n        tapCount++;\n\n        if (tapCount === 1) {\n          lastTapTime = currentTime;\n        } else if (tapCount === 2) {\n          const timeDiff = currentTime - lastTapTime;\n          const success = timeDiff < 500; // Double tap within 500ms\n          \n          document.removeEventListener('touchstart', handleTap);\n          resolve({\n            success,\n            timeDiff,\n            timestamp: Date.now(),\n          });\n        }\n      };\n\n      document.addEventListener('touchstart', handleTap);\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        document.removeEventListener('touchstart', handleTap);\n        resolve({\n          success: false,\n          error: 'Timeout',\n          timestamp: Date.now(),\n        });\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test long press gesture\n   */\n  async testLongPressGesture() {\n    return new Promise((resolve) => {\n      let longPressDetected = false;\n      let startTime = Date.now();\n\n      const handleTouchStart = () => {\n        startTime = Date.now();\n      };\n\n      const handleTouchEnd = () => {\n        const duration = Date.now() - startTime;\n        const success = duration >= 500; // Long press >= 500ms\n        \n        if (success) {\n          longPressDetected = true;\n          resolve({\n            success: true,\n            duration,\n            timestamp: Date.now(),\n          });\n        }\n      };\n\n      document.addEventListener('touchstart', handleTouchStart);\n      document.addEventListener('touchend', handleTouchEnd);\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        document.removeEventListener('touchstart', handleTouchStart);\n        document.removeEventListener('touchend', handleTouchEnd);\n        \n        if (!longPressDetected) {\n          resolve({\n            success: false,\n            error: 'Timeout',\n            timestamp: Date.now(),\n          });\n        }\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test swipe gesture\n   */\n  async testSwipeGesture() {\n    return new Promise((resolve) => {\n      let swipeDetected = false;\n      let startTouch = null;\n\n      const handleTouchStart = (e) => {\n        startTouch = e.touches[0];\n      };\n\n      const handleTouchEnd = (e) => {\n        if (!startTouch) return;\n\n        const endTouch = e.changedTouches[0];\n        const deltaX = endTouch.clientX - startTouch.clientX;\n        const deltaY = endTouch.clientY - startTouch.clientY;\n        const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n        \n        const success = distance >= 50; // Swipe distance >= 50px\n        \n        if (success) {\n          swipeDetected = true;\n          resolve({\n            success: true,\n            distance,\n            direction: Math.atan2(deltaY, deltaX) * 180 / Math.PI,\n            timestamp: Date.now(),\n          });\n        }\n      };\n\n      document.addEventListener('touchstart', handleTouchStart);\n      document.addEventListener('touchend', handleTouchEnd);\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        document.removeEventListener('touchstart', handleTouchStart);\n        document.removeEventListener('touchend', handleTouchEnd);\n        \n        if (!swipeDetected) {\n          resolve({\n            success: false,\n            error: 'Timeout',\n            timestamp: Date.now(),\n          });\n        }\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test pinch gesture\n   */\n  async testPinchGesture() {\n    return new Promise((resolve) => {\n      let pinchDetected = false;\n      let startTouches = [];\n\n      const handleTouchStart = (e) => {\n        if (e.touches.length === 2) {\n          startTouches = Array.from(e.touches);\n        }\n      };\n\n      const handleTouchMove = (e) => {\n        if (e.touches.length === 2 && startTouches.length === 2) {\n          const currentTouches = Array.from(e.touches);\n          const startDistance = this.getDistance(startTouches[0], startTouches[1]);\n          const currentDistance = this.getDistance(currentTouches[0], currentTouches[1]);\n          const scale = currentDistance / startDistance;\n          \n          if (Math.abs(scale - 1) > 0.1) { // Pinch threshold\n            pinchDetected = true;\n            resolve({\n              success: true,\n              scale,\n              timestamp: Date.now(),\n            });\n          }\n        }\n      };\n\n      document.addEventListener('touchstart', handleTouchStart);\n      document.addEventListener('touchmove', handleTouchMove);\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        document.removeEventListener('touchstart', handleTouchStart);\n        document.removeEventListener('touchmove', handleTouchMove);\n        \n        if (!pinchDetected) {\n          resolve({\n            success: false,\n            error: 'Timeout',\n            timestamp: Date.now(),\n          });\n        }\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test rotate gesture\n   */\n  async testRotateGesture() {\n    return new Promise((resolve) => {\n      let rotateDetected = false;\n      let startTouches = [];\n\n      const handleTouchStart = (e) => {\n        if (e.touches.length === 2) {\n          startTouches = Array.from(e.touches);\n        }\n      };\n\n      const handleTouchMove = (e) => {\n        if (e.touches.length === 2 && startTouches.length === 2) {\n          const currentTouches = Array.from(e.touches);\n          const startAngle = this.getAngle(startTouches[0], startTouches[1]);\n          const currentAngle = this.getAngle(currentTouches[0], currentTouches[1]);\n          const rotation = currentAngle - startAngle;\n          \n          if (Math.abs(rotation) > 0.1) { // Rotation threshold\n            rotateDetected = true;\n            resolve({\n              success: true,\n              rotation: rotation * 180 / Math.PI,\n              timestamp: Date.now(),\n            });\n          }\n        }\n      };\n\n      document.addEventListener('touchstart', handleTouchStart);\n      document.addEventListener('touchmove', handleTouchMove);\n\n      // Timeout after 2 seconds\n      setTimeout(() => {\n        document.removeEventListener('touchstart', handleTouchStart);\n        document.removeEventListener('touchmove', handleTouchMove);\n        \n        if (!rotateDetected) {\n          resolve({\n            success: false,\n            error: 'Timeout',\n            timestamp: Date.now(),\n          });\n        }\n      }, this.config.gestureTestTimeout);\n    });\n  }\n\n  /**\n   * Test all controls\n   */\n  async testAllControls() {\n    const controlNames = ['virtualJoystick', 'actionButtons', 'menuButton', 'pauseButton'];\n    \n    for (const controlName of controlNames) {\n      try {\n        const result = await this.testControl(controlName);\n        this.testResults.controls.set(controlName, result);\n      } catch (error) {\n        this.logger.error(`Error testing control ${controlName}:`, error);\n        this.testResults.controls.set(controlName, { success: false, error: error.message });\n      }\n    }\n  }\n\n  /**\n   * Test a specific control\n   */\n  async testControl(controlName) {\n    const testFunction = this.testListeners.get(`control:${controlName}`);\n    if (!testFunction) {\n      throw new Error(`No test function found for control: ${controlName}`);\n    }\n\n    return await testFunction();\n  }\n\n  /**\n   * Test virtual joystick\n   */\n  async testVirtualJoystick() {\n    if (!this.inputManager || !this.inputManager.mobileUI.virtualJoystick.element) {\n      return {\n        success: false,\n        error: 'Virtual joystick not available',\n        timestamp: Date.now(),\n      };\n    }\n\n    const joystick = this.inputManager.mobileUI.virtualJoystick;\n    const rect = joystick.element.getBoundingClientRect();\n    \n    return {\n      success: true,\n      position: {\n        x: rect.left,\n        y: rect.top,\n        width: rect.width,\n        height: rect.height,\n      },\n      active: joystick.active,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Test action buttons\n   */\n  async testActionButtons() {\n    if (!this.inputManager || !this.inputManager.mobileUI.actionButtons) {\n      return {\n        success: false,\n        error: 'Action buttons not available',\n        timestamp: Date.now(),\n      };\n    }\n\n    const buttons = Array.from(this.inputManager.mobileUI.actionButtons.entries()).map(([id, button]) => {\n      const rect = button.getBoundingClientRect();\n      return {\n        id,\n        position: {\n          x: rect.left,\n          y: rect.top,\n          width: rect.width,\n          height: rect.height,\n        },\n        visible: button.offsetParent !== null,\n      };\n    });\n\n    return {\n      success: true,\n      buttons,\n      count: buttons.length,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Test menu button\n   */\n  async testMenuButton() {\n    const menuButton = document.querySelector('.menu-button');\n    \n    if (!menuButton) {\n      return {\n        success: false,\n        error: 'Menu button not found',\n        timestamp: Date.now(),\n      };\n    }\n\n    const rect = menuButton.getBoundingClientRect();\n    \n    return {\n      success: true,\n      position: {\n        x: rect.left,\n        y: rect.top,\n        width: rect.width,\n        height: rect.height,\n      },\n      visible: menuButton.offsetParent !== null,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Test pause button\n   */\n  async testPauseButton() {\n    const pauseButton = document.querySelector('.pause-button');\n    \n    if (!pauseButton) {\n      return {\n        success: false,\n        error: 'Pause button not found',\n        timestamp: Date.now(),\n      };\n    }\n\n    const rect = pauseButton.getBoundingClientRect();\n    \n    return {\n      success: true,\n      position: {\n        x: rect.left,\n        y: rect.top,\n        width: rect.width,\n        height: rect.height,\n      },\n      visible: pauseButton.offsetParent !== null,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Test performance\n   */\n  async testPerformance() {\n    if (!this.performanceMonitor) {\n      return {\n        success: false,\n        error: 'Performance monitor not available',\n        timestamp: Date.now(),\n      };\n    }\n\n    const metrics = this.performanceMonitor.getMetrics();\n    const score = this.performanceMonitor.getPerformanceScore();\n    \n    this.testResults.performance = {\n      success: true,\n      score,\n      metrics: {\n        fps: metrics.fps.current,\n        frameTime: metrics.frameTime.current,\n        memory: metrics.memory.used,\n        audio: metrics.audio.contextState,\n      },\n      timestamp: Date.now(),\n    };\n\n    return this.testResults.performance;\n  }\n\n  /**\n   * Test accessibility\n   */\n  async testAccessibility() {\n    const accessibilityTests = [\n      this.testScreenReaderSupport(),\n      this.testKeyboardNavigation(),\n      this.testHighContrast(),\n      this.testTextScaling(),\n    ];\n\n    const results = await Promise.all(accessibilityTests);\n    \n    this.testResults.accessibility = {\n      success: true,\n      tests: results,\n      overallScore: results.reduce((sum, test) => sum + (test.success ? 1 : 0), 0) / results.length,\n      timestamp: Date.now(),\n    };\n\n    return this.testResults.accessibility;\n  }\n\n  /**\n   * Test screen reader support\n   */\n  async testScreenReaderSupport() {\n    const hasScreenReader = 'speechSynthesis' in window;\n    const hasAriaSupport = document.querySelector('[aria-label]') !== null;\n    \n    return {\n      name: 'screenReader',\n      success: hasScreenReader && hasAriaSupport,\n      details: {\n        hasScreenReader,\n        hasAriaSupport,\n      },\n    };\n  }\n\n  /**\n   * Test keyboard navigation\n   */\n  async testKeyboardNavigation() {\n    const focusableElements = document.querySelectorAll(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    \n    return {\n      name: 'keyboardNavigation',\n      success: focusableElements.length > 0,\n      details: {\n        focusableElements: focusableElements.length,\n      },\n    };\n  }\n\n  /**\n   * Test high contrast\n   */\n  async testHighContrast() {\n    const hasHighContrast = document.documentElement.classList.contains('high-contrast');\n    \n    return {\n      name: 'highContrast',\n      success: true, // Always available\n      details: {\n        enabled: hasHighContrast,\n      },\n    };\n  }\n\n  /**\n   * Test text scaling\n   */\n  async testTextScaling() {\n    const textScale = getComputedStyle(document.documentElement).getPropertyValue('--text-scale') || '1';\n    \n    return {\n      name: 'textScaling',\n      success: true, // Always available\n      details: {\n        scale: parseFloat(textScale),\n      },\n    };\n  }\n\n  /**\n   * Calculate overall score\n   */\n  calculateOverallScore() {\n    let totalScore = 0;\n    let testCount = 0;\n\n    // Device score (always 1 if mobile detected)\n    if (this.testResults.device?.isMobile) {\n      totalScore += 1;\n      testCount += 1;\n    }\n\n    // Gesture scores\n    for (const [name, result] of this.testResults.gestures) {\n      totalScore += result.success ? 1 : 0;\n      testCount += 1;\n    }\n\n    // Control scores\n    for (const [name, result] of this.testResults.controls) {\n      totalScore += result.success ? 1 : 0;\n      testCount += 1;\n    }\n\n    // Performance score\n    if (this.testResults.performance) {\n      totalScore += this.testResults.performance.score / 100;\n      testCount += 1;\n    }\n\n    // Accessibility score\n    if (this.testResults.accessibility) {\n      totalScore += this.testResults.accessibility.overallScore;\n      testCount += 1;\n    }\n\n    this.testResults.overall = {\n      score: testCount > 0 ? totalScore / testCount : 0,\n      totalTests: testCount,\n      passedTests: Math.round(totalScore),\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Get distance between two touch points\n   */\n  getDistance(touch1, touch2) {\n    const dx = touch1.clientX - touch2.clientX;\n    const dy = touch1.clientY - touch2.clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Get angle between two touch points\n   */\n  getAngle(touch1, touch2) {\n    return Math.atan2(touch2.clientY - touch1.clientY, touch2.clientX - touch1.clientX);\n  }\n\n  /**\n   * Get test results\n   */\n  getTestResults() {\n    return this.testResults;\n  }\n\n  /**\n   * Get test report\n   */\n  getTestReport() {\n    return {\n      device: this.testResults.device,\n      gestures: Object.fromEntries(this.testResults.gestures),\n      controls: Object.fromEntries(this.testResults.controls),\n      performance: this.testResults.performance,\n      accessibility: this.testResults.accessibility,\n      overall: this.testResults.overall,\n      timestamp: Date.now(),\n    };\n  }\n\n  /**\n   * Export test results\n   */\n  exportTestResults() {\n    return JSON.stringify(this.getTestReport(), null, 2);\n  }\n\n  /**\n   * Update test configuration\n   */\n  updateConfig(newConfig) {\n    this.config = { ...this.config, ...newConfig };\n  }\n}\n\nexport default MobileTesting;","/**\n * SettingsUI.js - Settings user interface component\n * \n * Provides a comprehensive settings interface with proper UI-to-system contracts\n * for managing game settings, audio preferences, and accessibility options.\n */\n\nimport { EventBus } from '../core/EventBus.js';\nimport { Logger } from '../utils/Logger.js';\n\nexport class SettingsUI {\n  constructor(config = {}) {\n    // Validate required dependencies\n    if (!config.eventBus || !(config.eventBus instanceof EventBus)) {\n      throw new Error('SettingsUI: eventBus is required and must be an EventBus instance');\n    }\n    if (!config.logger || !(config.logger instanceof Logger)) {\n      throw new Error('SettingsUI: logger is required and must be a Logger instance');\n    }\n\n    this.eventBus = config.eventBus;\n    this.logger = config.logger;\n    this.container = config.container || document.body;\n    this.isVisible = false;\n    this.settings = this.getDefaultSettings();\n    \n    // Bind methods\n    this.show = this.show.bind(this);\n    this.hide = this.hide.bind(this);\n    this.toggle = this.toggle.bind(this);\n    this.updateSetting = this.updateSetting.bind(this);\n    this.resetToDefaults = this.resetToDefaults.bind(this);\n    this.saveSettings = this.saveSettings.bind(this);\n    this.loadSettings = this.loadSettings.bind(this);\n\n    // Initialize UI\n    this.initializeUI();\n    this.setupEventListeners();\n    this.loadSettings();\n\n    this.logger.info('SettingsUI initialized');\n  }\n\n  /**\n   * Get default settings configuration\n   */\n  getDefaultSettings() {\n    return {\n      // Audio settings\n      audio: {\n        masterVolume: 1.0,\n        musicVolume: 0.8,\n        sfxVolume: 0.9,\n        muteAll: false,\n        muteMusic: false,\n        muteSfx: false\n      },\n      // Graphics settings\n      graphics: {\n        quality: 'high', // low, medium, high, ultra\n        fullscreen: false,\n        vsync: true,\n        particleEffects: true,\n        shadows: true,\n        antiAliasing: true\n      },\n      // Gameplay settings\n      gameplay: {\n        difficulty: 'normal', // easy, normal, hard, expert\n        autoSave: true,\n        autoPause: true,\n        showFPS: false,\n        showDebugInfo: false,\n        tutorialEnabled: true\n      },\n      // Accessibility settings\n      accessibility: {\n        highContrast: false,\n        largeText: false,\n        screenReader: false,\n        colorBlindMode: 'none', // none, protanopia, deuteranopia, tritanopia\n        reducedMotion: false,\n        keyboardNavigation: true\n      },\n      // Controls settings\n      controls: {\n        keyBindings: this.getDefaultKeyBindings(),\n        mouseSensitivity: 1.0,\n        invertY: false,\n        autoAim: false\n      }\n    };\n  }\n\n  /**\n   * Get default key bindings\n   */\n  getDefaultKeyBindings() {\n    return {\n      moveUp: 'KeyW',\n      moveDown: 'KeyS',\n      moveLeft: 'KeyA',\n      moveRight: 'KeyD',\n      jump: 'Space',\n      action: 'KeyE',\n      pause: 'Escape',\n      inventory: 'KeyI',\n      map: 'KeyM',\n      chat: 'KeyT'\n    };\n  }\n\n  /**\n   * Initialize the settings UI DOM structure\n   */\n  initializeUI() {\n    // Create main settings container\n    this.settingsContainer = document.createElement('div');\n    this.settingsContainer.className = 'settings-container';\n    this.settingsContainer.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: none;\n      z-index: 1000;\n      overflow-y: auto;\n    `;\n\n    // Create settings panel\n    this.settingsPanel = document.createElement('div');\n    this.settingsPanel.className = 'settings-panel';\n    this.settingsPanel.style.cssText = `\n      position: relative;\n      max-width: 800px;\n      margin: 2rem auto;\n      background: #1a1a1a;\n      border-radius: 8px;\n      padding: 2rem;\n      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);\n    `;\n\n    // Create header\n    this.createHeader();\n    \n    // Create settings sections\n    this.createAudioSection();\n    this.createGraphicsSection();\n    this.createGameplaySection();\n    this.createAccessibilitySection();\n    this.createControlsSection();\n    \n    // Create footer with action buttons\n    this.createFooter();\n\n    this.settingsContainer.appendChild(this.settingsPanel);\n    this.container.appendChild(this.settingsContainer);\n  }\n\n  /**\n   * Create settings header\n   */\n  createHeader() {\n    const header = document.createElement('div');\n    header.className = 'settings-header';\n    header.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 2rem;\n      padding-bottom: 1rem;\n      border-bottom: 1px solid #333;\n    `;\n\n    const title = document.createElement('h2');\n    title.textContent = 'Game Settings';\n    title.style.cssText = `\n      color: #fff;\n      margin: 0;\n      font-size: 1.5rem;\n    `;\n\n    const closeButton = document.createElement('button');\n    closeButton.textContent = 'Ã—';\n    closeButton.className = 'settings-close';\n    closeButton.style.cssText = `\n      background: none;\n      border: none;\n      color: #fff;\n      font-size: 2rem;\n      cursor: pointer;\n      padding: 0;\n      width: 40px;\n      height: 40px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    `;\n    closeButton.addEventListener('click', this.hide);\n\n    header.appendChild(title);\n    header.appendChild(closeButton);\n    this.settingsPanel.appendChild(header);\n  }\n\n  /**\n   * Create audio settings section\n   */\n  createAudioSection() {\n    const section = this.createSection('Audio Settings', 'audio');\n    \n    // Master volume\n    this.createSliderControl(section, 'Master Volume', 'audio.masterVolume', 0, 1, 0.1);\n    \n    // Music volume\n    this.createSliderControl(section, 'Music Volume', 'audio.musicVolume', 0, 1, 0.1);\n    \n    // SFX volume\n    this.createSliderControl(section, 'SFX Volume', 'audio.sfxVolume', 0, 1, 0.1);\n    \n    // Mute options\n    this.createCheckboxControl(section, 'Mute All', 'audio.muteAll');\n    this.createCheckboxControl(section, 'Mute Music', 'audio.muteMusic');\n    this.createCheckboxControl(section, 'Mute SFX', 'audio.muteSfx');\n  }\n\n  /**\n   * Create graphics settings section\n   */\n  createGraphicsSection() {\n    const section = this.createSection('Graphics Settings', 'graphics');\n    \n    // Quality preset\n    this.createSelectControl(section, 'Quality Preset', 'graphics.quality', [\n      { value: 'low', label: 'Low' },\n      { value: 'medium', label: 'Medium' },\n      { value: 'high', label: 'High' },\n      { value: 'ultra', label: 'Ultra' }\n    ]);\n    \n    // Graphics options\n    this.createCheckboxControl(section, 'Fullscreen', 'graphics.fullscreen');\n    this.createCheckboxControl(section, 'VSync', 'graphics.vsync');\n    this.createCheckboxControl(section, 'Particle Effects', 'graphics.particleEffects');\n    this.createCheckboxControl(section, 'Shadows', 'graphics.shadows');\n    this.createCheckboxControl(section, 'Anti-Aliasing', 'graphics.antiAliasing');\n  }\n\n  /**\n   * Create gameplay settings section\n   */\n  createGameplaySection() {\n    const section = this.createSection('Gameplay Settings', 'gameplay');\n    \n    // Difficulty\n    this.createSelectControl(section, 'Difficulty', 'gameplay.difficulty', [\n      { value: 'easy', label: 'Easy' },\n      { value: 'normal', label: 'Normal' },\n      { value: 'hard', label: 'Hard' },\n      { value: 'expert', label: 'Expert' }\n    ]);\n    \n    // Gameplay options\n    this.createCheckboxControl(section, 'Auto Save', 'gameplay.autoSave');\n    this.createCheckboxControl(section, 'Auto Pause', 'gameplay.autoPause');\n    this.createCheckboxControl(section, 'Show FPS', 'gameplay.showFPS');\n    this.createCheckboxControl(section, 'Show Debug Info', 'gameplay.showDebugInfo');\n    this.createCheckboxControl(section, 'Tutorial Enabled', 'gameplay.tutorialEnabled');\n  }\n\n  /**\n   * Create accessibility settings section\n   */\n  createAccessibilitySection() {\n    const section = this.createSection('Accessibility Settings', 'accessibility');\n    \n    // Accessibility options\n    this.createCheckboxControl(section, 'High Contrast', 'accessibility.highContrast');\n    this.createCheckboxControl(section, 'Large Text', 'accessibility.largeText');\n    this.createCheckboxControl(section, 'Screen Reader Support', 'accessibility.screenReader');\n    this.createCheckboxControl(section, 'Reduced Motion', 'accessibility.reducedMotion');\n    this.createCheckboxControl(section, 'Keyboard Navigation', 'accessibility.keyboardNavigation');\n    \n    // Color blind mode\n    this.createSelectControl(section, 'Color Blind Mode', 'accessibility.colorBlindMode', [\n      { value: 'none', label: 'None' },\n      { value: 'protanopia', label: 'Protanopia' },\n      { value: 'deuteranopia', label: 'Deuteranopia' },\n      { value: 'tritanopia', label: 'Tritanopia' }\n    ]);\n  }\n\n  /**\n   * Create controls settings section\n   */\n  createControlsSection() {\n    const section = this.createSection('Controls Settings', 'controls');\n    \n    // Mouse sensitivity\n    this.createSliderControl(section, 'Mouse Sensitivity', 'controls.mouseSensitivity', 0.1, 3.0, 0.1);\n    \n    // Control options\n    this.createCheckboxControl(section, 'Invert Y Axis', 'controls.invertY');\n    this.createCheckboxControl(section, 'Auto Aim', 'controls.autoAim');\n    \n    // Key bindings (simplified for now)\n    const keyBindingsDiv = document.createElement('div');\n    keyBindingsDiv.innerHTML = '<h4>Key Bindings</h4><p>Key binding customization coming soon...</p>';\n    section.appendChild(keyBindingsDiv);\n  }\n\n  /**\n   * Create a settings section container\n   */\n  createSection(title, id) {\n    const section = document.createElement('div');\n    section.className = `settings-section settings-section-${id}`;\n    section.style.cssText = `\n      margin-bottom: 2rem;\n      padding: 1rem;\n      background: #2a2a2a;\n      border-radius: 4px;\n    `;\n\n    const sectionTitle = document.createElement('h3');\n    sectionTitle.textContent = title;\n    sectionTitle.style.cssText = `\n      color: #fff;\n      margin: 0 0 1rem 0;\n      font-size: 1.2rem;\n    `;\n\n    section.appendChild(sectionTitle);\n    this.settingsPanel.appendChild(section);\n    return section;\n  }\n\n  /**\n   * Create a slider control\n   */\n  createSliderControl(container, label, settingPath, min, max, step) {\n    const controlDiv = document.createElement('div');\n    controlDiv.className = 'settings-control';\n    controlDiv.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1rem;\n    `;\n\n    const labelEl = document.createElement('label');\n    labelEl.textContent = label;\n    labelEl.style.cssText = `\n      color: #fff;\n      margin-right: 1rem;\n      min-width: 150px;\n    `;\n\n    const slider = document.createElement('input');\n    slider.type = 'range';\n    slider.min = min;\n    slider.max = max;\n    slider.step = step;\n    slider.value = this.getSettingValue(settingPath);\n    slider.style.cssText = `\n      flex: 1;\n      margin-right: 1rem;\n    `;\n\n    const valueDisplay = document.createElement('span');\n    valueDisplay.textContent = slider.value;\n    valueDisplay.style.cssText = `\n      color: #fff;\n      min-width: 50px;\n      text-align: right;\n    `;\n\n    slider.addEventListener('input', (e) => {\n      valueDisplay.textContent = e.target.value;\n      this.updateSetting(settingPath, parseFloat(e.target.value));\n    });\n\n    controlDiv.appendChild(labelEl);\n    controlDiv.appendChild(slider);\n    controlDiv.appendChild(valueDisplay);\n    container.appendChild(controlDiv);\n  }\n\n  /**\n   * Create a checkbox control\n   */\n  createCheckboxControl(container, label, settingPath) {\n    const controlDiv = document.createElement('div');\n    controlDiv.className = 'settings-control';\n    controlDiv.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1rem;\n    `;\n\n    const labelEl = document.createElement('label');\n    labelEl.textContent = label;\n    labelEl.style.cssText = `\n      color: #fff;\n      margin-right: 1rem;\n      flex: 1;\n    `;\n\n    const checkbox = document.createElement('input');\n    checkbox.type = 'checkbox';\n    checkbox.checked = this.getSettingValue(settingPath);\n    checkbox.style.cssText = `\n      width: 20px;\n      height: 20px;\n    `;\n\n    checkbox.addEventListener('change', (e) => {\n      this.updateSetting(settingPath, e.target.checked);\n    });\n\n    controlDiv.appendChild(labelEl);\n    controlDiv.appendChild(checkbox);\n    container.appendChild(controlDiv);\n  }\n\n  /**\n   * Create a select control\n   */\n  createSelectControl(container, label, settingPath, options) {\n    const controlDiv = document.createElement('div');\n    controlDiv.className = 'settings-control';\n    controlDiv.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 1rem;\n    `;\n\n    const labelEl = document.createElement('label');\n    labelEl.textContent = label;\n    labelEl.style.cssText = `\n      color: #fff;\n      margin-right: 1rem;\n      min-width: 150px;\n    `;\n\n    const select = document.createElement('select');\n    select.value = this.getSettingValue(settingPath);\n    select.style.cssText = `\n      flex: 1;\n      padding: 0.5rem;\n      background: #333;\n      color: #fff;\n      border: 1px solid #555;\n      border-radius: 4px;\n    `;\n\n    options.forEach(option => {\n      const optionEl = document.createElement('option');\n      optionEl.value = option.value;\n      optionEl.textContent = option.label;\n      select.appendChild(optionEl);\n    });\n\n    select.addEventListener('change', (e) => {\n      this.updateSetting(settingPath, e.target.value);\n    });\n\n    controlDiv.appendChild(labelEl);\n    controlDiv.appendChild(select);\n    container.appendChild(controlDiv);\n  }\n\n  /**\n   * Create footer with action buttons\n   */\n  createFooter() {\n    const footer = document.createElement('div');\n    footer.className = 'settings-footer';\n    footer.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      margin-top: 2rem;\n      padding-top: 1rem;\n      border-top: 1px solid #333;\n    `;\n\n    const resetButton = document.createElement('button');\n    resetButton.textContent = 'Reset to Defaults';\n    resetButton.className = 'settings-reset';\n    resetButton.style.cssText = `\n      background: #666;\n      color: #fff;\n      border: none;\n      padding: 0.75rem 1.5rem;\n      border-radius: 4px;\n      cursor: pointer;\n    `;\n    resetButton.addEventListener('click', this.resetToDefaults);\n\n    const buttonGroup = document.createElement('div');\n    buttonGroup.style.cssText = `\n      display: flex;\n      gap: 1rem;\n    `;\n\n    const cancelButton = document.createElement('button');\n    cancelButton.textContent = 'Cancel';\n    cancelButton.className = 'settings-cancel';\n    cancelButton.style.cssText = `\n      background: #666;\n      color: #fff;\n      border: none;\n      padding: 0.75rem 1.5rem;\n      border-radius: 4px;\n      cursor: pointer;\n    `;\n    cancelButton.addEventListener('click', this.hide);\n\n    const saveButton = document.createElement('button');\n    saveButton.textContent = 'Save Settings';\n    saveButton.className = 'settings-save';\n    saveButton.style.cssText = `\n      background: #4CAF50;\n      color: #fff;\n      border: none;\n      padding: 0.75rem 1.5rem;\n      border-radius: 4px;\n      cursor: pointer;\n    `;\n    saveButton.addEventListener('click', this.saveSettings);\n\n    buttonGroup.appendChild(cancelButton);\n    buttonGroup.appendChild(saveButton);\n    footer.appendChild(resetButton);\n    footer.appendChild(buttonGroup);\n    this.settingsPanel.appendChild(footer);\n  }\n\n  /**\n   * Set up event listeners\n   */\n  setupEventListeners() {\n    // Close on escape key\n    document.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape' && this.isVisible) {\n        this.hide();\n      }\n    });\n\n    // Close on backdrop click\n    this.settingsContainer.addEventListener('click', (e) => {\n      if (e.target === this.settingsContainer) {\n        this.hide();\n      }\n    });\n  }\n\n  /**\n   * Get setting value by path\n   */\n  getSettingValue(path) {\n    if (!path || typeof path !== 'string') {\n      return undefined;\n    }\n    \n    const keys = path.split('.');\n    let value = this.settings;\n    for (const key of keys) {\n      if (value && typeof value === 'object' && key in value) {\n        value = value[key];\n      } else {\n        return undefined;\n      }\n    }\n    return value;\n  }\n\n  /**\n   * Update setting value by path\n   */\n  updateSetting(path, value) {\n    const keys = path.split('.');\n    let target = this.settings;\n    for (let i = 0; i < keys.length - 1; i++) {\n      target = target[keys[i]];\n    }\n    target[keys[keys.length - 1]] = value;\n\n    // Emit setting change event\n    this.eventBus.emit('settings:changed', {\n      path,\n      value,\n      settings: this.settings\n    });\n\n    this.logger.debug(`Setting updated: ${path} = ${value}`);\n  }\n\n  /**\n   * Show settings UI\n   */\n  show() {\n    this.settingsContainer.style.display = 'block';\n    this.isVisible = true;\n    this.eventBus.emit('settings:opened');\n    this.logger.info('Settings UI opened');\n  }\n\n  /**\n   * Hide settings UI\n   */\n  hide() {\n    this.settingsContainer.style.display = 'none';\n    this.isVisible = false;\n    this.eventBus.emit('settings:closed');\n    this.logger.info('Settings UI closed');\n  }\n\n  /**\n   * Toggle settings UI visibility\n   */\n  toggle() {\n    if (this.isVisible) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  }\n\n  /**\n   * Reset all settings to defaults\n   */\n  resetToDefaults() {\n    this.settings = this.getDefaultSettings();\n    this.loadSettings();\n    this.eventBus.emit('settings:reset');\n    this.logger.info('Settings reset to defaults');\n  }\n\n  /**\n   * Save settings to localStorage\n   */\n  saveSettings() {\n    try {\n      localStorage.setItem('gameSettings', JSON.stringify(this.settings));\n      this.eventBus.emit('settings:saved', this.settings);\n      this.logger.info('Settings saved successfully');\n      this.hide();\n    } catch (error) {\n      this.logger.error('Failed to save settings:', error);\n      this.eventBus.emit('settings:saveError', error);\n    }\n  }\n\n  /**\n   * Load settings from localStorage\n   */\n  loadSettings() {\n    try {\n      const saved = localStorage.getItem('gameSettings');\n      if (saved) {\n        const parsedSettings = JSON.parse(saved);\n        this.settings = this.mergeSettings(this.settings, parsedSettings);\n        this.eventBus.emit('settings:loaded', this.settings);\n        this.logger.info('Settings loaded successfully');\n      }\n    } catch (error) {\n      this.logger.error('Failed to load settings:', error);\n      this.eventBus.emit('settings:loadError', error);\n    }\n  }\n\n  /**\n   * Merge settings objects\n   */\n  mergeSettings(defaults, saved) {\n    const merged = { ...defaults };\n    for (const key in saved) {\n      if (typeof saved[key] === 'object' && !Array.isArray(saved[key])) {\n        merged[key] = this.mergeSettings(defaults[key] || {}, saved[key]);\n      } else {\n        merged[key] = saved[key];\n      }\n    }\n    return merged;\n  }\n\n  /**\n   * Get current settings\n   */\n  getSettings() {\n    return { ...this.settings };\n  }\n\n  /**\n   * Update settings programmatically\n   */\n  setSettings(newSettings) {\n    this.settings = this.mergeSettings(this.settings, newSettings);\n    this.eventBus.emit('settings:updated', this.settings);\n    this.logger.info('Settings updated programmatically');\n  }\n\n  /**\n   * Cleanup resources\n   */\n  cleanup() {\n    if (this.settingsContainer && this.settingsContainer.parentNode) {\n      this.settingsContainer.parentNode.removeChild(this.settingsContainer);\n    }\n    this.eventBus.emit('settings:cleanup');\n    this.logger.info('SettingsUI cleaned up');\n  }\n}","/**\n * GameRefactored.js - Main game controller with cross-cutting features integration\n *\n * This file serves as the central orchestrator for the game, integrating:\n * - Core gameplay mechanics\n * - Achievements system\n * - Daily challenges\n * - Accessibility features\n * - Modular component architecture with dependency injection\n */\n\nimport { GameManager } from './managers/GameManager.js';\nimport { AchievementManager } from './managers/AchievementManager.js';\nimport { DailyChallengeManager } from './managers/DailyChallengeManager.js';\nimport { AccessibilityManager } from './managers/AccessibilityManager.js';\nimport { EventBus } from './core/EventBus.js';\nimport { Logger } from './utils/Logger.js';\nimport { PerformanceMonitor } from './core/PerformanceMonitor.js';\nimport { InputManager } from './core/InputManager.js';\nimport { MobileTesting } from './utils/MobileTesting.js';\nimport { SettingsUI } from './ui/SettingsUI.js';\nimport { AudioSystem } from './systems/AudioSystem.js';\n\nexport class GameRefactored {\n  constructor(config = {}) {\n    // Validate and normalize config\n    this.config = this.validateConfig({\n      debug: false,\n      enableAchievements: true,\n      enableDailyChallenges: true,\n      enableAccessibility: true,\n      ...config,\n    });\n\n    // Assert config validation\n    if (typeof this.config.debug !== 'boolean') {\n      throw new Error('GameRefactored: config.debug must be a boolean');\n    }\n    if (typeof this.config.enableAchievements !== 'boolean') {\n      throw new Error(\n        'GameRefactored: config.enableAchievements must be a boolean'\n      );\n    }\n    if (typeof this.config.enableDailyChallenges !== 'boolean') {\n      throw new Error(\n        'GameRefactored: config.enableDailyChallenges must be a boolean'\n      );\n    }\n    if (typeof this.config.enableAccessibility !== 'boolean') {\n      throw new Error(\n        'GameRefactored: config.enableAccessibility must be a boolean'\n      );\n    }\n\n    // Core systems - with assertions\n    this.eventBus = new EventBus();\n    if (!this.eventBus || typeof this.eventBus.emit !== 'function') {\n      throw new Error('GameRefactored: EventBus initialization failed');\n    }\n\n    this.logger = new Logger(this.config.debug);\n    if (!this.logger || typeof this.logger.info !== 'function') {\n      throw new Error('GameRefactored: Logger initialization failed');\n    }\n\n    // Game state - with assertions\n    this.gameState = {\n      isRunning: false,\n      isPaused: false,\n      currentLevel: 1,\n      score: 0,\n      player: null,\n      gameObjects: [],\n      startTime: null,\n      lastUpdateTime: null,\n      activePowerUps: new Map(), // Track active power-ups\n    };\n\n    // Assert game state structure\n    if (typeof this.gameState.isRunning !== 'boolean') {\n      throw new Error('GameRefactored: gameState.isRunning must be a boolean');\n    }\n    if (\n      typeof this.gameState.currentLevel !== 'number' ||\n      this.gameState.currentLevel < 1\n    ) {\n      throw new Error(\n        'GameRefactored: gameState.currentLevel must be a positive number'\n      );\n    }\n    if (typeof this.gameState.score !== 'number' || this.gameState.score < 0) {\n      throw new Error(\n        'GameRefactored: gameState.score must be a non-negative number'\n      );\n    }\n    if (!Array.isArray(this.gameState.gameObjects)) {\n      throw new Error('GameRefactored: gameState.gameObjects must be an array');\n    }\n\n    // Manager instances (dependency injection) - with assertions\n    this.managers = {};\n    this.initializeManagers();\n\n    // Performance monitoring\n    this.performanceMonitor = new PerformanceMonitor({\n      eventBus: this.eventBus,\n      logger: this.logger,\n      config: this.config,\n    });\n\n    // Input management\n    this.inputManager = new InputManager({\n      eventBus: this.eventBus,\n      logger: this.logger,\n      config: this.config,\n    });\n\n    // Mobile testing\n    this.mobileTesting = new MobileTesting({\n      eventBus: this.eventBus,\n      logger: this.logger,\n      inputManager: this.inputManager,\n      performanceMonitor: this.performanceMonitor,\n      config: this.config,\n    });\n\n    // UI and Audio systems\n    this.ui = {};\n    this.systems = {};\n    this.initializeUISystems();\n\n    // Assert managers were initialized\n    if (!this.managers.game) {\n      throw new Error('GameRefactored: GameManager initialization failed');\n    }\n    if (this.config.enableAchievements && !this.managers.achievements) {\n      throw new Error(\n        'GameRefactored: AchievementManager initialization failed when enabled'\n      );\n    }\n    if (this.config.enableDailyChallenges && !this.managers.dailyChallenges) {\n      throw new Error(\n        'GameRefactored: DailyChallengeManager initialization failed when enabled'\n      );\n    }\n    if (this.config.enableAccessibility && !this.managers.accessibility) {\n      throw new Error(\n        'GameRefactored: AccessibilityManager initialization failed when enabled'\n      );\n    }\n\n    // Assert UI and audio systems were initialized\n    if (!this.ui.settings) {\n      throw new Error('GameRefactored: SettingsUI initialization failed');\n    }\n    if (!this.systems.audio) {\n      throw new Error('GameRefactored: AudioSystem initialization failed');\n    }\n\n    // Bind methods - with assertions\n    this.update = this.update.bind(this);\n    this.render = this.render.bind(this);\n    this.handleInput = this.handleInput.bind(this);\n\n    // Assert methods are bound correctly\n    if (typeof this.update !== 'function') {\n      throw new Error('GameRefactored: update method binding failed');\n    }\n    if (typeof this.render !== 'function') {\n      throw new Error('GameRefactored: render method binding failed');\n    }\n    if (typeof this.handleInput !== 'function') {\n      throw new Error('GameRefactored: handleInput method binding failed');\n    }\n\n    this.logger.info('GameRefactored initialized');\n  }\n\n  /**\n   * Validate and normalize configuration\n   */\n  validateConfig(config) {\n    const validatedConfig = { ...config };\n\n    // Normalize boolean values\n    validatedConfig.debug = Boolean(validatedConfig.debug);\n    validatedConfig.enableAchievements = Boolean(\n      validatedConfig.enableAchievements\n    );\n    validatedConfig.enableDailyChallenges = Boolean(\n      validatedConfig.enableDailyChallenges\n    );\n    validatedConfig.enableAccessibility = Boolean(\n      validatedConfig.enableAccessibility\n    );\n\n    return validatedConfig;\n  }\n\n  /**\n   * Initialize all game managers with dependency injection\n   */\n  initializeManagers() {\n    // Core game manager\n    this.managers.game = new GameManager({\n      eventBus: this.eventBus,\n      logger: this.logger,\n      config: this.config,\n    });\n\n    // Cross-cutting feature managers\n    if (this.config.enableAchievements) {\n      this.managers.achievements = new AchievementManager({\n        eventBus: this.eventBus,\n        logger: this.logger,\n        gameState: () => this.gameState,\n      });\n    }\n\n    if (this.config.enableDailyChallenges) {\n      this.managers.dailyChallenges = new DailyChallengeManager({\n        eventBus: this.eventBus,\n        logger: this.logger,\n        gameState: () => this.gameState,\n      });\n    }\n\n    if (this.config.enableAccessibility) {\n      this.managers.accessibility = new AccessibilityManager({\n        eventBus: this.eventBus,\n        logger: this.logger,\n        gameState: () => this.gameState,\n      });\n    }\n\n    // Set up cross-manager communication\n    this.setupManagerCommunication();\n  }\n\n  /**\n   * Initialize UI and Audio systems\n   */\n  initializeUISystems() {\n    // Settings UI\n    this.ui.settings = new SettingsUI({\n      eventBus: this.eventBus,\n      logger: this.logger,\n      container: document.body\n    });\n\n    // Audio System\n    this.systems.audio = new AudioSystem({\n      eventBus: this.eventBus,\n      logger: this.logger\n    });\n\n    // Set up UI and audio integration\n    this.setupUIIntegration();\n  }\n\n  /**\n   * Set up UI and audio integration\n   */\n  setupUIIntegration() {\n    // Settings changes should update audio system\n    this.eventBus.on('settings:changed', (data) => {\n      if (data.path.startsWith('audio.')) {\n        // Audio settings are handled by AudioSystem directly\n        this.logger.debug(`Audio setting changed: ${data.path} = ${data.value}`);\n      }\n    });\n\n    // Game state changes should update UI\n    this.eventBus.on('game:stateChanged', (data) => {\n      if (this.ui.settings) {\n        // Update UI based on game state changes\n        this.logger.debug(`Game state changed: ${JSON.stringify(data)}`);\n      }\n    });\n  }\n\n  /**\n   * Set up communication between managers\n   */\n  setupManagerCommunication() {\n    // Game events that affect achievements\n    this.eventBus.on('player:scoreChanged', (data) => {\n      if (this.managers.achievements) {\n        this.managers.achievements.checkScoreAchievements(data.score);\n      }\n      // Update UI with score change\n      this.updateUI('score', data.score);\n    });\n\n    this.eventBus.on('player:levelCompleted', (data) => {\n      if (this.managers.achievements) {\n        this.managers.achievements.checkLevelAchievements(data.level);\n      }\n      if (this.managers.dailyChallenges) {\n        this.managers.dailyChallenges.checkLevelChallenge(data.level);\n      }\n      // Update UI with level completion\n      this.updateUI('level', data.level);\n    });\n\n    this.eventBus.on('player:itemCollected', (data) => {\n      if (this.managers.achievements) {\n        this.managers.achievements.checkCollectionAchievements(data.itemType);\n      }\n      if (this.managers.dailyChallenges) {\n        this.managers.dailyChallenges.checkCollectionChallenge(data.itemType);\n      }\n      // Update UI with item collection\n      this.updateUI('item', data.itemType);\n    });\n\n    // Accessibility events\n    this.eventBus.on('game:stateChanged', (data) => {\n      if (this.managers.accessibility) {\n        this.managers.accessibility.announceStateChange(data);\n      }\n    });\n\n    // Achievement events that affect gameplay\n    this.eventBus.on('achievement:unlocked', (data) => {\n      this.logger.info(`Achievement unlocked: ${data.name}`);\n      if (this.managers.game) {\n        this.managers.game.handleAchievementUnlock(data);\n      }\n      // Update UI with achievement\n      this.updateUI('achievement', data);\n    });\n\n    // Daily challenge events\n    this.eventBus.on('dailyChallenge:completed', (data) => {\n      this.logger.info(`Daily challenge completed: ${data.name}`);\n      if (this.managers.game) {\n        this.managers.game.handleDailyChallengeCompletion(data);\n      }\n      // Update UI with challenge completion\n      this.updateUI('challenge', data);\n    });\n\n    // Power-up events\n    this.eventBus.on('powerup:activated', (data) => {\n      this.gameState.activePowerUps.set(data.type, {\n        ...data,\n        startTime: Date.now(),\n        duration: data.duration || 10000 // 10 seconds default\n      });\n      this.updateUI('powerup', data);\n    });\n\n    this.eventBus.on('powerup:expired', (data) => {\n      this.gameState.activePowerUps.delete(data.type);\n      this.updateUI('powerupExpired', data);\n    });\n\n    // Console/Play integration events\n    this.eventBus.on('console:command', (data) => {\n      this.handleConsoleCommand(data);\n    });\n\n    this.eventBus.on('play:action', (data) => {\n      this.handlePlayAction(data);\n    });\n  }\n\n  /**\n   * Update UI with game state changes\n   */\n  updateUI(type, data) {\n    // This method provides a centralized way to update UI elements\n    // based on game state changes\n    this.eventBus.emit('ui:update', {\n      type,\n      data,\n      timestamp: Date.now()\n    });\n  }\n\n  /**\n   * Handle console commands for debugging and testing\n   */\n  handleConsoleCommand(data) {\n    const { command, args } = data;\n    \n    switch (command) {\n      case 'setScore':\n        this.gameState.score = parseInt(args[0]) || 0;\n        this.eventBus.emit('player:scoreChanged', { score: this.gameState.score });\n        this.logger.info(`Console: Score set to ${this.gameState.score}`);\n        break;\n        \n      case 'setLevel':\n        this.gameState.currentLevel = parseInt(args[0]) || 1;\n        this.eventBus.emit('player:levelCompleted', { level: this.gameState.currentLevel });\n        this.logger.info(`Console: Level set to ${this.gameState.currentLevel}`);\n        break;\n        \n      case 'addPowerUp':\n        const powerUpType = args[0] || 'speed';\n        this.eventBus.emit('powerup:activated', { \n          type: powerUpType, \n          duration: 10000 \n        });\n        this.logger.info(`Console: Power-up ${powerUpType} added`);\n        break;\n        \n      case 'unlockAchievement':\n        const achievementName = args[0] || 'test';\n        this.eventBus.emit('achievement:unlocked', { \n          name: achievementName,\n          description: 'Console unlocked achievement'\n        });\n        this.logger.info(`Console: Achievement ${achievementName} unlocked`);\n        break;\n        \n      case 'toggleSettings':\n        if (this.ui.settings) {\n          this.ui.settings.toggle();\n        }\n        break;\n        \n      case 'muteAudio':\n        if (this.systems.audio) {\n          this.systems.audio.muteAll();\n        }\n        break;\n        \n      case 'unmuteAudio':\n        if (this.systems.audio) {\n          this.systems.audio.unmuteAll();\n        }\n        break;\n        \n      default:\n        this.logger.warn(`Console: Unknown command: ${command}`);\n    }\n  }\n\n  /**\n   * Handle play actions for game interaction\n   */\n  handlePlayAction(data) {\n    const { action, params } = data;\n    \n    switch (action) {\n      case 'jump':\n        this.eventBus.emit('player:jump', params);\n        break;\n        \n      case 'collect':\n        this.eventBus.emit('player:collect', params);\n        break;\n        \n      case 'damage':\n        this.eventBus.emit('player:damage', params);\n        break;\n        \n      case 'pause':\n        this.pause();\n        break;\n        \n      case 'resume':\n        this.resume();\n        break;\n        \n      case 'restart':\n        this.stop();\n        this.start();\n        break;\n        \n      default:\n        this.logger.warn(`Play: Unknown action: ${action}`);\n    }\n  }\n\n  /**\n   * Start the game\n   */\n  async start() {\n    try {\n      this.logger.info('Starting game...');\n\n      // Initialize all managers\n      for (const [name, manager] of Object.entries(this.managers)) {\n        if (manager.initialize) {\n          await manager.initialize();\n        }\n      }\n\n      // Initialize performance monitoring\n      if (this.performanceMonitor.initialize) {\n        await this.performanceMonitor.initialize();\n      }\n\n      // Initialize input management\n      if (this.inputManager.initialize) {\n        await this.inputManager.initialize();\n      }\n\n      // Initialize mobile testing\n      if (this.mobileTesting.initialize) {\n        await this.mobileTesting.initialize();\n      }\n\n      // Initialize UI and audio systems\n      if (this.systems.audio && this.systems.audio.initialize) {\n        await this.systems.audio.initialize();\n      }\n\n      // Set up game state\n      this.gameState.isRunning = true;\n      this.gameState.startTime = Date.now();\n      this.gameState.lastUpdateTime = performance.now();\n\n      // Start game loop\n      this.gameLoopId = requestAnimationFrame(this.update);\n\n      // Emit game start event\n      this.eventBus.emit('game:started', {\n        timestamp: this.gameState.startTime,\n        config: this.config,\n      });\n\n      // Start background music\n      if (this.systems.audio) {\n        this.systems.audio.playMusic('mainTheme');\n      }\n\n      this.logger.info('Game started successfully');\n    } catch (error) {\n      this.logger.error('Failed to start game:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Pause the game\n   */\n  pause() {\n    if (this.gameState.isRunning && !this.gameState.isPaused) {\n      this.gameState.isPaused = true;\n      cancelAnimationFrame(this.gameLoopId);\n\n      this.eventBus.emit('game:paused', {\n        timestamp: Date.now(),\n        pauseTime: this.gameState.startTime,\n      });\n\n      this.logger.info('Game paused');\n    }\n  }\n\n  /**\n   * Resume the game\n   */\n  resume() {\n    if (this.gameState.isRunning && this.gameState.isPaused) {\n      this.gameState.isPaused = false;\n      this.gameState.lastUpdateTime = performance.now();\n      this.gameLoopId = requestAnimationFrame(this.update);\n\n      this.eventBus.emit('game:resumed', {\n        timestamp: Date.now(),\n      });\n\n      this.logger.info('Game resumed');\n    }\n  }\n\n  /**\n   * Stop the game\n   */\n  stop() {\n    this.gameState.isRunning = false;\n    this.gameState.isPaused = false;\n\n    if (this.gameLoopId) {\n      cancelAnimationFrame(this.gameLoopId);\n    }\n\n    // Cleanup managers\n    for (const [name, manager] of Object.entries(this.managers)) {\n      if (manager.cleanup) {\n        manager.cleanup();\n      }\n    }\n\n    // Cleanup performance monitoring\n    if (this.performanceMonitor.cleanup) {\n      this.performanceMonitor.cleanup();\n    }\n\n    // Cleanup input management\n    if (this.inputManager.cleanup) {\n      this.inputManager.cleanup();\n    }\n\n    // Cleanup mobile testing\n    if (this.mobileTesting.cleanup) {\n      this.mobileTesting.cleanup();\n    }\n\n    this.eventBus.emit('game:stopped', {\n      timestamp: Date.now(),\n      finalScore: this.gameState.score,\n      finalLevel: this.gameState.currentLevel,\n    });\n\n    this.logger.info('Game stopped');\n  }\n\n  /**\n   * Main game update loop\n   */\n  update(currentTime) {\n    if (!this.gameState.isRunning || this.gameState.isPaused) {\n      return;\n    }\n\n    const deltaTime = currentTime - this.gameState.lastUpdateTime;\n    this.gameState.lastUpdateTime = currentTime;\n\n    try {\n      // Update all managers\n      for (const [name, manager] of Object.entries(this.managers)) {\n        if (manager.update) {\n          manager.update(deltaTime, this.gameState);\n        }\n      }\n\n      // Update performance monitoring\n      if (this.performanceMonitor.update) {\n        this.performanceMonitor.update(deltaTime);\n      }\n\n      // Update input management\n      if (this.inputManager.update) {\n        this.inputManager.update(deltaTime);\n      }\n\n      // Update game objects\n      this.updateGameObjects(deltaTime);\n\n      // Continue game loop\n      this.gameLoopId = requestAnimationFrame(this.update);\n    } catch (error) {\n      this.logger.error('Error in game update loop:', error);\n      this.stop();\n    }\n  }\n\n  /**\n   * Update all game objects\n   */\n  updateGameObjects(deltaTime) {\n    // Update player\n    if (this.gameState.player && this.gameState.player.update) {\n      this.gameState.player.update(deltaTime);\n    }\n\n    // Update other game objects\n    this.gameState.gameObjects.forEach((obj) => {\n      if (obj.update) {\n        obj.update(deltaTime);\n      }\n    });\n\n    // Remove destroyed objects\n    this.gameState.gameObjects = this.gameState.gameObjects.filter(\n      (obj) => !obj.destroyed\n    );\n  }\n\n  /**\n   * Render the game\n   */\n  render() {\n    // This would typically be handled by a rendering system\n    // For now, we'll emit render events for managers to handle\n    this.eventBus.emit('game:render', {\n      gameState: this.gameState,\n      timestamp: performance.now(),\n    });\n  }\n\n  /**\n   * Handle input events\n   */\n  handleInput(inputType, data) {\n    if (!this.gameState.isRunning) {\n      return;\n    }\n\n    // Emit input event for managers to handle\n    this.eventBus.emit('game:input', {\n      type: inputType,\n      data: data,\n      timestamp: Date.now(),\n    });\n\n    // Handle player input\n    if (this.gameState.player && this.gameState.player.handleInput) {\n      this.gameState.player.handleInput(inputType, data);\n    }\n  }\n\n  /**\n   * Add a game object to the game\n   */\n  addGameObject(gameObject) {\n    this.gameState.gameObjects.push(gameObject);\n\n    this.eventBus.emit('game:objectAdded', {\n      object: gameObject,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Remove a game object from the game\n   */\n  removeGameObject(gameObjectId) {\n    const index = this.gameState.gameObjects.findIndex(\n      (obj) => obj.id === gameObjectId\n    );\n    if (index !== -1) {\n      const removedObject = this.gameState.gameObjects.splice(index, 1)[0];\n\n      this.eventBus.emit('game:objectRemoved', {\n        object: removedObject,\n        timestamp: Date.now(),\n      });\n    }\n  }\n\n  /**\n   * Get current game state (for external access)\n   */\n  getGameState() {\n    return { ...this.gameState };\n  }\n\n  /**\n   * Get manager by name\n   */\n  getManager(name) {\n    return this.managers[name];\n  }\n\n  /**\n   * Get performance monitor\n   */\n  getPerformanceMonitor() {\n    return this.performanceMonitor;\n  }\n\n  /**\n   * Get input manager\n   */\n  getInputManager() {\n    return this.inputManager;\n  }\n\n  /**\n   * Get mobile testing utility\n   */\n  getMobileTesting() {\n    return this.mobileTesting;\n  }\n\n  /**\n   * Get performance report\n   */\n  getPerformanceReport() {\n    return this.performanceMonitor ? this.performanceMonitor.getPerformanceReport() : null;\n  }\n\n  /**\n   * Get mobile controls state\n   */\n  getMobileControlsState() {\n    return this.inputManager ? this.inputManager.getMobileControlsState() : null;\n  }\n\n  /**\n   * Get mobile test results\n   */\n  getMobileTestResults() {\n    return this.mobileTesting ? this.mobileTesting.getTestResults() : null;\n  }\n\n  /**\n   * Get UI system by name\n   */\n  getUI(name) {\n    return this.ui[name];\n  }\n\n  /**\n   * Get system by name\n   */\n  getSystem(name) {\n    return this.systems[name];\n  }\n\n  /**\n   * Get all active power-ups\n   */\n  getActivePowerUps() {\n    const now = Date.now();\n    const active = [];\n    \n    for (const [type, powerUp] of this.gameState.activePowerUps) {\n      if (now - powerUp.startTime < powerUp.duration) {\n        active.push({\n          type,\n          ...powerUp,\n          remainingTime: powerUp.duration - (now - powerUp.startTime)\n        });\n      } else {\n        // Power-up expired\n        this.gameState.activePowerUps.delete(type);\n        this.eventBus.emit('powerup:expired', { type });\n      }\n    }\n    \n    return active;\n  }\n\n  /**\n   * Execute console command (for external access)\n   */\n  executeConsoleCommand(command, ...args) {\n    this.eventBus.emit('console:command', { command, args });\n  }\n\n  /**\n   * Execute play action (for external access)\n   */\n  executePlayAction(action, params = {}) {\n    this.eventBus.emit('play:action', { action, params });\n  }\n\n  /**\n   * Get game statistics\n   */\n  getGameStats() {\n    return {\n      score: this.gameState.score,\n      level: this.gameState.currentLevel,\n      isRunning: this.gameState.isRunning,\n      isPaused: this.gameState.isPaused,\n      gameTime: this.gameState.startTime ? Date.now() - this.gameState.startTime : 0,\n      activePowerUps: this.getActivePowerUps(),\n      achievements: this.managers.achievements ? this.managers.achievements.getAllAchievements() : [],\n      challenges: this.managers.dailyChallenges ? this.managers.dailyChallenges.getActiveChallenges() : []\n    };\n  }\n\n  /**\n   * Update game configuration\n   */\n  updateConfig(newConfig) {\n    this.config = { ...this.config, ...newConfig };\n\n    // Notify managers of config changes\n    this.eventBus.emit('game:configChanged', {\n      config: this.config,\n      timestamp: Date.now(),\n    });\n  }\n\n  /**\n   * Cleanup and destroy the game instance\n   */\n  destroy() {\n    this.stop();\n\n    // Cleanup UI systems\n    if (this.ui.settings) {\n      this.ui.settings.cleanup();\n    }\n\n    // Cleanup audio systems\n    if (this.systems.audio) {\n      this.systems.audio.cleanup();\n    }\n\n    // Clear all event listeners\n    this.eventBus.removeAllListeners(); // Remove all listeners (no event parameter)\n\n    // Clear game state\n    this.gameState = null;\n    this.managers = null;\n    this.ui = null;\n    this.systems = null;\n\n    this.logger.info('GameRefactored destroyed');\n  }\n}\n\n// Export for use in other modules\nexport default GameRefactored;\n"],"names":["Logger","constructor","debug","this","logLevel","logHistory","maxHistorySize","performanceMetrics","totalLogs","logsByLevel","Map","averageLogTime","levels","error","warn","info","trace","startTime","Date","now","setLevel","level","Object","prototype","hasOwnProperty","call","concat","enableDebug","disableDebug","shouldLog","log","message","data","context","logEntry","timestamp","id","generateLogId","addToHistory","updatePerformanceMetrics","outputLog","push","length","shift","count","get","set","totalTime","timeString","toISOString","contextString","toUpperCase","Math","random","toString","substr","performance","operation","endTime","duration","toFixed","memory","used","round","usedJSHeapSize","total","totalJSHeapSize","limit","jsHeapSizeLimit","name","fn","result","functionAsync","event","eventName","stateChange","from","to","userAction","action","apiCall","method","url","apiResponse","status","errorWithStack","stack","group","groupAsync","getHistory","filter","history","entry","since","until","slice","getPerformanceMetrics","fromEntries","uptime","clearHistory","resetMetrics","exportLogs","JSON","stringify","importLogs","jsonString","logs","parse","Array","isArray","child","childLogger","MobileTesting","dependencies","eventBus","logger","inputManager","performanceMonitor","config","enableAutoTesting","testInterval","gestureTestTimeout","performanceTestDuration","enableAccessibilityTesting","enablePerformanceTesting","enableGestureTesting","enableControlTesting","isTesting","testResults","device","gestures","controls","accessibility","overall","testListeners","initialize","detectMobileDevice","setupTestListeners","startAutoTesting","cleanup","stopAutoTesting","removeTestListeners","userAgent","navigator","isMobile","test","isTouch","window","maxTouchPoints","isTablet","screenWidth","screen","width","screenHeight","height","viewportWidth","innerWidth","viewportHeight","innerHeight","pixelRatio","devicePixelRatio","orientation","hasVibration","hasHaptics","hasGeolocation","hasCamera","mediaDevices","hasAccelerometer","hasGyroscope","setupGestureTestListeners","setupControlTestListeners","setupPerformanceTestListeners","setupAccessibilityTestListeners","testTapGesture","bind","testDoubleTapGesture","testLongPressGesture","testSwipeGesture","testPinchGesture","testRotateGesture","forEach","testVirtualJoystick","testActionButtons","testMenuButton","testPauseButton","testPerformance","testAccessibility","clear","autoTestInterval","setInterval","runAllTests","clearInterval","testAllGestures","testAllControls","calculateOverallScore","emit","gestureNames","gestureName","testGesture","success","testFunction","Error","Promise","resolve","tapDetected","handleTap","responseTime","document","removeEventListener","addEventListener","once","setTimeout","tapCount","lastTapTime","currentTime","timeDiff","longPressDetected","handleTouchStart","handleTouchEnd","swipeDetected","startTouch","e","touches","endTouch","changedTouches","deltaX","clientX","deltaY","clientY","distance","sqrt","direction","atan2","PI","pinchDetected","startTouches","handleTouchMove","currentTouches","startDistance","getDistance","scale","abs","rotateDetected","startAngle","getAngle","rotation","controlNames","controlName","testControl","mobileUI","virtualJoystick","element","joystick","rect","getBoundingClientRect","position","x","left","y","top","active","actionButtons","buttons","entries","map","button","visible","offsetParent","menuButton","querySelector","pauseButton","metrics","getMetrics","score","getPerformanceScore","fps","current","frameTime","audio","contextState","accessibilityTests","testScreenReaderSupport","testKeyboardNavigation","testHighContrast","testTextScaling","results","all","tests","overallScore","reduce","sum","hasScreenReader","hasAriaSupport","details","focusableElements","querySelectorAll","enabled","documentElement","classList","contains","textScale","getComputedStyle","getPropertyValue","parseFloat","totalScore","testCount","_a","totalTests","passedTests","touch1","touch2","dx","dy","getTestResults","getTestReport","exportTestResults","updateConfig","newConfig","SettingsUI","EventBus","container","body","isVisible","settings","getDefaultSettings","show","hide","toggle","updateSetting","resetToDefaults","saveSettings","loadSettings","initializeUI","setupEventListeners","masterVolume","musicVolume","sfxVolume","muteAll","muteMusic","muteSfx","graphics","quality","fullscreen","vsync","particleEffects","shadows","antiAliasing","gameplay","difficulty","autoSave","autoPause","showFPS","showDebugInfo","tutorialEnabled","highContrast","largeText","screenReader","colorBlindMode","reducedMotion","keyboardNavigation","keyBindings","getDefaultKeyBindings","mouseSensitivity","invertY","autoAim","moveUp","moveDown","moveLeft","moveRight","jump","pause","inventory","chat","settingsContainer","createElement","className","style","cssText","settingsPanel","createHeader","createAudioSection","createGraphicsSection","createGameplaySection","createAccessibilitySection","createControlsSection","createFooter","appendChild","header","title","textContent","closeButton","section","createSection","createSliderControl","createCheckboxControl","createSelectControl","value","label","keyBindingsDiv","innerHTML","sectionTitle","settingPath","min","max","step","controlDiv","labelEl","slider","type","getSettingValue","valueDisplay","target","checkbox","checked","options","select","option","optionEl","footer","resetButton","buttonGroup","cancelButton","saveButton","key","path","keys","split","i","display","localStorage","setItem","saved","getItem","parsedSettings","mergeSettings","defaults","merged","getSettings","setSettings","newSettings","parentNode","removeChild","GameRefactored","validateConfig","enableAchievements","enableDailyChallenges","enableAccessibility","gameState","isRunning","isPaused","currentLevel","player","gameObjects","lastUpdateTime","activePowerUps","managers","initializeManagers","PerformanceMonitor","InputManager","mobileTesting","ui","systems","initializeUISystems","game","achievements","dailyChallenges","update","render","handleInput","validatedConfig","Boolean","GameManager","AchievementManager","DailyChallengeManager","AccessibilityManager","setupManagerCommunication","AudioSystem","setupUIIntegration","on","startsWith","checkScoreAchievements","updateUI","checkLevelAchievements","checkLevelChallenge","checkCollectionAchievements","itemType","checkCollectionChallenge","announceStateChange","handleAchievementUnlock","handleDailyChallengeCompletion","delete","handleConsoleCommand","handlePlayAction","command","args","parseInt","powerUpType","achievementName","description","unmuteAll","params","resume","stop","start","manager","gameLoopId","requestAnimationFrame","playMusic","cancelAnimationFrame","pauseTime","finalScore","finalLevel","deltaTime","updateGameObjects","obj","destroyed","inputType","addGameObject","gameObject","object","removeGameObject","gameObjectId","index","findIndex","removedObject","splice","getGameState","getManager","getPerformanceMonitor","getInputManager","getMobileTesting","getPerformanceReport","getMobileControlsState","getMobileTestResults","getUI","getSystem","getActivePowerUps","powerUp","remainingTime","executeConsoleCommand","executePlayAction","getGameStats","gameTime","getAllAchievements","challenges","getActiveChallenges","destroy","removeAllListeners"],"mappings":"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"}