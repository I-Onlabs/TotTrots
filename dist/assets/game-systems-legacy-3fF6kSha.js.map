{"version":3,"file":"game-systems-legacy-3fF6kSha.js","sources":["../../src/systems/AudioSystem.js"],"sourcesContent":["/**\n * AudioSystem.js - Comprehensive audio management system\n * \n * Provides audio playback, volume control, and audio effects management\n * with proper integration with the UI system and game events.\n */\n\nimport { EventBus } from '../core/EventBus.js';\nimport { Logger } from '../utils/Logger.js';\n\nexport class AudioSystem {\n  constructor(config = {}) {\n    // Validate required dependencies\n    if (!config.eventBus || !(config.eventBus instanceof EventBus)) {\n      throw new Error('AudioSystem: eventBus is required and must be an EventBus instance');\n    }\n    if (!config.logger || !(config.logger instanceof Logger)) {\n      throw new Error('AudioSystem: logger is required and must be a Logger instance');\n    }\n\n    this.eventBus = config.eventBus;\n    this.logger = config.logger;\n    this.audioContext = null;\n    this.sounds = new Map();\n    this.music = new Map();\n    this.audioSettings = {\n      masterVolume: 1.0,\n      musicVolume: 0.8,\n      sfxVolume: 0.9,\n      muteAll: false,\n      muteMusic: false,\n      muteSfx: false\n    };\n    this.currentMusic = null;\n    this.isInitialized = false;\n\n    // Bind methods\n    this.initialize = this.initialize.bind(this);\n    this.loadSound = this.loadSound.bind(this);\n    this.loadMusic = this.loadMusic.bind(this);\n    this.playSound = this.playSound.bind(this);\n    this.playMusic = this.playMusic.bind(this);\n    this.stopMusic = this.stopMusic.bind(this);\n    this.pauseMusic = this.pauseMusic.bind(this);\n    this.resumeMusic = this.resumeMusic.bind(this);\n    this.setMasterVolume = this.setMasterVolume.bind(this);\n    this.setMusicVolume = this.setMusicVolume.bind(this);\n    this.setSfxVolume = this.setSfxVolume.bind(this);\n    this.muteAll = this.muteAll.bind(this);\n    this.unmuteAll = this.unmuteAll.bind(this);\n    this.muteMusic = this.muteMusic.bind(this);\n    this.unmuteMusic = this.unmuteMusic.bind(this);\n    this.muteSfx = this.muteSfx.bind(this);\n    this.unmuteSfx = this.unmuteSfx.bind(this);\n    this.cleanup = this.cleanup.bind(this);\n\n    this.logger.info('AudioSystem initialized');\n  }\n\n  /**\n   * Initialize the audio system\n   */\n  async initialize() {\n    try {\n      // Create audio context\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      \n      // Resume audio context if suspended (required for some browsers)\n      if (this.audioContext.state === 'suspended') {\n        await this.audioContext.resume();\n      }\n\n      // Set up event listeners\n      this.setupEventListeners();\n\n      // Load default audio assets\n      await this.loadDefaultAssets();\n\n      this.isInitialized = true;\n      this.eventBus.emit('audio:initialized');\n      this.logger.info('AudioSystem initialized successfully');\n    } catch (error) {\n      this.logger.error('Failed to initialize AudioSystem:', error);\n      this.eventBus.emit('audio:initializationError', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Set up event listeners for audio-related events\n   */\n  setupEventListeners() {\n    // Settings changes\n    this.eventBus.on('settings:changed', (data) => {\n      this.handleSettingsChange(data);\n    });\n\n    // Game events that trigger sounds\n    this.eventBus.on('player:jump', () => {\n      this.playSound('jump');\n    });\n\n    this.eventBus.on('player:collect', (data) => {\n      this.playSound('collect');\n    });\n\n    this.eventBus.on('player:damage', () => {\n      this.playSound('damage');\n    });\n\n    this.eventBus.on('player:death', () => {\n      this.playSound('death');\n    });\n\n    this.eventBus.on('game:levelComplete', () => {\n      this.playSound('levelComplete');\n    });\n\n    this.eventBus.on('game:gameOver', () => {\n      this.playSound('gameOver');\n    });\n\n    this.eventBus.on('achievement:unlocked', () => {\n      this.playSound('achievement');\n    });\n\n    // Window events\n    window.addEventListener('beforeunload', this.cleanup);\n    document.addEventListener('visibilitychange', () => {\n      if (document.hidden) {\n        this.pauseMusic();\n      } else {\n        this.resumeMusic();\n      }\n    });\n  }\n\n  /**\n   * Handle settings changes\n   */\n  handleSettingsChange(data) {\n    const { path, value } = data;\n    \n    switch (path) {\n      case 'audio.masterVolume':\n        this.setMasterVolume(value);\n        break;\n      case 'audio.musicVolume':\n        this.setMusicVolume(value);\n        break;\n      case 'audio.sfxVolume':\n        this.setSfxVolume(value);\n        break;\n      case 'audio.muteAll':\n        if (value) {\n          this.muteAll();\n        } else {\n          this.unmuteAll();\n        }\n        break;\n      case 'audio.muteMusic':\n        if (value) {\n          this.muteMusic();\n        } else {\n          this.unmuteMusic();\n        }\n        break;\n      case 'audio.muteSfx':\n        if (value) {\n          this.muteSfx();\n        } else {\n          this.unmuteSfx();\n        }\n        break;\n    }\n  }\n\n  /**\n   * Load default audio assets\n   */\n  async loadDefaultAssets() {\n    const defaultSounds = [\n      'jump',\n      'collect',\n      'damage',\n      'death',\n      'levelComplete',\n      'gameOver',\n      'achievement',\n      'buttonClick',\n      'buttonHover',\n      'error'\n    ];\n\n    const defaultMusic = [\n      'mainTheme',\n      'menuTheme',\n      'gameplayTheme',\n      'victoryTheme'\n    ];\n\n    // Load sounds (using placeholder data URLs for demo)\n    for (const soundName of defaultSounds) {\n      await this.loadSound(soundName, this.generatePlaceholderAudio(soundName));\n    }\n\n    // Load music\n    for (const musicName of defaultMusic) {\n      await this.loadMusic(musicName, this.generatePlaceholderAudio(musicName, true));\n    }\n\n    this.logger.info('Default audio assets loaded');\n  }\n\n  /**\n   * Generate placeholder audio data URL for demo purposes\n   */\n  generatePlaceholderAudio(name, isMusic = false) {\n    // In a real implementation, this would load actual audio files\n    // For demo purposes, we'll create a simple data URL\n    const duration = isMusic ? 30 : 1; // 30 seconds for music, 1 second for sounds\n    const sampleRate = 44100;\n    const samples = sampleRate * duration;\n    const buffer = new ArrayBuffer(44 + samples * 2);\n    const view = new DataView(buffer);\n    \n    // WAV header\n    const writeString = (offset, string) => {\n      for (let i = 0; i < string.length; i++) {\n        view.setUint8(offset + i, string.charCodeAt(i));\n      }\n    };\n    \n    writeString(0, 'RIFF');\n    view.setUint32(4, 36 + samples * 2, true);\n    writeString(8, 'WAVE');\n    writeString(12, 'fmt ');\n    view.setUint32(16, 16, true);\n    view.setUint16(20, 1, true);\n    view.setUint16(22, 1, true);\n    view.setUint32(24, sampleRate, true);\n    view.setUint32(28, sampleRate * 2, true);\n    view.setUint16(32, 2, true);\n    view.setUint16(34, 16, true);\n    writeString(36, 'data');\n    view.setUint32(40, samples * 2, true);\n    \n    // Generate simple sine wave\n    for (let i = 0; i < samples; i++) {\n      const sample = Math.sin(2 * Math.PI * 440 * i / sampleRate) * 0.1; // 440Hz tone\n      view.setInt16(44 + i * 2, sample * 32767, true);\n    }\n    \n    const blob = new Blob([buffer], { type: 'audio/wav' });\n    return URL.createObjectURL(blob);\n  }\n\n  /**\n   * Load a sound effect\n   */\n  async loadSound(name, url) {\n    try {\n      const audio = new Audio(url);\n      audio.preload = 'auto';\n      audio.volume = this.audioSettings.sfxVolume * this.audioSettings.masterVolume;\n      \n      await new Promise((resolve, reject) => {\n        audio.addEventListener('canplaythrough', resolve);\n        audio.addEventListener('error', reject);\n      });\n      \n      this.sounds.set(name, audio);\n      this.logger.debug(`Sound loaded: ${name}`);\n    } catch (error) {\n      this.logger.error(`Failed to load sound ${name}:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Load background music\n   */\n  async loadMusic(name, url) {\n    try {\n      const audio = new Audio(url);\n      audio.preload = 'auto';\n      audio.loop = true;\n      audio.volume = this.audioSettings.musicVolume * this.audioSettings.masterVolume;\n      \n      await new Promise((resolve, reject) => {\n        audio.addEventListener('canplaythrough', resolve);\n        audio.addEventListener('error', reject);\n      });\n      \n      this.music.set(name, audio);\n      this.logger.debug(`Music loaded: ${name}`);\n    } catch (error) {\n      this.logger.error(`Failed to load music ${name}:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Play a sound effect\n   */\n  playSound(name, volume = 1.0) {\n    if (!this.isInitialized) {\n      this.logger.warn('AudioSystem not initialized, cannot play sound');\n      return;\n    }\n\n    if (this.audioSettings.muteAll || this.audioSettings.muteSfx) {\n      return;\n    }\n\n    const sound = this.sounds.get(name);\n    if (!sound) {\n      this.logger.warn(`Sound not found: ${name}`);\n      return;\n    }\n\n    try {\n      // Clone the audio to allow overlapping sounds\n      const soundClone = sound.cloneNode();\n      soundClone.volume = sound.volume * volume;\n      soundClone.play();\n      \n      this.eventBus.emit('audio:soundPlayed', { name, volume });\n      this.logger.debug(`Playing sound: ${name}`);\n    } catch (error) {\n      this.logger.error(`Failed to play sound ${name}:`, error);\n    }\n  }\n\n  /**\n   * Play background music\n   */\n  playMusic(name, fadeIn = true) {\n    if (!this.isInitialized) {\n      this.logger.warn('AudioSystem not initialized, cannot play music');\n      return;\n    }\n\n    if (this.audioSettings.muteAll || this.audioSettings.muteMusic) {\n      return;\n    }\n\n    const music = this.music.get(name);\n    if (!music) {\n      this.logger.warn(`Music not found: ${name}`);\n      return;\n    }\n\n    try {\n      // Stop current music if playing\n      if (this.currentMusic && this.currentMusic !== music) {\n        this.stopMusic();\n      }\n\n      this.currentMusic = music;\n      \n      if (fadeIn) {\n        music.volume = 0;\n        music.play();\n        this.fadeIn(music);\n      } else {\n        music.play();\n      }\n      \n      this.eventBus.emit('audio:musicStarted', { name });\n      this.logger.debug(`Playing music: ${name}`);\n    } catch (error) {\n      this.logger.error(`Failed to play music ${name}:`, error);\n    }\n  }\n\n  /**\n   * Stop current music\n   */\n  stopMusic() {\n    if (this.currentMusic) {\n      this.currentMusic.pause();\n      this.currentMusic.currentTime = 0;\n      this.eventBus.emit('audio:musicStopped');\n      this.logger.debug('Music stopped');\n    }\n  }\n\n  /**\n   * Pause current music\n   */\n  pauseMusic() {\n    if (this.currentMusic && !this.currentMusic.paused) {\n      this.currentMusic.pause();\n      this.eventBus.emit('audio:musicPaused');\n      this.logger.debug('Music paused');\n    }\n  }\n\n  /**\n   * Resume current music\n   */\n  resumeMusic() {\n    if (this.currentMusic && this.currentMusic.paused) {\n      this.currentMusic.play();\n      this.eventBus.emit('audio:musicResumed');\n      this.logger.debug('Music resumed');\n    }\n  }\n\n  /**\n   * Fade in audio\n   */\n  fadeIn(audio, duration = 2000) {\n    const startTime = Date.now();\n    const startVolume = audio.volume;\n    const targetVolume = this.audioSettings.musicVolume * this.audioSettings.masterVolume;\n    \n    const fade = () => {\n      const elapsed = Date.now() - startTime;\n      const progress = Math.min(elapsed / duration, 1);\n      audio.volume = startVolume + (targetVolume - startVolume) * progress;\n      \n      if (progress < 1) {\n        requestAnimationFrame(fade);\n      }\n    };\n    \n    fade();\n  }\n\n  /**\n   * Fade out audio\n   */\n  fadeOut(audio, duration = 2000) {\n    const startTime = Date.now();\n    const startVolume = audio.volume;\n    \n    const fade = () => {\n      const elapsed = Date.now() - startTime;\n      const progress = Math.min(elapsed / duration, 1);\n      audio.volume = startVolume * (1 - progress);\n      \n      if (progress < 1) {\n        requestAnimationFrame(fade);\n      } else {\n        audio.pause();\n        audio.currentTime = 0;\n      }\n    };\n    \n    fade();\n  }\n\n  /**\n   * Set master volume\n   */\n  setMasterVolume(volume) {\n    this.audioSettings.masterVolume = Math.max(0, Math.min(1, volume));\n    this.updateAllVolumes();\n    this.eventBus.emit('audio:masterVolumeChanged', this.audioSettings.masterVolume);\n    this.logger.debug(`Master volume set to: ${this.audioSettings.masterVolume}`);\n  }\n\n  /**\n   * Set music volume\n   */\n  setMusicVolume(volume) {\n    this.audioSettings.musicVolume = Math.max(0, Math.min(1, volume));\n    this.updateMusicVolumes();\n    this.eventBus.emit('audio:musicVolumeChanged', this.audioSettings.musicVolume);\n    this.logger.debug(`Music volume set to: ${this.audioSettings.musicVolume}`);\n  }\n\n  /**\n   * Set SFX volume\n   */\n  setSfxVolume(volume) {\n    this.audioSettings.sfxVolume = Math.max(0, Math.min(1, volume));\n    this.updateSfxVolumes();\n    this.eventBus.emit('audio:sfxVolumeChanged', this.audioSettings.sfxVolume);\n    this.logger.debug(`SFX volume set to: ${this.audioSettings.sfxVolume}`);\n  }\n\n  /**\n   * Update all audio volumes\n   */\n  updateAllVolumes() {\n    this.updateMusicVolumes();\n    this.updateSfxVolumes();\n  }\n\n  /**\n   * Update music volumes\n   */\n  updateMusicVolumes() {\n    const volume = this.audioSettings.musicVolume * this.audioSettings.masterVolume;\n    for (const music of this.music.values()) {\n      music.volume = volume;\n    }\n  }\n\n  /**\n   * Update SFX volumes\n   */\n  updateSfxVolumes() {\n    const volume = this.audioSettings.sfxVolume * this.audioSettings.masterVolume;\n    for (const sound of this.sounds.values()) {\n      sound.volume = volume;\n    }\n  }\n\n  /**\n   * Mute all audio\n   */\n  muteAll() {\n    this.audioSettings.muteAll = true;\n    this.updateAllVolumes();\n    this.eventBus.emit('audio:muted', { type: 'all' });\n    this.logger.debug('All audio muted');\n  }\n\n  /**\n   * Unmute all audio\n   */\n  unmuteAll() {\n    this.audioSettings.muteAll = false;\n    this.updateAllVolumes();\n    this.eventBus.emit('audio:unmuted', { type: 'all' });\n    this.logger.debug('All audio unmuted');\n  }\n\n  /**\n   * Mute music only\n   */\n  muteMusic() {\n    this.audioSettings.muteMusic = true;\n    this.updateMusicVolumes();\n    this.eventBus.emit('audio:muted', { type: 'music' });\n    this.logger.debug('Music muted');\n  }\n\n  /**\n   * Unmute music only\n   */\n  unmuteMusic() {\n    this.audioSettings.muteMusic = false;\n    this.updateMusicVolumes();\n    this.eventBus.emit('audio:unmuted', { type: 'music' });\n    this.logger.debug('Music unmuted');\n  }\n\n  /**\n   * Mute SFX only\n   */\n  muteSfx() {\n    this.audioSettings.muteSfx = true;\n    this.updateSfxVolumes();\n    this.eventBus.emit('audio:muted', { type: 'sfx' });\n    this.logger.debug('SFX muted');\n  }\n\n  /**\n   * Unmute SFX only\n   */\n  unmuteSfx() {\n    this.audioSettings.muteSfx = false;\n    this.updateSfxVolumes();\n    this.eventBus.emit('audio:unmuted', { type: 'sfx' });\n    this.logger.debug('SFX unmuted');\n  }\n\n  /**\n   * Get current audio settings\n   */\n  getAudioSettings() {\n    return { ...this.audioSettings };\n  }\n\n  /**\n   * Set audio settings\n   */\n  setAudioSettings(settings) {\n    this.audioSettings = { ...this.audioSettings, ...settings };\n    this.updateAllVolumes();\n    this.eventBus.emit('audio:settingsChanged', this.audioSettings);\n    this.logger.debug('Audio settings updated');\n  }\n\n  /**\n   * Get list of loaded sounds\n   */\n  getLoadedSounds() {\n    return Array.from(this.sounds.keys());\n  }\n\n  /**\n   * Get list of loaded music\n   */\n  getLoadedMusic() {\n    return Array.from(this.music.keys());\n  }\n\n  /**\n   * Check if audio is playing\n   */\n  isPlaying(name, type = 'sound') {\n    const audio = type === 'music' ? this.music.get(name) : this.sounds.get(name);\n    return audio && !audio.paused;\n  }\n\n  /**\n   * Cleanup resources\n   */\n  cleanup() {\n    // Stop all audio\n    this.stopMusic();\n    \n    // Clean up audio context\n    if (this.audioContext) {\n      this.audioContext.close();\n    }\n    \n    // Clear audio maps\n    this.sounds.clear();\n    this.music.clear();\n    \n    this.eventBus.emit('audio:cleanup');\n    this.logger.info('AudioSystem cleaned up');\n  }\n}"],"names":["exports","constructor","config","eventBus","EventBus","Error","logger","Logger","this","audioContext","sounds","Map","music","audioSettings","masterVolume","musicVolume","sfxVolume","muteAll","muteMusic","muteSfx","currentMusic","isInitialized","initialize","bind","loadSound","loadMusic","playSound","playMusic","stopMusic","pauseMusic","resumeMusic","setMasterVolume","setMusicVolume","setSfxVolume","unmuteAll","unmuteMusic","unmuteSfx","cleanup","info","window","AudioContext","webkitAudioContext","state","resume","setupEventListeners","loadDefaultAssets","emit","error","on","data","handleSettingsChange","addEventListener","document","hidden","path","value","defaultSounds","defaultMusic","soundName","generatePlaceholderAudio","musicName","name","isMusic","sampleRate","samples","buffer","ArrayBuffer","view","DataView","writeString","offset","string","i","length","setUint8","charCodeAt","setUint32","setUint16","sample","Math","sin","PI","setInt16","blob","Blob","type","URL","createObjectURL","url","audio","Audio","preload","volume","Promise","resolve","reject","set","debug","loop","warn","sound","get","soundClone","cloneNode","play","fadeIn","pause","currentTime","paused","duration","startTime","Date","now","startVolume","targetVolume","fade","elapsed","progress","min","requestAnimationFrame","fadeOut","max","updateAllVolumes","updateMusicVolumes","updateSfxVolumes","values","getAudioSettings","setAudioSettings","settings","getLoadedSounds","Array","from","keys","getLoadedMusic","isPlaying","close","clear"],"mappings":"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"}